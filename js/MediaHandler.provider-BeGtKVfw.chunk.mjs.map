{"version":3,"file":"MediaHandler.provider-BeGtKVfw.chunk.mjs","sources":["../src/helpers/links.js","../src/components/Editor.provider.js","../src/components/Editor/MediaHandler.provider.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\nimport { generateUrl } from '@nextcloud/router'\n\nconst domHref = function(node, relativePath) {\n\tconst ref = node.attrs.href\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tif (!window.OCA?.Viewer) {\n\t\treturn ref\n\t}\n\tif (ref.match(/^[a-zA-Z]*:/)) {\n\t\treturn ref\n\t}\n\tif (ref.startsWith('#')) {\n\t\treturn ref\n\t}\n\t// Don't rewrite links in collectives app context\n\tif (loadState('core', 'active-app', '') === 'collectives') {\n\t\treturn ref\n\t}\n\t// Don't rewrite links to the collectives app\n\tif (ref.includes('/apps/collectives/')) {\n\t\treturn ref\n\t}\n\n\t// Rewrite links with old format from file picker to `/f/<fileId>`\n\tconst match = ref.match(/^([^?]*)\\?fileId=(\\d+)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn (new URL(generateUrl(`/f/${id}`), window.origin)).href\n\t}\n\treturn ref\n}\n\nconst parseHref = function(dom) {\n\tconst ref = dom.getAttribute('href')\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tconst match = ref.match(/\\?dir=([^&]*)&openfile=([^&]*)#relPath=([^&]*)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn (new URL(generateUrl(`/f/${id}`), window.origin)).href\n\t}\n\treturn ref\n}\n\nconst isLinkToSelfWithHash = function(href) {\n\tconst locationNoHash = window.location.origin + window.location.pathname + window.location.search\n\treturn href?.startsWith('#') || href?.startsWith(locationNoHash + '#')\n}\n\n/**\n * Open links, to be used as custom click handler\n *\n * @param {string} href the link href\n */\nconst openLink = function(href) {\n\tconst linkUrl = new URL(href, window.location.href)\n\t// Consider rerouting links to Collectives if already inside Collectives app\n\tconst collectivesUrlBase = '/apps/collectives'\n\tif (window.OCA.Collectives?.vueRouter\n\t\t&& linkUrl.pathname.toString().startsWith(generateUrl(collectivesUrlBase))) {\n\t\tconst collectivesUrl = linkUrl.href.substring(\n\t\t\tlinkUrl.href.indexOf(collectivesUrlBase) + collectivesUrlBase.length,\n\t\t)\n\t\twindow.OCA.Collectives.vueRouter.push(collectivesUrl)\n\t\treturn\n\t}\n\twindow.open(linkUrl, '_blank')\n}\n\nexport {\n\tdomHref,\n\tisLinkToSelfWithHash,\n\topenLink,\n\tparseHref,\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { openLink } from '../helpers/links.js'\nimport { logger } from '../helpers/logger.js'\n\nexport const EDITOR = Symbol('tiptap:editor')\nexport const FILE = Symbol('editor:file')\nexport const ATTACHMENT_RESOLVER = Symbol('attachment:resolver')\nexport const IS_MOBILE = Symbol('editor:is-mobile')\nexport const IS_PUBLIC = Symbol('editor:is-public')\nexport const IS_RICH_EDITOR = Symbol('editor:is-rich-editor')\nexport const IS_RICH_WORKSPACE = Symbol('editor:is-rich-woskapace')\nexport const SYNC_SERVICE = Symbol('sync:service')\nexport const EDITOR_UPLOAD = Symbol('editor:upload')\nexport const HOOK_MENTION_SEARCH = Symbol('hook:mention-search')\nexport const HOOK_MENTION_INSERT = Symbol('hook:mention-insert')\nexport const OPEN_LINK_HANDLER = Symbol('editor:open-link-handler')\n\nexport const useEditorMixin = {\n\tinject: {\n\t\t$editor: { from: EDITOR, default: null },\n\t},\n}\n\nexport const useSyncServiceMixin = {\n\tinject: {\n\t\t$syncService: { from: SYNC_SERVICE, default: null },\n\t},\n}\n\nexport const useIsPublicMixin = {\n\tinject: {\n\t\t$isPublic: { from: IS_PUBLIC, default: false },\n\t},\n}\n\nexport const useIsRichWorkspaceMixin = {\n\tinject: {\n\t\t$isRichWorkspace: { from: IS_RICH_WORKSPACE, default: false },\n\t},\n}\n\nexport const useIsRichEditorMixin = {\n\tinject: {\n\t\t$isRichEditor: { from: IS_RICH_EDITOR, default: false },\n\t},\n}\n\nexport const useIsMobileMixin = {\n\tinject: {\n\t\t$isMobile: { from: IS_MOBILE, default: false },\n\t},\n}\n\nexport const useFileMixin = {\n\tinject: {\n\t\t$file: {\n\t\t\tfrom: FILE,\n\t\t\tdefault: () => ({\n\t\t\t\tfileId: 0,\n\t\t\t\trelativePath: null,\n\t\t\t\tdocument: null,\n\t\t\t}),\n\t\t},\n\t},\n}\n\nexport const useAttachmentResolver = {\n\tinject: {\n\t\t$attachmentResolver: {\n\t\t\tfrom: ATTACHMENT_RESOLVER,\n\t\t\tdefault: {\n\t\t\t\tresolve(src) {\n\t\t\t\t\tlogger.warn('No attachment resolver provided. Some attachment sources cannot be resolved.')\n\t\t\t\t\treturn [src]\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n}\nexport const useEditorUpload = {\n\tinject: {\n\t\t$editorUpload: {\n\t\t\tfrom: EDITOR_UPLOAD,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useMentionHook = {\n\tinject: {\n\t\t$mentionHookInsert: {\n\t\t\tfrom: HOOK_MENTION_INSERT,\n\t\t\tdefault: true,\n\t\t},\n\t\t$mentionHookSearch: {\n\t\t\tfrom: HOOK_MENTION_SEARCH,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useOpenLinkHandler = {\n\tinject: {\n\t\t$openLinkHandler: {\n\t\t\tfrom: OPEN_LINK_HANDLER,\n\t\t\tdefault: {\n\t\t\t\topenLink,\n\t\t\t},\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport const STATE_UPLOADING = Symbol('state:uploading-state')\nexport const ACTION_ATTACHMENT_PROMPT = Symbol('editor:action:attachment-prompt')\nexport const ACTION_CHOOSE_LOCAL_ATTACHMENT = Symbol('editor:action:upload-attachment')\n\nexport const useUploadingStateMixin = {\n\tinject: {\n\t\t$uploadingState: {\n\t\t\tfrom: STATE_UPLOADING,\n\t\t\tdefault: {\n\t\t\t\tisUploadingAttachments: false,\n\t\t\t},\n\t\t},\n\t},\n}\n\nexport const useActionAttachmentPromptMixin = {\n\tinject: {\n\t\t$callAttachmentPrompt: { from: ACTION_ATTACHMENT_PROMPT, default: () => {} },\n\t},\n}\n\nexport const useActionChooseLocalAttachmentMixin = {\n\tinject: {\n\t\t$callChooseLocalAttachment: { from: ACTION_CHOOSE_LOCAL_ATTACHMENT, default: () => {} },\n\t},\n}\n"],"names":["domHref","node","relativePath","ref","loadState","match","id","generateUrl","parseHref","dom","isLinkToSelfWithHash","href","locationNoHash","openLink","linkUrl","collectivesUrlBase","collectivesUrl","EDITOR","FILE","ATTACHMENT_RESOLVER","IS_MOBILE","IS_PUBLIC","IS_RICH_EDITOR","IS_RICH_WORKSPACE","SYNC_SERVICE","EDITOR_UPLOAD","HOOK_MENTION_SEARCH","HOOK_MENTION_INSERT","OPEN_LINK_HANDLER","useEditorMixin","useSyncServiceMixin","useIsPublicMixin","useIsRichWorkspaceMixin","useIsRichEditorMixin","useIsMobileMixin","useFileMixin","useAttachmentResolver","src","logger","useEditorUpload","useOpenLinkHandler","STATE_UPLOADING","ACTION_ATTACHMENT_PROMPT","ACTION_CHOOSE_LOCAL_ATTACHMENT","useUploadingStateMixin","useActionAttachmentPromptMixin","useActionChooseLocalAttachmentMixin"],"mappings":"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"}