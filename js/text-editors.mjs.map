{"version":3,"mappings":"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","names":["apiVersion","Vue","TextEditorEmbed","vm","data","__privateAdd","_V_instances","#vm","#data","__privateSet","__privateMethod","#registerDebug","onLoadedCallback","__privateGet","onUpdateCallback","content","onOutlineToggleCallback","visible","onSearchCallback","subscribe","el","element","_b","_a","#getEditorComponent","query","matchAll","value","fileId","useSession","filePath","shareToken","readOnly","autofocus","readonlyBar","onLoaded","onUpdate","markdown","onOutlineToggle","onFileInsert","onMentionSearch","onMentionInsert","onSearch","MarkdownContentEditor","Editor","__vitePreload","sessionEditor","ACTION_ATTACHMENT_PROMPT","EDITOR_UPLOAD","HOOK_MENTION_SEARCH","HOOK_MENTION_INSERT","ATTACHMENT_RESOLVER","src","preferRaw","h","scopedSlots","store"],"ignoreList":[],"sources":["../src/editor.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport Vue from 'vue'\nimport store from './store/index.js'\nimport { subscribe } from '@nextcloud/event-bus'\nimport { EDITOR_UPLOAD, HOOK_MENTION_SEARCH, HOOK_MENTION_INSERT, ATTACHMENT_RESOLVER } from './components/Editor.provider.js'\nimport { ACTION_ATTACHMENT_PROMPT } from './components/Editor/MediaHandler.provider.js'\n// eslint-disable-next-line import/no-unresolved, n/no-missing-import\nimport 'vite/modulepreload-polyfill'\n\nconst apiVersion = '1.1'\n\nVue.prototype.t = window.t\nVue.prototype.n = window.n\nVue.prototype.OCA = window.OCA\n\nwindow.OCA.Text = {\n\t...window.OCA.Text,\n}\n\nclass TextEditorEmbed {\n\n\t#vm\n\t#data\n\tconstructor(vm, data) {\n\t\tthis.#vm = vm\n\t\tthis.#data = data\n\t\tthis.#registerDebug()\n\t\treturn this\n\t}\n\n\t#getEditorComponent() {\n\t\treturn this.#vm.$children[0]\n\t}\n\n\tonLoaded(onLoadedCallback = () => {}) {\n\t\tthis.#vm.$on('ready', () => {\n\t\t\tonLoadedCallback()\n\t\t})\n\t\treturn this\n\t}\n\n\tonUpdate(onUpdateCallback = () => {}) {\n\t\tthis.#vm.$on('update:content', (content) => {\n\t\t\tonUpdateCallback(content)\n\t\t})\n\t\treturn this\n\t}\n\n\tonOutlineToggle(onOutlineToggleCallback = () => {}) {\n\t\tthis.#vm.$on('outline-toggled', (visible) => {\n\t\t\tonOutlineToggleCallback(visible)\n\t\t})\n\t\treturn this\n\t}\n\n\tonSearch(onSearchCallback = () => {}) {\n\t  subscribe('text:editor:search-results', onSearchCallback)\n\t  return this\n\t}\n\n\trender(el) {\n\t\tel.innerHTML = ''\n\t\tconst element = document.createElement('div')\n\t\tel.appendChild(element)\n\t\tthis.#vm.$mount(element)\n\t\treturn this\n\t}\n\n\tdestroy() {\n\t\tthis.#vm.$destroy()\n\t\tthis.#vm.$el.innerHTML = ''\n\t}\n\n\tsetContent(content) {\n\t\t// Update reactive prop for MarkdownContentEditor\n\t\tthis.#vm.$set(this.#data, 'content', content)\n\t\t// Call setContent for file based Editor\n\t\tthis.#getEditorComponent()?.setContent?.(content)\n\t\treturn this\n\t}\n\n\tsetSearchQuery(query, matchAll) {\n\t\tconst editor = this.#getEditorComponent()?.$editor\n\t\teditor.commands.setSearchQuery(query, matchAll)\n\t}\n\n\tsearchNext() {\n\t\tconst editor = this.#getEditorComponent()?.$editor\n\t\teditor.commands.nextMatch()\n\t}\n\n\tsearchPrevious() {\n\t\tconst editor = this.#getEditorComponent()?.$editor\n\t\teditor.commands.previousMatch()\n\t}\n\n\tasync save() {\n\t\treturn this.#getEditorComponent().save?.()\n\t}\n\n\tsetShowOutline(value) {\n\t\tthis.#vm.$set(this.#data, 'showOutlineOutside', value)\n\t\treturn this\n\t}\n\n\tsetReadOnly(value) {\n\t\tthis.#vm.$set(this.#data, 'readOnly', value)\n\t\treturn this\n\t}\n\n\tinsertAtCursor(content) {\n\t\tthis.#getEditorComponent().$editor.chain().insertContent(content).focus().run()\n\t}\n\n\tfocus() {\n\t\tthis.#getEditorComponent().$editor.commands.focus()\n\t}\n\n\t#registerDebug() {\n\t\tif (window?._oc_debug) {\n\t\t\tthis.vm = this.#vm\n\t\t\twindow.OCA.Text._debug = [\n\t\t\t\t...(window.OCA.Text._debug ?? []),\n\t\t\t\tthis,\n\t\t\t]\n\t\t}\n\t}\n\n}\n\nwindow.OCA.Text.apiVersion = apiVersion\nwindow.OCA.Text.createEditor = async function({\n\t// Element to render the editor to\n\tel,\n\n\t// Session editor with file mode is enabled by setting the fileId and useSession.\n\t// Otherwise, content needs to be provided.\n\tfileId = undefined,\n\tuseSession = true,\n\tfilePath = undefined,\n\tshareToken = null,\n\n\tcontent = '',\n\n\treadOnly = false,\n\tautofocus = true,\n\treadonlyBar = {\n\t\tcomponent: null,\n\t\tprops: null,\n\t},\n\n\tonLoaded = () => {},\n\tonUpdate = ({ markdown }) => {},\n\tonOutlineToggle = (visible) => {},\n\tonFileInsert = undefined,\n\tonMentionSearch = undefined,\n\tonMentionInsert = undefined,\n\tonSearch = undefined,\n}) {\n\tconst { default: MarkdownContentEditor } = await import(/* webpackChunkName: \"editor\" */'./components/Editor/MarkdownContentEditor.vue')\n\tconst { default: Editor } = await import(/* webpackChunkName: \"editor\" */'./components/Editor.vue')\n\n\tconst data = Vue.observable({\n\t\tshowOutlineOutside: false,\n\t\treadOnly,\n\t\tcontent,\n\t})\n\n\tconst sessionEditor = fileId && useSession\n\n\tconst vm = new Vue({\n\t\tprovide() {\n\t\t\treturn {\n\t\t\t\t[ACTION_ATTACHMENT_PROMPT]: onFileInsert,\n\t\t\t\t[EDITOR_UPLOAD]: !!sessionEditor,\n\t\t\t\t[HOOK_MENTION_SEARCH]: sessionEditor ? true : onMentionSearch,\n\t\t\t\t[HOOK_MENTION_INSERT]: sessionEditor ? true : onMentionInsert,\n\t\t\t\t[ATTACHMENT_RESOLVER]: {\n\t\t\t\t\tresolve(src, preferRaw) {\n\t\t\t\t\t\treturn [{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: src,\n\t\t\t\t\t\t}]\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\tdata() {\n\t\t\treturn data\n\t\t},\n\t\trender: h => {\n\t\t\tconst scopedSlots = readonlyBar?.component\n\t\t\t\t? {\n\t\t\t\t\treadonlyBar: () => {\n\t\t\t\t\t\treturn h(readonlyBar.component, {\n\t\t\t\t\t\t\tprops: readonlyBar.props,\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t\t: {}\n\n\t\t\treturn sessionEditor\n\t\t\t\t? h(Editor, {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tfileId,\n\t\t\t\t\t\trelativePath: filePath,\n\t\t\t\t\t\tshareToken,\n\t\t\t\t\t\tmime: 'text/markdown',\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tautofocus,\n\t\t\t\t\t\tshowOutlineOutside: data.showOutlineOutside,\n\t\t\t\t\t},\n\t\t\t\t\tscopedSlots,\n\t\t\t\t})\n\t\t\t\t: h(MarkdownContentEditor, {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tfileId,\n\t\t\t\t\t\tcontent: data.content,\n\t\t\t\t\t\trelativePath: filePath,\n\t\t\t\t\t\tshareToken,\n\t\t\t\t\t\treadOnly: data.readOnly,\n\t\t\t\t\t\tshowOutlineOutside: data.showOutlineOutside,\n\t\t\t\t\t},\n\t\t\t\t\tscopedSlots,\n\t\t\t\t})\n\t\t},\n\t\tstore,\n\t})\n\treturn new TextEditorEmbed(vm, data)\n\t\t.onLoaded(onLoaded)\n\t\t.onUpdate(onUpdate)\n\t\t.onOutlineToggle(onOutlineToggle)\n\t\t.onSearch(onSearch)\n\t\t.render(el)\n}\n"],"file":"js/text-editors.mjs"}