{"version":3,"file":"MediaHandler.provider-DkXa_6IX.chunk.mjs","sources":["../src/helpers/links.js","../src/components/Editor.provider.ts","../src/components/Editor/MediaHandler.provider.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\nimport { generateUrl } from '@nextcloud/router'\n\nconst domHref = function (node, relativePath) {\n\tconst ref = node.attrs.href\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tif (!window.OCA?.Viewer) {\n\t\treturn ref\n\t}\n\tif (ref.match(/^[a-zA-Z]*:/)) {\n\t\treturn ref\n\t}\n\tif (ref.startsWith('#')) {\n\t\treturn ref\n\t}\n\t// Don't rewrite links in collectives app context\n\tif (loadState('core', 'active-app', '') === 'collectives') {\n\t\treturn ref\n\t}\n\t// Don't rewrite links to the collectives app\n\tif (ref.includes('/apps/collectives/')) {\n\t\treturn ref\n\t}\n\n\t// Rewrite links with old format from file picker to `/f/<fileId>`\n\tconst match = ref.match(/^([^?]*)\\?fileId=(\\d+)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn new URL(generateUrl(`/f/${id}`), window.origin).href\n\t}\n\treturn ref\n}\n\nconst parseHref = function (dom) {\n\tconst ref = dom.getAttribute('href')\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tconst match = ref.match(/\\?dir=([^&]*)&openfile=([^&]*)#relPath=([^&]*)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn new URL(generateUrl(`/f/${id}`), window.origin).href\n\t}\n\treturn ref\n}\n\nconst isLinkToSelfWithHash = function (href) {\n\tconst locationNoHash =\n\t\twindow.location.origin + window.location.pathname + window.location.search\n\treturn href?.startsWith('#') || href?.startsWith(locationNoHash + '#')\n}\n\n/**\n * Open links, to be used as custom click handler\n *\n * @param {string} href the link href\n */\nconst openLink = function (href) {\n\tconst linkUrl = new URL(href, window.location.href)\n\t// Consider rerouting links to Collectives if already inside Collectives app\n\tconst collectivesUrlBase = '/apps/collectives'\n\tif (\n\t\twindow.OCA.Collectives?.vueRouter\n\t\t&& linkUrl.pathname.toString().startsWith(generateUrl(collectivesUrlBase))\n\t) {\n\t\tconst collectivesUrl = linkUrl.href.substring(\n\t\t\tlinkUrl.href.indexOf(collectivesUrlBase) + collectivesUrlBase.length,\n\t\t)\n\t\twindow.OCA.Collectives.vueRouter.push(collectivesUrl)\n\t\treturn\n\t}\n\twindow.open(linkUrl, '_blank')\n}\n\nexport { domHref, isLinkToSelfWithHash, openLink, parseHref }\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { openLink } from '../helpers/links.js'\nimport { logger } from '../helpers/logger.js'\n\nexport const FILE = Symbol('editor:file')\nexport const ATTACHMENT_RESOLVER = Symbol('attachment:resolver')\nexport const IS_MOBILE = Symbol('editor:is-mobile')\nexport const EDITOR_UPLOAD = Symbol('editor:upload')\nexport const HOOK_MENTION_SEARCH = Symbol('hook:mention-search')\nexport const HOOK_MENTION_INSERT = Symbol('hook:mention-insert')\nexport const OPEN_LINK_HANDLER = Symbol('editor:open-link-handler')\n\nexport const useIsMobileMixin = {\n\tinject: {\n\t\t$isMobile: { from: IS_MOBILE, default: false },\n\t},\n}\n\nexport const useFileMixin = {\n\tinject: {\n\t\t$file: {\n\t\t\tfrom: FILE,\n\t\t\tdefault: () => ({\n\t\t\t\tfileId: 0,\n\t\t\t\trelativePath: null,\n\t\t\t\tdocument: null,\n\t\t\t}),\n\t\t},\n\t},\n}\n\nexport const useAttachmentResolver = {\n\tinject: {\n\t\t$attachmentResolver: {\n\t\t\tfrom: ATTACHMENT_RESOLVER,\n\t\t\tdefault: {\n\t\t\t\tresolve(src: string) {\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t'No attachment resolver provided. Some attachment sources cannot be resolved.',\n\t\t\t\t\t)\n\t\t\t\t\treturn [src]\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n}\nexport const useEditorUpload = {\n\tinject: {\n\t\t$editorUpload: {\n\t\t\tfrom: EDITOR_UPLOAD,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useMentionHook = {\n\tinject: {\n\t\t$mentionHookInsert: {\n\t\t\tfrom: HOOK_MENTION_INSERT,\n\t\t\tdefault: true,\n\t\t},\n\t\t$mentionHookSearch: {\n\t\t\tfrom: HOOK_MENTION_SEARCH,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useOpenLinkHandler = {\n\tinject: {\n\t\t$openLinkHandler: {\n\t\t\tfrom: OPEN_LINK_HANDLER,\n\t\t\tdefault: {\n\t\t\t\topenLink,\n\t\t\t},\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport const STATE_UPLOADING = Symbol('state:uploading-state')\nexport const ACTION_ATTACHMENT_PROMPT = Symbol('editor:action:attachment-prompt')\nexport const ACTION_CHOOSE_LOCAL_ATTACHMENT = Symbol(\n\t'editor:action:upload-attachment',\n)\nexport const ACTION_CREATE_ATTACHMENT = Symbol('editor:action:create-attachment')\n\nexport const useUploadingStateMixin = {\n\tinject: {\n\t\t$uploadingState: {\n\t\t\tfrom: STATE_UPLOADING,\n\t\t\tdefault: {\n\t\t\t\tisUploadingAttachments: false,\n\t\t\t},\n\t\t},\n\t},\n}\n\nexport const useActionAttachmentPromptMixin = {\n\tinject: {\n\t\t$callAttachmentPrompt: { from: ACTION_ATTACHMENT_PROMPT, default: () => {} },\n\t},\n}\n\nexport const useActionChooseLocalAttachmentMixin = {\n\tinject: {\n\t\t$callChooseLocalAttachment: {\n\t\t\tfrom: ACTION_CHOOSE_LOCAL_ATTACHMENT,\n\t\t\tdefault: () => {},\n\t\t},\n\t},\n}\n\nexport const useActionCreateAttachmentMixin = {\n\tinject: {\n\t\t$callCreateAttachment: {\n\t\t\tfrom: ACTION_CREATE_ATTACHMENT,\n\t\t\tdefault: () => (template) => {},\n\t\t},\n\t},\n}\n"],"names":[],"mappings":"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"}