import{f as T,r as F,c as w,p as et,e as Tt,w as Dt,i as Bt,V as Ht,k as Y}from"./vue.runtime.esm-C6p0QIhY.chunk.mjs";import{I as Q,J as Rt,K as j,L as Wt,M as Lt,O as Z,Q as K,S as Vt,T as Kt,V as G,W as tt,w as pt,u as mt,X as Ut,Y as gt,Z as zt,_ as jt,$ as qt,a0 as Jt,a1 as nt,r as U,a2 as Xt,a3 as Yt,a4 as it,a5 as Qt,a6 as Zt,a7 as Gt,a8 as te,a9 as ee,aa as ne,ab as ie,l as D,E as se,b as oe,ac as ft,j as re,ad as ae,ae as le,af as de,ag as ce,ah as ue,ai as he,aj as pe,ak as me,al as ge,am as fe,an as q,ao as ve,ap as ye}from"./EditorOutline-CJaAQE7w.chunk.mjs";import{n as vt,G as yt,t as N,c as B,k as st}from"./NcLoadingIcon-BLBsV_jd.chunk.mjs";import{u as _t,c as _e,S as be,d as ke,e as xe,b as Ce,f as Ee}from"./MediaHandler.provider-Co_8hElS.chunk.mjs";import{n as _,u as Me}from"./NcCheckboxRadioSwitch-DAPHFb0L-CV26DpRz.chunk.mjs";import{g as O,b as we}from"./index-DCzdQJ7L.chunk.mjs";import{g as Ae}from"./emoji-picker-hi3Hwbeu.chunk.mjs";import{g as Se,h as $e,u as bt,d as Oe,N as kt,s as I}from"./NcNoteCard-Dz5-u2BY-BFR1Ui_6.chunk.mjs";import{s as xt,e as Ct,g as Ne,u as Pe}from"./index-CdM8BgQf.chunk.mjs";import{l as W}from"./logger-JRW888D7.chunk.mjs";import{l as Fe}from"./index-B8nYQ_zQ.chunk.mjs";var Bi=Q.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null,provider:null}},addStorage(){return{isDisabled:!1}},onCreate(){this.editor.extensionManager.extensions.find(e=>e.name==="undoRedo")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-undo-redo".')},addCommands(){return{undo:()=>({tr:e,state:n,dispatch:i})=>(e.setMeta("preventDispatch",!0),j.getState(n).undoManager.undoStack.length===0?!1:i?Kt(n):!0),redo:()=>({tr:e,state:n,dispatch:i})=>(e.setMeta("preventDispatch",!0),j.getState(n).undoManager.redoStack.length===0?!1:i?Vt(n):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){var e;const n=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),i=Rt(this.options.yUndoOptions),s=i.spec.view;i.spec.view=l=>{const{undoManager:a}=j.getState(l.state);a.restore&&(a.restore(),a.restore=()=>{});const c=s?s(l):void 0;return{destroy:()=>{const d=a.trackedOrigins.has(a),u=a._observers;a.restore=()=>{d&&a.trackedOrigins.add(a),a.doc.on("afterTransaction",a.afterTransactionHandler),a._observers=u},c?.destroy&&c.destroy()}}};const o={...this.options.ySyncOptions,onFirstRender:this.options.onFirstRender},r=Wt(n,o);return this.editor.options.enableContentCheck&&((e=n.doc)==null||e.on("beforeTransaction",()=>{try{const l=Lt(n);if(l.content.length===0)return;this.editor.schema.nodeFromJSON(l).check()}catch(l){return this.editor.emit("contentError",{error:l,editor:this.editor,disableCollaboration:()=>{var a;(a=n.doc)==null||a.destroy(),this.storage.isDisabled=!0}}),!1}})),[r,i,this.editor.options.enableContentCheck&&new Z({key:new K("filterInvalidContent"),filterTransaction:()=>{var l;return this.storage.isDisabled!==!1&&((l=n.doc)==null||l.destroy()),!0}})].filter(Boolean)}});function Ie(e){return!!e.getMeta(G)}const Te=T({name:"NcDialog",components:{NcDialogButton:$e,NcModal:Se},props:{name:{type:String,required:!0},message:{type:String,default:""},additionalTrapElements:{type:Array,validator:e=>Array.isArray(e)&&e.every(n=>typeof n=="string"||n instanceof HTMLElement),default:()=>[]},container:{type:String,required:!1,default:"body"},open:{type:Boolean,default:!0},size:{type:String,required:!1,default:"small",validator:e=>typeof e=="string"&&["small","normal","large","full"].includes(e)},buttons:{type:Array,required:!1,default:()=>[],validator:e=>Array.isArray(e)&&e.every(n=>typeof n=="object")},noClose:{type:Boolean,default:!1},canClose:{type:Boolean,default:!0},closeOnClickOutside:{type:Boolean,default:!1},isForm:{type:Boolean,default:!1},outTransition:{type:Boolean,default:!1},navigationClasses:{type:[String,Array,Object],required:!1,default:""},navigationAriaLabel:{type:String,required:!1,default:""},navigationAriaLabelledby:{type:String,required:!1,default:""},contentClasses:{type:[String,Array,Object],required:!1,default:""},dialogClasses:{type:[String,Array,Object],required:!1,default:""}},emits:["closing","update:open","submit"],setup(e,{emit:n,slots:i}){const s=F(),{width:o}=bt(s,{width:900}),r=w(()=>o.value<876),l=w(()=>i?.navigation!==void 0),a=yt(),c=w(()=>e.navigationAriaLabel||void 0),d=w(()=>{if(!e.navigationAriaLabel)return e.navigationAriaLabelledby||a}),u=F(),h=w(()=>e.isForm&&!l.value?"form":"div"),f=w(()=>h.value==="form"?{submit(y){y.preventDefault(),n("submit",y)},reset(y){y.preventDefault(),n("reset",y)}}:{}),p=F(!0);function m(y,H){(y.type==="submit"||y.nativeType==="submit")&&h.value==="form"&&!u.value.reportValidity()||(v(H),window.setTimeout(()=>k(),300))}function v(y){p.value=!1,n("closing",y)}function k(){p.value=!0,n("update:open",!1)}const C=w(()=>({noClose:e.noClose||!e.canClose,container:e.container===void 0?"body":e.container,labelId:a,size:e.size,show:e.open&&p.value,outTransition:e.outTransition,closeOnClickOutside:e.closeOnClickOutside,additionalTrapElements:e.additionalTrapElements}));return{dialogElement:u,dialogListeners:f,dialogTagName:h,handleButtonClose:m,handleClosing:v,handleClosed:k,hasNavigation:l,navigationId:a,navigationAriaLabelAttr:c,navigationAriaLabelledbyAttr:d,isNavigationCollapsed:r,modalProps:C,wrapper:s}}});var De=function(){var e=this,n=e._self._c;return e._self._setupProxy,e.open?n("NcModal",e._b({staticClass:"dialog__modal",attrs:{"enable-slideshow":!1,"enable-swipe":!1},on:{close:e.handleClosed,"update:show":function(i){return e.handleClosing()}}},"NcModal",e.modalProps,!1),[n("h2",{staticClass:"dialog__name",attrs:{id:e.navigationId},domProps:{textContent:e._s(e.name)}}),n(e.dialogTagName,e._g({ref:"dialogElement",tag:"component",staticClass:"dialog",class:e.dialogClasses},e.dialogListeners),[n("div",{ref:"wrapper",staticClass:"dialog__wrapper",class:{"dialog__wrapper--collapsed":e.isNavigationCollapsed}},[e.hasNavigation?n("nav",{staticClass:"dialog__navigation",class:e.navigationClasses,attrs:{"aria-label":e.navigationAriaLabelAttr,"aria-labelledby":e.navigationAriaLabelledbyAttr}},[e._t("navigation",null,{isCollapsed:e.isNavigationCollapsed})],2):e._e(),n("div",{staticClass:"dialog__content",class:e.contentClasses},[e._t("default",function(){return[n("p",{staticClass:"dialog__text"},[e._v(" "+e._s(e.message)+" ")])]})],2)]),n("div",{staticClass:"dialog__actions"},[e._t("actions",function(){return e._l(e.buttons,function(i,s){return n("NcDialogButton",e._b({key:s,on:{click:(o,r)=>e.handleButtonClose(i,r)}},"NcDialogButton",i,!1))})})],2)])],1):e._e()},Be=[],He=vt(Te,De,Be,!1,null,"66c29e13");const Re=He.exports,We={name:"NcActionButton",components:{NextcloudVueNcActionButton:pt},extends:tt,mounted(){this.editor?.on("transaction",()=>this.updateState())},methods:{runAction(){const{actionEntry:e}=this;e.click?e.click(this):e.action(this.editor?.chain().focus(),this.editor)?.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Le=function(){var e=this,n=e._self._c;return n("NextcloudVueNcActionButton",e._g({staticClass:"entry-single-action entry-action entry-action-item",class:e.state.class,attrs:{title:e.listItemTooltip||void 0,disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"model-value":e.actionType!=="button"?e.state.active:void 0,"close-after-click":""},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[n(e.icon,{tag:"component"})]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.label)+" ")])},Ve=[],Ke=_(We,Le,Ve,!1,null,null);const Ue=Ke.exports,ze={name:"ActionList",components:{NcActions:Oe,NcActionSeparator:gt,ActionListItem:Ue},extends:tt,mixins:[mt,Ut],props:{forceEnabled:{type:Boolean,default:!1}},data:()=>({visible:!1,hasEnabledChild:!0}),computed:{currentChild(){const{state:e,editor:n,actionEntry:{children:i}}=this;return e.active?i.find(s=>qt(s,n)):null},icon(){return this.currentChild?this.currentChild.icon:this.actionEntry.icon},iconKey(){return`${this.actionEntry.key}/${this.activeKey}`},activeKey(){return this.currentChild?.key},children(){return this.actionEntry.children.filter(({visible:e})=>e===void 0?!0:typeof e=="function"?e(this):e)},labelWithSelected(){return this.currentChild?N("text",'{menuItemName}, "{selectedSubMenuItemName}" is selected',{menuItemName:this.actionEntry.label,selectedSubMenuItemName:this.currentChild.label}):this.actionEntry.label},isEnabled(){return this.forceEnabled||this.hasEnabledChild}},mounted(){this.$_updateState=jt(this.checkStateOfChildren.bind(this),50),this.editor?.on("update",this.$_updateState),this.editor?.on("selectionUpdate",this.$_updateState)},beforeDestroy(){this.editor?.off("update",this.$_updateState),this.editor?.off("selectionUpdate",this.$_updateState)},methods:{onOpenChange(e){this.visible=e},runAction(){},onTrigger(e){e?.click||(this.editor?.chain().focus().run(),this.$emit("trigged",e))},checkStateOfChildren(){this.hasEnabledChild=this.children.some(e=>this.isChildEnabled(e))},isChildEnabled(e){return!e.isSeparator&&!zt(e,this.editor).disabled}}};var je=function(){var e=this,n=e._self._c;return n("NcActions",e._b({staticClass:"entry-list-action entry-action",attrs:{title:e.tooltip,container:e.menuIDSelector,"aria-label":e.labelWithSelected,variant:e.state.active?"primary":"tertiary","force-menu":!0,"data-text-action-entry":e.actionEntry.key,"data-text-action-active":e.activeKey,disabled:!e.isEnabled},on:{"update:open":e.onOpenChange},scopedSlots:e._u([{key:"icon",fn:function(){return[n(e.icon,{key:e.iconKey,tag:"component"})]},proxy:!0}])},"NcActions",e.state,!1),[e._l(e.children,function(i){return[i.isSeparator?n("NcActionSeparator",{key:`child-${i.key}`}):n("ActionListItem",e._g({key:`child-${i.key}`,attrs:{active:e.currentChild?.key===i.key,"is-item":"","action-entry":i},on:{trigged:e.onTrigger}},e.$listeners))]}),e._t("lastAction",null,null,{visible:e.visible})],2)},qe=[],Je=_(ze,je,qe,!1,null,null);const Et=Je.exports,Xe={name:"ActionSingle",components:{NcButton:kt},extends:tt,props:{isItem:{type:Boolean,default:!1}},mounted(){this.editor?.on("transaction",()=>this.updateState())},methods:{runAction(){const{actionEntry:e}=this;e.click?e.click(this):e.action(this.editor?.chain().focus(),this.editor)?.run(),this.$nextTick(()=>{this.$emit("trigged",{...e})})}}};var Ye=function(){var e=this,n=e._self._c;return n("NcButton",e._g({staticClass:"entry-single-action entry-action",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"aria-label":e.label,title:e.tooltip,variant:"tertiary",pressed:e.actionType!=="button"?e.state.active:void 0},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[n(e.icon,{tag:"component"})]},proxy:!0},e.actionEntry.forceLabel?{key:"default",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0}:null],null,!0)},e.$listeners))},Qe=[],Ze=_(Xe,Ye,Qe,!1,null,null);const Mt=Ze.exports,wt=T({data(){return{activeMenuEntry:0,entries:[]}},computed:{visibleEntries(){return this.entries}},watch:{visibleEntries(){this.$nextTick(()=>{(this.activeMenuEntry>this.visibleEntries.length||this.visibleEntries[this.activeMenuEntry]?.disabled)&&this.setNextMenuEntry()})}},methods:{disableMenuEntry(e,n){const i=this.visibleEntries.findIndex(({key:s})=>s===e);this.visibleEntries[i].disabled=n,n===!1&&this.activeMenuEntry===i&&this.$nextTick(()=>this.setNextMenuEntry())},setNextMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do this.activeMenuEntry=(this.activeMenuEntry+1)%e;while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},setPreviousMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do{const n=this.activeMenuEntry-1;this.activeMenuEntry=(n%e+e)%e}while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},handleToolbarNavigation(e){e.key==="ArrowRight"?this.setNextMenuEntry():e.key==="ArrowLeft"&&this.setPreviousMenuEntry(),this.activeMenuEntry===this.visibleEntries.length?this.$refs.remainingEntries?.focusButton?.():[...this.$refs.menuEntries].sort((n,i)=>this.visibleEntries.findIndex(({key:s})=>s===n.$vnode.data.key)-this.visibleEntries.findIndex(({key:s})=>s===i.$vnode.data.key))[this.activeMenuEntry].focusButton()}}}),Ge=T({name:"ReadonlyBar",components:{ActionList:Et,ActionSingle:Mt},extends:wt,mixins:[_t],props:{isHidden:{type:Boolean,default:!1},openReadOnly:{type:Boolean,default:!1}},emits:["update:loaded"],setup(){const{isRichWorkspace:e}=U();return{isRichWorkspace:e}},data(){return{entries:this.openReadOnly?[...Jt,...nt]:[...nt],isReady:!1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{t:N}});var tn=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("div",{staticClass:"text-readonly-bar",class:{"text-readonly-bar--ready":e.isReady,"text-readonly-bar--is-workspace":e.isRichWorkspace,"text-readonly-bar--hide":e.isHidden,"is-mobile":e.$isMobile},attrs:{"data-text-el":"readonly-bar"}},[n("div",{ref:"menubar",staticClass:"text-readonly-bar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Editor actions")}},e._l(e.visibleEntries,function(i,s){return n(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(o){return e.disableMenuEntry(i.key,o)}}})}),1),n("div",{staticClass:"text-readonly-bar__slot"},[e._t("default")],2)])},en=[],nn=_(Ge,tn,en,!1,null,"988a9965");const Hi=nn.exports;let ot=Fe("text","is_full_width_editor",!1);const X=Symbol("text:editor:width");function sn(){const e=getComputedStyle(document.body).getPropertyValue("--text-editor-max-width"),n=document.documentElement.style.getPropertyValue("--text-editor-max-width");return!!e&&e!==n}const Ri=()=>{if(sn())return et(X,null),{applyEditorWidth:()=>{}};const e=F(ot);et(X,Tt(e)),xt("text:editor:full-width",({value:s})=>{ot=s,e.value=s});const n=w(()=>e.value?"100%":"80ch"),i=()=>{document.documentElement.style.setProperty("--text-editor-max-width",n.value)};return Dt(n,i),{applyEditorWidth:i}},At=()=>{const e=Bt(X);return e===null?{canToggleWidth:!1}:{canToggleWidth:!0,isFullWidth:e,setFullWidth:n=>{B.post(O("/apps/text/settings"),{key:"is_full_width_editor",value:n?"1":"0"}),Ct("text:editor:full-width",{value:n})}}},on={name:"NcActionCheckbox",mixins:[Xt],inject:{isInSemanticMenu:{from:"NcActions:isSemanticMenu",default:!1}},model:{prop:"modelValue",event:"update:modelValue"},props:{id:{type:String,default:()=>"action-"+yt(),validator:e=>e.trim()!==""},checked:{type:Boolean,default:void 0},modelValue:{type:Boolean,default:!1},value:{type:[String,Number],default:""},disabled:{type:Boolean,default:!1}},emits:["change","check","uncheck","update:checked","update:modelValue","update:model-value"],setup(){return{model:Me("checked","update:checked")}},computed:{isFocusable(){return!this.disabled},ariaChecked(){if(this.isInSemanticMenu)return this.model?"true":"false"}},methods:{checkInput(){this.$refs.label.click()},onChange(e){this.model=this.$refs.checkbox.checked,this.$emit("change",e),this.$refs.checkbox.checked?this.$emit("check"):this.$emit("uncheck")}}};var rn=function(){var e=this,n=e._self._c;return n("li",{staticClass:"action",class:{"action--disabled":e.disabled},attrs:{role:e.isInSemanticMenu&&"presentation"}},[n("span",{staticClass:"action-checkbox",attrs:{role:e.isInSemanticMenu&&"menuitemcheckbox","aria-checked":e.ariaChecked}},[n("input",{ref:"checkbox",staticClass:"checkbox action-checkbox__checkbox",class:{focusable:e.isFocusable},attrs:{id:e.id,disabled:e.disabled,type:"checkbox"},domProps:{checked:e.model,value:e.value},on:{keydown:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")||i.ctrlKey||i.shiftKey||i.altKey||i.metaKey?null:(i.preventDefault(),e.checkInput.apply(null,arguments))},change:e.onChange}}),n("label",{ref:"label",staticClass:"action-checkbox__label",attrs:{for:e.id}},[e._v(e._s(e.text))]),e._e()],2)])},an=[],ln=vt(on,rn,an,!1,null,"73edcb0b");const dn=ln.exports;var rt={},at;function cn(){return at||(at=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.normalize=void 0;const n=47,i=46,s=a=>{const c=typeof a;if(c!=="string")throw new TypeError(`Expected a string, got a ${c}`)},o=(a,c)=>{let d="",u=0,h=-1,f=0,p;for(let m=0;m<=a.length;++m){if(m<a.length)p=a.charCodeAt(m);else{if(p===n)break;p=n}if(p===n){if(!(h===m-1||f===1))if(h!==m-1&&f===2){if(d.length<2||u!==2||d.charCodeAt(d.length-1)!==i||d.charCodeAt(d.length-2)!==i){if(d.length>2){const v=d.lastIndexOf("/");if(v!==d.length-1){v===-1?(d="",u=0):(d=d.slice(0,v),u=d.length-1-d.lastIndexOf("/")),h=m,f=0;continue}}else if(d.length===2||d.length===1){d="",u=0,h=m,f=0;continue}}c&&(d.length>0?d+="/..":d="..",u=2)}else d.length>0?d+="/"+a.slice(h+1,m):d=a.slice(h+1,m),u=m-h-1;h=m,f=0}else p===i&&f!==-1?++f:f=-1}return d},r=a=>{try{return decodeURIComponent(a)}catch{return a}},l=a=>{s(a);let c=a;if(c.length===0)return".";const d=c.charCodeAt(0)===n,u=c.charCodeAt(c.length-1)===n;return c=r(c),c=o(c,!d),c.length===0&&!d&&(c="."),c.length>0&&u&&(c+="/"),d?"/"+c:c};e.normalize=l,e.default=e.normalize})(rt)),rt}var un=cn();const hn=Ae(un);class Wi{#t;#e;#n;#i;#s;#o;#r=[];constructor({session:n,user:i,shareToken:s,currentDirectory:o,fileId:r}){this.#t=n,this.#e=i,this.#n=s,this.#i=o,this.#s=r??n.documentId,this.#o=this.#a()}async#a(){const n=await B.post(O("/apps/text/attachments"),{documentId:this.#t?.documentId??this.#s,sessionId:this.#t?.id,sessionToken:this.#t?.token,shareToken:this.#n});this.#r=n.data}#l(n){return this.#r.find(i=>i.name===n)}async resolve(n,i=!0){let s;const o=/^\.attachments\.\d+\//;if(n.match(o)){const r=decodeURIComponent(n.replace(o,"").split("?")[0]);if(await this.#o,s=this.#l(r),i&&!s&&(await this.#a(),s=this.#l(r)),s)return s}return pn(n)?{isImage:!0,name:this.#d(n),previewUrl:n,fullUrl:n}:{isImage:!0,name:this.#d(n),previewUrl:this.#c(n),fullUrl:this.#c(n)}}#d(n){return n.split("/").pop()}#c(n){if(this.#e){const r=this.#e.uid,l=this.#u(n).split("/").map(encodeURIComponent).join("/");return we(`dav/files/${r}${l}`)}const i=this.#u(n).split("/"),s=i.pop(),o=i.join("/");return O("/s/{token}/download?path={dirname}&files={basename}",{token:this.#n,basename:s,dirname:o})}#h(n){return decodeURI(n.split("?")[0])}#u(n){const i=[this.#i,this.#h(n)].join("/");return hn(i)}}function pn(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")}function lt(e){if(!e.length)return it.empty;const n=[],i=e[0].$from.node(0);return e.forEach(s=>{const o=s.$from.pos,r=s.$from.nodeAfter;r&&n.push(Qt.node(o,o+r.nodeSize,{class:"ProseMirror-selectednoderange"}))}),it.create(i,n)}function z(e,n,i){const s=[],o=e.node(0);typeof i=="number"&&i>=0||(e.sameParent(n)?i=Math.max(0,e.sharedDepth(n.pos)-1):i=e.sharedDepth(n.pos));const r=new Zt(e,n,i),l=r.depth===0?0:o.resolve(r.start).posAtIndex(0);return r.parent.forEach((a,c)=>{const d=l+c,u=d+a.nodeSize;if(d<r.start||d>=r.end)return;const h=new Gt(o.resolve(d),o.resolve(u));s.push(h)}),s}var mn=class St{constructor(n,i){this.anchor=n,this.head=i}map(n){return new St(n.map(this.anchor),n.map(this.head))}resolve(n){const i=n.resolve(this.anchor),s=n.resolve(this.head);return new S(i,s)}},S=class A extends Yt{constructor(n,i,s,o=1){const{doc:r}=n,l=n===i,a=n.pos===r.content.size&&i.pos===r.content.size,c=l&&!a?r.resolve(i.pos+(o>0?1:-1)):i,d=l&&a?r.resolve(n.pos-(o>0?1:-1)):n,u=z(d.min(c),d.max(c),s),h=c.pos>=n.pos?u[0].$from:u[u.length-1].$to,f=c.pos>=n.pos?u[u.length-1].$to:u[0].$from;super(h,f,u),this.depth=s}get $to(){return this.ranges[this.ranges.length-1].$to}eq(n){return n instanceof A&&n.$from.pos===this.$from.pos&&n.$to.pos===this.$to.pos}map(n,i){const s=n.resolve(i.map(this.anchor)),o=n.resolve(i.map(this.head));return new A(s,o)}toJSON(){return{type:"nodeRange",anchor:this.anchor,head:this.head}}get isForwards(){return this.head>=this.anchor}get isBackwards(){return!this.isForwards}extendBackwards(){const{doc:n}=this.$from;if(this.isForwards&&this.ranges.length>1){const o=this.ranges.slice(0,-1),r=o[0].$from,l=o[o.length-1].$to;return new A(r,l,this.depth)}const i=this.ranges[0],s=n.resolve(Math.max(0,i.$from.pos-1));return new A(this.$anchor,s,this.depth)}extendForwards(){const{doc:n}=this.$from;if(this.isBackwards&&this.ranges.length>1){const o=this.ranges.slice(1),r=o[0].$from,l=o[o.length-1].$to;return new A(l,r,this.depth)}const i=this.ranges[this.ranges.length-1],s=n.resolve(Math.min(n.content.size,i.$to.pos+1));return new A(this.$anchor,s,this.depth)}static fromJSON(n,i){return new A(n.resolve(i.anchor),n.resolve(i.head))}static create(n,i,s,o,r=1){return new this(n.resolve(i),n.resolve(s),o,r)}getBookmark(){return new mn(this.anchor,this.head)}};S.prototype.visible=!1;function L(e){return e instanceof S}Q.create({name:"nodeRange",addOptions(){return{depth:void 0,key:"Mod"}},addKeyboardShortcuts(){return{"Shift-ArrowUp":({editor:e})=>{const{depth:n}=this.options,{view:i,state:s}=e,{doc:o,selection:r,tr:l}=s,{anchor:a,head:c}=r;if(!L(r)){const u=S.create(o,a,c,n,-1);return l.setSelection(u),i.dispatch(l),!0}const d=r.extendBackwards();return l.setSelection(d),i.dispatch(l),!0},"Shift-ArrowDown":({editor:e})=>{const{depth:n}=this.options,{view:i,state:s}=e,{doc:o,selection:r,tr:l}=s,{anchor:a,head:c}=r;if(!L(r)){const u=S.create(o,a,c,n);return l.setSelection(u),i.dispatch(l),!0}const d=r.extendForwards();return l.setSelection(d),i.dispatch(l),!0},"Mod-a":({editor:e})=>{const{depth:n}=this.options,{view:i,state:s}=e,{doc:o,tr:r}=s,l=S.create(o,0,o.content.size,n);return r.setSelection(l),i.dispatch(r),!0}}},onSelectionUpdate(){const{selection:e}=this.editor.state;L(e)&&this.editor.view.dom.classList.add("ProseMirror-noderangeselection")},addProseMirrorPlugins(){let e=!1,n=!1;return[new Z({key:new K("nodeRange"),props:{attributes:()=>e?{class:"ProseMirror-noderangeselection"}:{class:""},handleDOMEvents:{mousedown:(i,s)=>{const{key:o}=this.options,r=/Mac/.test(navigator.platform),l=!!s.shiftKey,a=!!s.ctrlKey,c=!!s.altKey,d=!!s.metaKey,u=r?d:a;return(o==null||o==="Shift"&&l||o==="Control"&&a||o==="Alt"&&c||o==="Meta"&&d||o==="Mod"&&u)&&(n=!0),n&&document.addEventListener("mouseup",()=>{n=!1;const{state:h}=i,{doc:f,selection:p,tr:m}=h,{$anchor:v,$head:k}=p;if(v.sameParent(k))return;const C=S.create(f,v.pos,k.pos,this.options.depth);m.setSelection(C),i.dispatch(m)},{once:!0}),!1}},decorations:i=>{const{selection:s}=i,o=L(s);if(e=!1,!n)return o?(e=!0,lt(s.ranges)):null;const{$from:r,$to:l}=s;if(!o&&r.sameParent(l))return null;const a=z(r,l,this.options.depth);return a.length?(e=!0,lt(a)):null}}})]}});function gn(e){let n="";const i=getComputedStyle(e);for(let s=0;s<i.length;s+=1)n+=`${i[s]}:${i.getPropertyValue(i[s])};`;return n}function fn(e){const n=e.cloneNode(!0),i=[e,...Array.from(e.getElementsByTagName("*"))],s=[n,...Array.from(n.getElementsByTagName("*"))];return i.forEach((o,r)=>{s[r].style.cssText=gn(o)}),n}function vn(e,n){let i=e;for(;i?.parentElement&&i.parentElement!==n.dom;)i=i.parentElement;return i?.parentElement===n.dom?i:void 0}function yn(e,n,i,s=5){const o=e.dom,r=o.firstElementChild,l=o.lastElementChild;if(!r||!l)return{x:n,y:i};const a=r.getBoundingClientRect(),c=l.getBoundingClientRect(),d=Math.min(Math.max(a.top+s,i),c.bottom-s),u=.5,h=Math.abs(a.left-c.left)<u,f=Math.abs(a.right-c.right)<u;let p=a;return h&&f&&(p=a),{x:Math.min(Math.max(p.left+s,n),p.right-s),y:d}}var $t=e=>{const{x:n,y:i,editor:s}=e,{view:o,state:r}=s,{x:l,y:a}=yn(o,n,i,5),c=o.root.elementsFromPoint(l,a);let d;if(Array.prototype.some.call(c,f=>{if(!o.dom.contains(f))return!1;const p=vn(f,o);return p?(d=p,!0):!1}),!d)return{resultElement:null,resultNode:null,pos:null};let u;try{u=o.posAtDOM(d,0)}catch{return{resultElement:null,resultNode:null,pos:null}}const h=r.doc.nodeAt(u);return{resultElement:d,resultNode:h,pos:u}};function V(e,n){return window.getComputedStyle(e)[n]}function _n(e=0,n=0,i=0){return Math.min(Math.max(e,n),i)}function bn(e,n,i){const s=parseInt(V(e.dom,"paddingLeft"),10),o=parseInt(V(e.dom,"paddingRight"),10),r=parseInt(V(e.dom,"borderLeftWidth"),10),l=parseInt(V(e.dom,"borderLeftWidth"),10),a=e.dom.getBoundingClientRect();return{left:_n(n,a.left+s+r,a.right-o-l),top:i}}function Ot(e){var n;(n=e.parentNode)==null||n.removeChild(e)}function kn(e,n){const{doc:i}=n.view.state,s=$t({editor:n,x:e.clientX,y:e.clientY});if(!s.resultNode||s.pos===null)return[];const o=e.clientX,r=bn(n.view,o,e.clientY),l=n.view.posAtCoords(r);if(!l)return[];const{pos:a}=l;if(!i.resolve(a).parent)return[];const c=i.resolve(s.pos),d=i.resolve(s.pos+1);return z(c,d,0)}function xn(e,n){const{view:i}=n;if(!e.dataTransfer)return;const{empty:s,$from:o,$to:r}=i.state.selection,l=kn(e,n),a=z(o,r,0),c=a.some(k=>l.find(C=>C.$from===k.$from&&C.$to===k.$to)),d=s||!c?l:a;if(!d.length)return;const{tr:u}=i.state,h=document.createElement("div"),f=d[0].$from.pos,p=d[d.length-1].$to.pos,m=S.create(i.state.doc,f,p),v=m.content();d.forEach(k=>{const C=i.nodeDOM(k.$from.pos),y=fn(C);h.append(y)}),h.style.position="absolute",h.style.top="-10000px",document.body.append(h),e.dataTransfer.clearData(),e.dataTransfer.setDragImage(h,0,0),i.dragging={slice:v,move:!0},u.setSelection(m),i.dispatch(u),document.addEventListener("drop",()=>Ot(h),{once:!0})}var dt=(e,n)=>{const i=e.resolve(n),{depth:s}=i;return s===0?n:i.pos-i.parentOffset-1},ct=(e,n)=>{const i=e.nodeAt(n),s=e.resolve(n);let{depth:o}=s,r=i;for(;o>0;){const l=s.node(o);o-=1,o===0&&(r=l)}return r},J=(e,n)=>{const i=G.getState(e);return i?te(n,i.type,i.binding.mapping):null},Cn=(e,n)=>{const i=G.getState(e);return i?ne(i.doc,i.type,n,i.binding.mapping)||0:-1},ut=(e,n)=>{let i=n;for(;i?.parentNode&&i.parentNode!==e.dom;)i=i.parentNode;return i},Nt=new K("dragHandle"),Pt=({pluginKey:e=Nt,element:n,editor:i,computePositionConfig:s,getReferencedVirtualElement:o,onNodeChange:r,onElementDragStart:l,onElementDragEnd:a})=>{const c=document.createElement("div");let d=!1,u=null,h=-1,f,p=null,m=null;function v(){n&&(n.style.visibility="hidden",n.style.pointerEvents="none")}function k(){if(n){if(!i.isEditable){v();return}n.style.visibility="",n.style.pointerEvents="auto"}}function C(g){const b=o?.()||{getBoundingClientRect:()=>g.getBoundingClientRect()};ee(b,n,s).then($=>{Object.assign(n.style,{position:$.strategy,left:`${$.x}px`,top:`${$.y}px`})})}function y(g){l?.(g),xn(g,i),setTimeout(()=>{n&&(n.style.pointerEvents="none")},0)}function H(g){a?.(g),v(),n&&(n.style.pointerEvents="auto")}return n.addEventListener("dragstart",y),n.addEventListener("dragend",H),c.appendChild(n),{unbind(){n.removeEventListener("dragstart",y),n.removeEventListener("dragend",H),p&&(cancelAnimationFrame(p),p=null,m=null)},plugin:new Z({key:typeof e=="string"?new K(e):e,state:{init(){return{locked:!1}},apply(g,b,$,P){const x=g.getMeta("lockDragHandle"),E=g.getMeta("hideDragHandle");if(x!==void 0&&(d=x),E)return v(),d=!1,u=null,h=-1,r?.({editor:i,node:null,pos:-1}),b;if(g.docChanged&&h!==-1&&n)if(Ie(g)){const M=Cn(P,f);M!==h&&(h=M)}else{const M=g.mapping.map(h);M!==h&&(h=M,f=J(P,h))}return b}},view:g=>{var b;return n.draggable=!0,n.style.pointerEvents="auto",(b=i.view.dom.parentElement)==null||b.appendChild(c),c.style.pointerEvents="none",c.style.position="absolute",c.style.top="0",c.style.left="0",{update($,P){if(!n)return;if(!i.isEditable){v();return}if(d?n.draggable=!1:n.draggable=!0,g.state.doc.eq(P.doc)||h===-1)return;let x=g.nodeDOM(h);if(x=ut(g,x),x===g.dom||x?.nodeType!==1)return;const E=g.posAtDOM(x,0),M=ct(i.state.doc,E),R=dt(i.state.doc,E);u=M,h=R,f=J(g.state,h),r?.({editor:i,node:u,pos:h}),C(x)},destroy(){p&&(cancelAnimationFrame(p),p=null,m=null),n&&Ot(c)}}},props:{handleDOMEvents:{keydown(g){return!n||d||g.hasFocus()&&(v(),u=null,h=-1,r?.({editor:i,node:null,pos:-1})),!1},mouseleave(g,b){return d||b.target&&!c.contains(b.relatedTarget)&&(v(),u=null,h=-1,r?.({editor:i,node:null,pos:-1})),!1},mousemove(g,b){return!n||d||(m={x:b.clientX,y:b.clientY},p)||(p=requestAnimationFrame(()=>{if(p=null,!m)return;const{x:$,y:P}=m;m=null;const x=$t({x:$,y:P,editor:i});if(!x.resultElement)return;let E=x.resultElement;if(E=ut(g,E),E===g.dom||E?.nodeType!==1)return;const M=g.posAtDOM(E,0),R=ct(i.state.doc,M);if(R!==u){const It=dt(i.state.doc,M);u=R,h=It,f=J(g.state,h),r?.({editor:i,node:u,pos:h}),C(E),k()}})),!1}}}})}},Ft={placement:"left-start",strategy:"absolute"};Q.create({name:"dragHandle",addOptions(){return{render(){const e=document.createElement("div");return e.classList.add("drag-handle"),e},computePositionConfig:{},locked:!1,onNodeChange:()=>null,onElementDragStart:void 0,onElementDragEnd:void 0}},addCommands(){return{lockDragHandle:()=>({editor:e})=>(this.options.locked=!0,e.commands.setMeta("lockDragHandle",this.options.locked)),unlockDragHandle:()=>({editor:e})=>(this.options.locked=!1,e.commands.setMeta("lockDragHandle",this.options.locked)),toggleDragHandle:()=>({editor:e})=>(this.options.locked=!this.options.locked,e.commands.setMeta("lockDragHandle",this.options.locked))}},addProseMirrorPlugins(){const e=this.options.render();return[Pt({computePositionConfig:{...Ft,...this.options.computePositionConfig},getReferencedVirtualElement:this.options.getReferencedVirtualElement,element:e,editor:this.editor,onNodeChange:this.options.onNodeChange,onElementDragStart:this.options.onElementDragStart,onElementDragEnd:this.options.onElementDragEnd}).plugin]}});var En=Ht.extend({name:"DragHandleVue",props:{pluginKey:{type:[String,Object],default:()=>Nt},editor:{type:Object,required:!0},computePositionConfig:{type:Object,default:()=>({})},onNodeChange:{type:Function,default:null},onElementDragStart:{type:Function,default:null},onElementDragEnd:{type:Function,default:null},class:{type:String,default:"drag-handle"}},mounted(){const{editor:e,pluginKey:n,onNodeChange:i,onElementDragStart:s,onElementDragEnd:o}=this.$props;e.registerPlugin(Pt({editor:e,element:this.$el,pluginKey:n,computePositionConfig:{...Ft,...this.computePositionConfig},onNodeChange:i,onElementDragStart:s,onElementDragEnd:o}).plugin)},beforeDestroy(){const{pluginKey:e,editor:n}=this.$props;n.unregisterPlugin(e)},render(e){return e("div",{class:this.class},this.$slots.default)}});const Mn={name:"DragVerticalIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var wn=function(){var e=this,n=e._self._c;return n("span",e._b({staticClass:"material-design-icon drag-vertical-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[n("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M9,3H11V5H9V3M13,3H15V5H13V3M9,7H11V9H9V7M13,7H15V9H13V7M9,11H11V13H9V11M13,11H15V13H13V11M9,15H11V17H9V15M13,15H15V17H13V15M9,19H11V21H9V19M13,19H15V21H13V19Z"}},[e.title?n("title",[e._v(e._s(e.title))]):e._e()])])])},An=[],Sn=_(Mn,wn,An,!1,null,null);const $n=Sn.exports,On={name:"FloatingButtons",components:{DragHandle:En,DragVerticalIcon:$n,NcButton:kt,PlusIcon:ie},setup(){const{editor:e}=D();return{editor:e}},data(){return{node:null,pos:-1}},computed:{isHeadingNode(){return this.node?.type===this.editor.schema.nodes.heading}},methods:{onNodeChange({node:e,pos:n}){this.node=e,this.pos=n},onOpenSmartPicker(){if(!this.node||this.pos===-1)return;const{schema:e}=this.editor,n=this.node.textContent.trim()===""&&(this.node.children.length===0||this.node.children.every(i=>i.type===e.nodes.text))?this.pos+1:this.pos+this.node.nodeSize;this.editor.chain().insertContentAt(n,"/").focus().run()},t:N}};var Nn=function(){var e=this,n=e._self._c;return n("DragHandle",{staticClass:"floating-buttons",class:{heading:e.isHeadingNode},attrs:{editor:e.editor,"on-node-change":e.onNodeChange}},[n("NcButton",{attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Insert below")},on:{click:e.onOpenSmartPicker},scopedSlots:e._u([{key:"icon",fn:function(){return[n("PlusIcon",{attrs:{size:16}})]},proxy:!0}])}),n("NcButton",{staticClass:"drag-button",attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Click for options, hold to drag")},scopedSlots:e._u([{key:"icon",fn:function(){return[n("DragVerticalIcon",{attrs:{size:16}})]},proxy:!0}])})],1)},Pn=[],Fn=_(On,Nn,Pn,!1,null,"6b72539f");const In=Fn.exports,Tn={name:"ContentContainer",components:{EditorContent:oe,EditorOutline:se,FloatingButtons:In},mixins:[mt],props:{readOnly:{type:Boolean,required:!0}},setup(){const e=ft(),{editor:n}=D(),{isRichEditor:i,isRichWorkspace:s}=U(),{isFullWidth:o}=At();return{editor:n,isMobile:e,isFullWidth:o,isRichEditor:i,isRichWorkspace:s}},computed:{showOutline(){return this.$outlineState.visible},showFloatingButtons(){return!this.readOnly&&!this.isMobile&&!this.isFullWidth&&this.isRichEditor&&!this.isRichWorkspace}}};var Dn=function(){var e=this,n=e._self._c;return n("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?n("div",{staticClass:"text-editor__content-wrapper__left"},[n("EditorOutline")],1):e._e(),e._t("default"),e.showFloatingButtons?n("FloatingButtons"):e._e(),n("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.editor}}),n("div",{staticClass:"text-editor__content-wrapper__right"})],2)},Bn=[],Hn=_(Tn,Dn,Bn,!1,null,"86ce242a");const Li=Hn.exports;function Rn(e,n){const{documentId:i,sessionId:s,sessionToken:o,shareToken:r}=Y(e),l=new FormData;l.append("file",n);const a=O("apps/text/attachment/upload?");return B.post(a,l,{headers:{"Content-Type":"multipart/form-data"},params:{documentId:i,sessionId:s,sessionToken:o,token:r}})}function Wn(e,n){const{documentId:i,sessionId:s,sessionToken:o}=Y(e),r=O("apps/text/attachment/create");return B.post(r,{documentId:i,sessionId:s,sessionToken:o,fileName:`${n.app}${n.extension}`})}function Ln(e,n){const{documentId:i,sessionId:s,sessionToken:o}=Y(e),r=O("apps/text/attachment/filepath");return B.post(r,{documentId:i,sessionId:s,sessionToken:o,filePath:n})}const ht=e=>e.split("/").slice(0,-1).join("/"),Vn={name:"MediaHandler",mixins:[_e],provide(){const e={};return Object.defineProperties(e,{[Ce]:{get:()=>this.showAttachmentPrompt},[xe]:{get:()=>this.chooseLocalFile},[ke]:{get:()=>this.createAttachment},[be]:{get:()=>this.state}}),e},setup(){const{connection:e}=re(),n=ft(),{editor:i}=D();return{connection:e,editor:i,isMobile:n}},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??ht(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e,n){n.dataTransfer.types.includes("Files")&&(this.draggedOver=e)},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,n=null){if(!e)return;this.state.isUploadingAttachments=!0;const i=[...e].map(s=>this.uploadAttachmentFile(s,n));return Promise.all(i).catch(s=>{W.error("Uploading multiple attachments failed",{error:s}),I(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,n=null){return this.state.isUploadingAttachments=!0,Rn(this.connection,e).then(i=>{this.insertAttachment(i.data?.name,i.data?.id,e.type,n,i.data?.dirname)}).catch(i=>{W.error("Uploading attachment failed",{error:i}),i.response?.data.error?I(t("text","Uploading attachment failed: {error}",{error:i.response.data.error})):I(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){Ne()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=ht(e),this.state.isUploadingAttachments=!0,Ln(this.connection,e).then(n=>{this.insertAttachment(n.data?.name,n.data?.id,n.data?.mimetype,null,n.data?.dirname)}).catch(n=>{W.error("Failed to insert from Files",{error:n}),I(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},createAttachment(e){return this.state.isUploadingAttachments=!0,Wn(this.connection,e).then(n=>{this.insertAttachmentPreview(n.data?.id)}).catch(n=>{W.error("Failed to create attachment",{error:n}),I(t("text","Failed to create attachment"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachmentPreview(e){const n=new URL(O(`/f/${e}`),window.origin).href.replaceAll(" ","%20");this.editor.chain().focus().insertPreview(n).run()},insertAttachment(e,n,i,s=null,o=""){const r=o+"/"+encodeURIComponent(e).replace(/[!'()*]/g,c=>"%"+c.charCodeAt(0).toString(16).toUpperCase()),l=e.replaceAll(/[[\]]/g,"");(s?this.editor.chain().focus(s):this.editor.chain()).setImage({src:r,alt:l}).run();const a=this.editor.view.state.selection;a.empty||this.editor.commands.focus(a.to),this.editor.commands.scrollIntoView(),this.editor.commands.setMeta("insertedAttachmentSrc",{src:r}),Ct("text:image-node:add",null)}}};var Kn=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver,"is-mobile":e.isMobile},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!0,i)},dragleave:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!1,i)},drop:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!1,i)},"file-drop":e.onEditorDrop}},[n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},Un=[],zn=_(Vn,Kn,Un,!1,null,null);const jn=zn.exports,qn={name:"MainContainer",components:{MediaHandler:jn},mixins:[Ee]};var Jn=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor"},[e.$editorUpload?n("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},Xn=[],Yn=_(qn,Jn,Xn,!1,null,"e0c9a19c");const Vi=Yn.exports,Qn={name:"Wrapper",provide(){const e={};return Object.defineProperties(e,{[de]:{get:()=>this.outline},[le]:{get:()=>({toggle:this.outlineToggle})},[ae]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},setup(){const{isRichEditor:e,isRichWorkspace:n}=U();return{isRichEditor:e,isRichWorkspace:n}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return!this.isRichWorkspace}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){xt("text:keyboard:outline",this.outlineToggle),this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})})},beforeDestroy(){Pe("text:keyboard:outline",this.outlineToggle)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},readOnlyToggle(){this.$emit("read-only-toggled")}}};var Zn=function(){var e=this,n=e._self._c;return n("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.isRichWorkspace,"is-rich-editor":e.isRichEditor}},[e._t("default")],2)},Gn=[],ti=_(Qn,Zn,Gn,!1,null,"ae654636");const Ki=ti.exports;function ei(){return navigator?.userAgentData?.mobile!==void 0?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/playbook/i,/silk/i,/BlackBerry/i,/Windows Phone/i].some(e=>navigator.userAgent.match(e))}const ni={name:"HelpModal",components:{NcDialog:Re},data(){return{formatted:{bold:!0,italic:!0,strikethrough:!0,heading1:!0,heading6:!0,unorderdList:!0,orderedList:!0,checkList:!0,blockQuote:!0,codeBlock:!0},ctrlOrModKey:ce[ue.Mod]}},computed:{isFormatted(){return e=>this.formatted[e]},isMobileCached(){return this.isMobilePlatform()}},methods:{t:N,toggleFormatted(e){this.formatted[e]=!this.formatted[e]},isMobilePlatform:ei}};var ii=function(){var e=this,n=e._self._c;return n("NcDialog",{attrs:{size:"large","data-text-el":"formatting-help",name:e.t("text","Formatting and shortcuts"),"close-on-click-outside":!0},on:{closing:function(i){return e.$emit("close")}}},[n("h2",[e._v(e._s(e.t("text","Formatting and shortcuts")))]),n("p",[e._v(e._s(e.t("text","Speed up your writing with simple shortcuts.")))]),e.isMobileCached?n("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax from below."))+" ")]):n("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax or use keyboard shortcuts from below."))+" ")]),n("table",[n("thead",[n("tr",[n("th",[e._v(e._s(e.t("text","Style")))]),n("th",[e._v(e._s(e.t("text","Syntax")))]),e.isMobileCached?e._e():n("th",[e._v(" "+e._s(e.t("text","Keyboard shortcuts"))+" ")])])]),n("tbody",[n("tr",[n("td",[e._v(e._s(e.t("text","New paragraph")))]),n("td",[n("kbd",[e._v(e._s(e.t("text","Enter")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Hard line break")))]),n("td",[n("kbd",[e._v(e._s(e.t("text","Enter")))]),e._v(" "+e._s(e.t("text","followed by"))+" "),n("kbd",[e._v(e._s(e.t("text","Backspace")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Enter")))])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Bold")))]),n("td",[n("code",[e._v("**"+e._s(e.t("text","Bold text"))+"**")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("B")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Italic")))]),n("td",[n("code",[e._v("*"+e._s(e.t("text","Italicized text"))+"*")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("I")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Strikethrough")))]),n("td",[n("code",[e._v("~~"+e._s(e.t("text","Mistaken text"))+"~~")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("S")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Underline")))]),n("td",[n("code",[e._v("__"+e._s(e.t("text","Underlined text"))+"__")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("U")])])]),n("tr",[n("td",{staticClass:"ellipsis_top"},[e._v(" "+e._s(e.t("text","Heading 1"))+" ")]),n("td",{staticClass:"ellipsis_top"},[n("code",[e._v("# "+e._s(e.t("text","Heading level 1")))])]),e.isMobileCached?e._e():n("td",{staticClass:"ellipsis_top"},[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("1")])])]),n("tr",[n("td",{staticClass:"noborder ellipsis"},[e._v("…")]),n("td",{staticClass:"noborder ellipsis"},[e._v("…")]),e.isMobileCached?e._e():n("td",{staticClass:"ellipsis noborder"},[e._v("…")])]),n("tr",[n("td",{staticClass:"noborder ellipsis_bottom"},[e._v(" "+e._s(e.t("text","Heading 6"))+" ")]),n("td",{staticClass:"noborder ellipsis_bottom"},[n("code",[e._v("###### "+e._s(e.t("text","Heading level 6")))])]),e.isMobileCached?e._e():n("td",{staticClass:"noborder ellipsis_bottom"},[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("6")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Unordered list")))]),n("td",[n("code",[e._v("* "+e._s(e.t("text","An item")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("8")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Ordered list")))]),n("td",[n("code",[e._v("1. "+e._s(e.t("text","First item")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("7")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Checklist")))]),n("td",[n("code",[e._v("* [] "+e._s(e.t("text","To-Do item")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("9")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Blockquote")))]),n("td",[n("code",[e._v("> "+e._s(e.t("text","Quoted text")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(">")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Code block")))]),n("td",[n("code",[e._v("``` "+e._s(e.t("text","Some code")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Link")))]),n("td",[n("code",[e._v("[Title](https://example.org)")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("K")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Insert emoji")))]),n("td",[n("code",[e._v(":"+e._s(e.t("text","emoji")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Mention someone")))]),n("td",[n("code",[e._v("@"+e._s(e.t("text","name")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Smart picker")))]),n("td",[n("code",[e._v("/"+e._s(e.t("text","something")))])]),e.isMobileCached?e._e():n("td")])])]),n("table",{attrs:{vif:"!isMobileCached"}},[n("thead",[n("tr",[n("th",[e._v(e._s(e.t("text","Action")))]),n("th",[e._v(e._s(e.t("text","Keyboard shortcuts")))])])]),n("tbody",[n("tr",[n("td",[e._v(e._s(e.t("text","Undo")))]),n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("Z")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Redo")))]),n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("Y")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Toggle outline")))]),n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Alt")))]),e._v(" + "),n("kbd",[e._v("H")])])])])])])},si=[],oi=_(ni,ii,si,!1,null,"ee2c50ae");const ri=oi.exports,ai=T({name:"NcActionButton",components:{NextcloudVueNcActionButton:pt,Help:he},methods:{t:N}});var li=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("NextcloudVueNcActionButton",e._g({attrs:{"close-after-click":"","data-text-action-entry":"formatting-help"},scopedSlots:e._u([{key:"icon",fn:function(){return[n("Help")]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.t("text","Formatting help"))+" ")])},di=[],ci=_(ai,li,di,!1,null,null);const ui=ci.exports,hi=T({name:"CharacterCount",components:{AlphabeticalVariant:me,NcActionText:pe},props:{visible:Boolean},setup(){const{editor:e}=D(),n=F("");return{countString:n,refresh:()=>{const{storage:i,state:s}=e,o=i.characterCount.words({node:s.doc}),r=i.characterCount.characters({node:s.doc}),l=st("text","%n word","%n words",o),a=st("text","%n char","%n chars",r);n.value=[l,a].join(", "),console.debug({wordCount:o,charCount:r,countString:n.value})}}},watch:{visible:"refresh"},created(){this.refresh()}});var pi=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("NcActionText",{attrs:{"data-text-action-entry":"character-count",name:e.countString},scopedSlots:e._u([{key:"icon",fn:function(){return[n("AlphabeticalVariant")]},proxy:!0}])})},mi=[],gi=_(hi,pi,mi,!1,null,null);const fi=gi.exports,vi={__name:"WidthToggle",setup(e){const{canToggleWidth:n,isFullWidth:i,setFullWidth:s}=At();return{__sfc:!0,canToggleWidth:n,isFullWidth:i,setFullWidth:s,t:N,NcActionCheckbox:dn}}};var yi=function(){var e=this,n=e._self._c,i=e._self._setupProxy;return i.canToggleWidth?n(i.NcActionCheckbox,{attrs:{checked:i.isFullWidth},on:{"update:checked":i.setFullWidth}},[e._v(" "+e._s(i.t("text","Full width editor"))+" ")]):e._e()},_i=[],bi=_(vi,yi,_i,!1,null,null);const ki=bi.exports,xi={name:"MenuBar",components:{ActionFormattingHelp:ui,ActionList:Et,ActionSingle:Mt,HelpModal:ri,NcActionSeparator:gt,CharacterCount:fi,WidthToggle:ki},extends:wt,mixins:[_t],provide(){const e={};return Object.defineProperties(e,{[ye]:{get:()=>this.randomID}}),e},props:{isHidden:{type:Boolean,default:!1},openReadOnly:{type:Boolean,default:!1}},setup(){const e=D(),{isPublic:n,isRichEditor:i,isRichWorkspace:s}=U(),o=F(),{width:r}=bt(o);return{editor:e,isPublic:n,isRichEditor:i,isRichWorkspace:s,menubar:o,width:r}},data(){return{entries:this.openReadOnly?[...fe,...q]:this.isPublic||this.isRichWorkspace?[...q]:[...q,...ve],randomID:`menu-bar-${Math.ceil(Math.random()*1e4+500).toString(16)}`,displayHelp:!1,isReady:!1,resize:null}},computed:{visibleEntryKeys(){return this.entries.toSorted((e,n)=>(e.priority??0)-(n.priority??0)).map(e=>e.key).slice(0,this.iconsLimit)},visibleEntries(){return this.entries.filter(e=>this.visibleEntryKeys.includes(e.key))},hiddenEntries(){const e=this.entries.filter(i=>!this.visibleEntryKeys.includes(i.key)),n=e.reduce((i,s,o)=>{const r=s.children??[s];if(r.length>1){const l=i.length&&!i.at(-1).isSeparator?[{key:`separator-before-${s.id}`,isSeparator:!0}]:[],a=o!==e.length-1?[{key:`separator-after-${s.id}`,isSeparator:!0}]:[];return[...i,...l,...r,...a]}return[...i,...r]},[]);return{key:"remain",label:this.t("text","Remaining actions"),icon:ge,children:n}},iconWidth(){const e=(this.menubar&&getComputedStyle(this.menubar))?.getPropertyValue("--default-clickable-area");return parseInt(e)||34},iconsLimit(){const e=this.width-4,n=this.$isMobile?this.iconWidth:this.iconWidth+2;return Math.floor(e/n)-1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{showHelp(){this.displayHelp=!0},hideHelp(){this.displayHelp=!1},t:N}};var Ci=function(){var e=this,n=e._self._c;return n("div",{staticClass:"text-menubar",class:{"text-menubar--ready":e.isReady,"text-menubar--hide":e.isHidden,"text-menubar--is-workspace":e.isRichWorkspace,"is-mobile":e.$isMobile},attrs:{id:e.randomID,"data-text-el":"menubar",role:"region","aria-label":e.t("text","Editor actions")}},[e.displayHelp?n("HelpModal",{on:{close:e.hideHelp}}):e._e(),e.isRichEditor?n("div",{ref:"menubar",staticClass:"text-menubar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Formatting menu bar")},on:{keyup:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&i.button!==0?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"right",39,i.key,["Right","ArrowRight"])||"button"in i&&i.button!==2?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))}]}},[e._l(e.visibleEntries,function(i,s){return n(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(o){return e.disableMenuEntry(i.key,o)},click:function(o){e.activeMenuEntry=s}}})}),n("ActionList",{ref:"remainingEntries",attrs:{"action-entry":e.hiddenEntries,"can-be-focussed":e.activeMenuEntry===e.visibleEntries.length,"force-enabled":!0},on:{click:function(i){e.activeMenuEntry="remain"}},scopedSlots:e._u([{key:"lastAction",fn:function({visible:i}){return[n("WidthToggle"),n("ActionFormattingHelp",{on:{click:e.showHelp}}),n("NcActionSeparator"),n("CharacterCount",e._b({},"CharacterCount",{visible:i},!1))]}}],null,!1,4216951189)})],2):e._e(),n("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)],1)},Ei=[],Mi=_(xi,Ci,Ei,!1,null,"c1397585");const Ui=Mi.exports;export{Wi as A,Li as C,Vi as M,Re as N,Hi as R,Ki as W,Ui as a,Bi as b,Ri as p};
//# sourceMappingURL=MenuBar-C5CKA9UU.chunk.mjs.map
