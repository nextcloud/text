{"version":3,"file":"RichWorkspace-jqXXm4w5.chunk.mjs","sources":["../src/views/RichWorkspace.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div\n\t\tv-if=\"shouldRender\"\n\t\tid=\"rich-workspace\"\n\t\t:class=\"{ focus: focus, dark: darkTheme }\">\n\t\t<RichTextReader\n\t\t\tv-if=\"!loaded || !ready\"\n\t\t\t:content=\"content\"\n\t\t\tclass=\"rich-workspace--preview\" />\n\t\t<Editor\n\t\t\tv-if=\"file\"\n\t\t\tv-show=\"ready\"\n\t\t\t:key=\"file.path\"\n\t\t\t:file-id=\"file.id\"\n\t\t\t:relative-path=\"file.path\"\n\t\t\t:share-token=\"shareToken\"\n\t\t\t:mime=\"file.mimetype\"\n\t\t\t:autofocus=\"autofocus\"\n\t\t\t:hide-menu=\"hideMenu\"\n\t\t\tactive\n\t\t\trich-workspace\n\t\t\t@ready=\"ready = true\"\n\t\t\t@focus=\"onFocus\" />\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport { subscribe, unsubscribe } from '@nextcloud/event-bus'\nimport { loadState } from '@nextcloud/initial-state'\nimport { t } from '@nextcloud/l10n'\nimport { generateOcsUrl } from '@nextcloud/router'\nimport { getSharingToken, isPublicShare } from '@nextcloud/sharing/public'\n\nimport getEditorInstance from '../components/Editor.singleton.js'\nimport RichTextReader from '../components/RichTextReader.vue'\n\nconst IS_PUBLIC = isPublicShare()\nconst WORKSPACE_URL = generateOcsUrl(\n\t'apps/text' + (IS_PUBLIC ? '/public' : '') + '/workspace',\n\t2,\n)\nconst descriptionFile =\n\tt('text', 'Readme') + '.' + loadState('text', 'default_file_extension')\nconst SUPPORTED_STATIC_FILENAMES = [\n\tdescriptionFile,\n\t'Readme.md',\n\t'README.md',\n\t'readme.md',\n]\n\nexport default {\n\tname: 'RichWorkspace',\n\tcomponents: {\n\t\tRichTextReader,\n\t\tEditor: getEditorInstance,\n\t},\n\tprops: {\n\t\tcontent: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tpath: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tactive: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\thasRichWorkspace: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\t// Keep track of a local copy of the hasRichWorkspace state as it might change after initial rendering (e.g. when adding/removing the readme)\n\t\t\tlocalHasRichWorkspace: false,\n\t\t\tfocus: false,\n\t\t\tfolder: null,\n\t\t\tfile: null,\n\t\t\tloaded: false,\n\t\t\tready: false,\n\t\t\tautofocus: false,\n\t\t\tshouldAutofocus: false,\n\t\t\thideMenu: true,\n\t\t\tdarkTheme: window?.OCA?.Accessibility?.theme === 'dark',\n\t\t\tenabled: window?.OCA?.Text?.RichWorkspaceEnabled,\n\t\t}\n\t},\n\tcomputed: {\n\t\tshareToken() {\n\t\t\treturn getSharingToken()\n\t\t},\n\t\tshouldRender() {\n\t\t\treturn this.enabled && this.localHasRichWorkspace\n\t\t},\n\t},\n\twatch: {\n\t\tpath() {\n\t\t\tthis.reset()\n\t\t},\n\t\tready() {\n\t\t\tthis.shouldAutofocus = false\n\t\t},\n\t\tfocus(newValue) {\n\t\t\tif (!newValue) {\n\t\t\t\tdocument\n\t\t\t\t\t.querySelector('#rich-workspace .text-editor__main')\n\t\t\t\t\t.scrollTo(0, 0)\n\t\t\t}\n\t\t},\n\t\tshouldRender(value) {\n\t\t\tif (value) {\n\t\t\t\tthis.getFileInfo()\n\t\t\t}\n\t\t},\n\t\thasRichWorkspace(value) {\n\t\t\tthis.localHasRichWorkspace = value\n\t\t},\n\t},\n\tmounted() {\n\t\tthis.localHasRichWorkspace = this.hasRichWorkspace\n\t\tsubscribe('Text::showRichWorkspace', this.showRichWorkspace)\n\t\tsubscribe('Text::hideRichWorkspace', this.hideRichWorkspace)\n\t\tsubscribe('files:node:created', this.onFileCreated)\n\t\tsubscribe('files:node:deleted', this.onFileDeleted)\n\t\tsubscribe('files:node:renamed', this.onFileRenamed)\n\n\t\tthis.listenKeydownEvents()\n\t},\n\tbeforeDestroy() {\n\t\tunsubscribe('Text::showRichWorkspace', this.showRichWorkspace)\n\t\tunsubscribe('Text::hideRichWorkspace', this.hideRichWorkspace)\n\t\tunsubscribe('files:node:created', this.onFileCreated)\n\t\tunsubscribe('files:node:deleted', this.onFileDeleted)\n\t\tunsubscribe('files:node:renamed', this.onFileRenamed)\n\n\t\tthis.unlistenKeydownEvents()\n\t},\n\tmethods: {\n\t\tonFocus() {\n\t\t\tthis.focus = true\n\t\t\tthis.hideMenu = false\n\t\t\tthis.unlistenKeydownEvents()\n\t\t},\n\t\treset() {\n\t\t\tthis.file = null\n\t\t\tthis.focus = false\n\t\t\tthis.shouldAutofocus = false\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tif (this.shouldRender) {\n\t\t\t\t\tthis.getFileInfo()\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tgetFileInfo() {\n\t\t\tthis.file = null\n\t\t\tthis.ready = false\n\t\t\tthis.loaded = true\n\t\t\tconst params = { path: this.path }\n\t\t\tif (IS_PUBLIC) {\n\t\t\t\tparams.shareToken = this.shareToken\n\t\t\t}\n\t\t\treturn axios\n\t\t\t\t.get(WORKSPACE_URL, { params })\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst data = response.data.ocs.data\n\t\t\t\t\tthis.folder = data.folder || null\n\t\t\t\t\tthis.file = data.file\n\t\t\t\t\tthis.editing = true\n\t\t\t\t\tthis.loaded = true\n\t\t\t\t\tthis.autofocus = this.shouldAutofocus\n\t\t\t\t\treturn true\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\terror.response.data.ocs\n\t\t\t\t\t\t&& error.response.data.ocs.data.folder\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.folder = error.response.data.ocs.data.folder\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.folder = null\n\t\t\t\t\t}\n\t\t\t\t\tthis.file = null\n\t\t\t\t\tthis.loaded = true\n\t\t\t\t\tthis.ready = true\n\t\t\t\t\treturn false\n\t\t\t\t})\n\t\t},\n\t\tshowRichWorkspace(event) {\n\t\t\tthis.enabled = true\n\t\t},\n\t\thideRichWorkspace() {\n\t\t\tthis.enabled = false\n\t\t},\n\t\tlistenKeydownEvents() {\n\t\t\twindow.addEventListener('keydown', this.onKeydown)\n\t\t},\n\t\tunlistenKeydownEvents() {\n\t\t\twindow.removeEventListener('keydown', this.onKeydown)\n\t\t},\n\t\tonKeydown(e) {\n\t\t\tif (e.key === 'Tab') {\n\t\t\t\tthis.hideMenu = false\n\t\t\t}\n\t\t},\n\t\tonFileCreated(node) {\n\t\t\tif (SUPPORTED_STATIC_FILENAMES.includes(node.basename)) {\n\t\t\t\tthis.shouldAutofocus = this.enabled\n\t\t\t\tthis.localHasRichWorkspace = true\n\t\t\t}\n\t\t},\n\t\tonFileDeleted(node) {\n\t\t\tif (node.path === this.file?.path) {\n\t\t\t\tthis.localHasRichWorkspace = false\n\t\t\t}\n\t\t},\n\t\tonFileRenamed(node) {\n\t\t\tif (SUPPORTED_STATIC_FILENAMES.includes(node.basename)) {\n\t\t\t\tthis.localHasRichWorkspace = true\n\t\t\t} else if (\n\t\t\t\tnode.fileid === this.file?.id\n\t\t\t\t&& node.path !== this.file?.path\n\t\t\t) {\n\t\t\t\tthis.localHasRichWorkspace = false\n\t\t\t}\n\t\t},\n\t\tt,\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n#rich-workspace {\n\tpadding: 0 50px;\n\t/* Slightly reduce vertical space */\n\tmargin-bottom: -24px;\n\ttext-align: left;\n\tmax-height: 0;\n\ttransition: max-height 0.5s cubic-bezier(0, 1, 0, 1);\n\tz-index: 61;\n\tposition: relative;\n}\n\n.rich-workspace--preview {\n\tmargin-top: var(--default-clickable-area);\n\n\t&:deep(div[contenteditable='false']) {\n\t\tmargin: 0;\n\t}\n}\n\n/* For subfolders, where there are no Recommendations */\n#rich-workspace:only-child {\n\tmargin-bottom: 0;\n}\n\n.empty-workspace {\n\tcursor: pointer;\n\tdisplay: block;\n\tpadding-top: 43px;\n\tcolor: var(--color-text-maxcontrast);\n}\n\n#rich-workspace:deep(div[contenteditable='false']) {\n\twidth: 100%;\n\tpadding: 0px;\n\tbackground-color: var(--color-main-background);\n\topacity: 1;\n\tborder: none;\n}\n\n#rich-workspace:deep(.text-editor) {\n\theight: 100%;\n\tposition: unset !important;\n\ttop: auto !important;\n}\n\n#rich-workspace:deep(.text-editor__wrapper) {\n\tposition: unset !important;\n\toverflow: visible;\n}\n\n#rich-workspace:deep(.text-editor__main) {\n\toverflow: visible !important;\n}\n\n#rich-workspace:deep(.content-wrapper) {\n\toverflow: scroll !important;\n\tmax-height: calc(40vh - 50px);\n\tpadding-left: 10px;\n\tpadding-bottom: 10px;\n}\n\n#rich-workspace:deep(.text-editor__wrapper .ProseMirror) {\n\tpadding: 0px;\n\tmargin: 0;\n}\n\n#rich-workspace:deep(.table-wrapper .content) {\n\ttr {\n\t\tth,\n\t\ttd {\n\t\t\tflex-grow: 1;\n\t\t}\n\n\t\tth {\n\t\t\tdiv {\n\t\t\t\twidth: 100%;\n\t\t\t}\n\n\t\t\t.action-item div {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: flex-end;\n\t\t\t}\n\t\t}\n\t}\n}\n\n#rich-workspace:deep(.editor__content) {\n\tmargin: 0;\n}\n\n#rich-workspace.focus {\n\tmax-height: 50vh;\n}\n\n#rich-workspace:not(.focus) {\n\tmax-height: 30vh;\n\tposition: relative;\n\toverflow: hidden;\n}\n\n#rich-workspace:not(.focus):not(.empty):after {\n\tcontent: '';\n\tposition: absolute;\n\tz-index: 1;\n\tbottom: 0;\n\tleft: 0;\n\tpointer-events: none;\n\tbackground-image: linear-gradient(\n\t\tto bottom,\n\t\trgba(255, 255, 255, 0),\n\t\tvar(--color-main-background)\n\t);\n\twidth: 100%;\n\theight: 4em;\n}\n\n#rich-workspace.dark:not(.focus):after {\n\tbackground-image: linear-gradient(\n\t\tto bottom,\n\t\trgba(0, 0, 0, 0),\n\t\tvar(--color-main-background)\n\t);\n}\n\n@media only screen and (max-width: 1024px) {\n\t#rich-workspace:not(.focus) {\n\t\tmax-height: 30vh;\n\t}\n}\n</style>\n"],"names":["t","axios"],"mappings":"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"}