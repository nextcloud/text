import{b as g,d as f,u as v,w,O as _,x as A}from"./NcColorPicker-mDcoGqyd.chunk.mjs";import{f as c,g as O,u as x,A as F,h as y,S as C,i as b,j as P,k as $}from"./MediaHandler.provider-BE50DDzt.chunk.mjs";import{n as o}from"./_plugin-vue2_normalizer-wd1ZAbRr.chunk.mjs";import{g as U,e as D}from"./modulepreload-polyfill-Pz2ckkzf.chunk.mjs";import{s as n}from"./public-DZjpO8Tq.chunk.mjs";import{l as r}from"./logger-Bvti-6nU.chunk.mjs";import{m as k}from"./index-BOsVt1qJ.chunk.mjs";const S={name:"ContentContainer",components:{EditorContent:g,EditorOutline:f},mixins:[c,v],computed:{showOutline(){return this.$outlineState.visible}}};var E=function(){var e=this,i=e._self._c;return i("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?i("div",{staticClass:"text-editor__content-wrapper__left"},[i("EditorOutline")],1):e._e(),e._t("default"),i("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.$editor}}),i("div",{staticClass:"text-editor__content-wrapper__right"})],2)},I=[],T=o(S,E,I,!1,null,"a3b97a85");const it=T.exports,h=e=>e.split("/").slice(0,-1).join("/"),M={name:"MediaHandler",mixins:[c,O,x],provide(){const e={};return Object.defineProperties(e,{[F]:{get:()=>this.showAttachmentPrompt},[y]:{get:()=>this.chooseLocalFile},[C]:{get:()=>this.state}}),e},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??h(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e){this.draggedOver=e},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,i=null){if(!e)return;this.state.isUploadingAttachments=!0;const a=[...e].map(s=>this.uploadAttachmentFile(s,i));return Promise.all(a).catch(s=>{r.error("Uploading multiple attachments failed",{error:s}),n(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,i=null){return this.state.isUploadingAttachments=!0,this.$syncService.uploadAttachment(e).then(a=>{this.insertAttachment(a.data?.name,a.data?.id,e.type,i,a.data?.dirname)}).catch(a=>{r.error("Uploading attachment failed",{error:a}),a.response?.data.error?n(t("text","Uploading attachment failed: {error}",{error:a.response.data.error})):n(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){U()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=h(e),this.state.isUploadingAttachments=!0,this.$syncService.insertAttachmentFile(e).then(i=>{this.insertAttachment(i.data?.name,i.data?.id,i.data?.mimetype,null,i.data?.dirname)}).catch(i=>{r.error("Failed to insert from Files",{error:i}),n(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachment(e,i,a,s=null,u=""){const l=u+"/"+encodeURIComponent(e).replace(/[!'()*]/g,m=>"%"+m.charCodeAt(0).toString(16).toUpperCase()),p=e.replaceAll(/[[\]]/g,"");(s?this.$editor.chain().focus(s):this.$editor.chain()).setImage({src:l,alt:p}).run();const d=this.$editor.view.state.selection;d.empty||this.$editor.commands.focus(d.to),this.$editor.commands.scrollIntoView(),this.$editor.commands.setMeta("insertedAttachmentSrc",{src:l}),D("text:image-node:add",null)}}};var R=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(a){return a.preventDefault(),a.stopPropagation(),e.setDraggedOver(!0)},dragleave:function(a){return a.preventDefault(),a.stopPropagation(),e.setDraggedOver(!1)},drop:function(a){return a.preventDefault(),a.stopPropagation(),e.setDraggedOver(!1)},"file-drop":e.onEditorDrop}},[i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},W=[],j=o(M,R,W,!1,null,null);const K=j.exports,L={name:"MainContainer",components:{MediaHandler:K},mixins:[b]};var B=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor"},[e.$editorUpload?i("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},H=[],q=o(L,B,H,!1,null,"f2d30048");const at=q.exports,N={name:"Wrapper",mixins:[w,P,$],provide(){const e={};return Object.defineProperties(e,{[_]:{get:()=>this.outline},[A]:{get:()=>({toggle:this.outlineToggle})}}),e},props:{isResolvingConflict:{type:Boolean,require:!0},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{...k({viewWidth:e=>e.text.viewWidth}),showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return!this.$isRichWorkspace}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})}),document.addEventListener("keydown",this.handleKeyDown)},beforeDestroy(){document.removeEventListener("keydown",this.handleKeyDown)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},handleKeyDown(e){e.ctrlKey&&e.altKey&&e.key==="h"&&this.outlineToggle()}}};var V=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.$isRichWorkspace,"is-rich-editor":e.$isRichEditor}},[e._t("default")],2)},z=[],G=o(N,V,z,!1,null,"d188c181");const st=G.exports;export{it as C,at as M,st as W};
//# sourceMappingURL=Wrapper-D7ineqlM.chunk.mjs.map
