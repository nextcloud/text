{"version":3,"file":"MediaHandler.provider-B-6EH1Bu.chunk.mjs","sources":["../src/helpers/links.js","../src/components/Editor.provider.ts","../src/components/Editor/MediaHandler.provider.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\nimport { generateUrl } from '@nextcloud/router'\n\nconst domHref = function (node, relativePath) {\n\tconst ref = node.attrs.href\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tif (!window.OCA?.Viewer) {\n\t\treturn ref\n\t}\n\tif (ref.match(/^[a-zA-Z]*:/)) {\n\t\treturn ref\n\t}\n\tif (ref.startsWith('#')) {\n\t\treturn ref\n\t}\n\t// Don't rewrite links in collectives app context\n\tif (loadState('core', 'active-app', '') === 'collectives') {\n\t\treturn ref\n\t}\n\t// Don't rewrite links to the collectives app\n\tif (ref.includes('/apps/collectives/')) {\n\t\treturn ref\n\t}\n\n\t// Rewrite links with old format from file picker to `/f/<fileId>`\n\tconst match = ref.match(/^([^?]*)\\?fileId=(\\d+)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn new URL(generateUrl(`/f/${id}`), window.origin).href\n\t}\n\treturn ref\n}\n\nconst parseHref = function (dom) {\n\tconst ref = dom.getAttribute('href')\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tconst match = ref.match(/\\?dir=([^&]*)&openfile=([^&]*)#relPath=([^&]*)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn new URL(generateUrl(`/f/${id}`), window.origin).href\n\t}\n\treturn ref\n}\n\nconst isLinkToSelfWithHash = function (href) {\n\tconst locationNoHash =\n\t\twindow.location.origin + window.location.pathname + window.location.search\n\treturn href?.startsWith('#') || href?.startsWith(locationNoHash + '#')\n}\n\n/**\n * Open links, to be used as custom click handler\n *\n * @param {string} href the link href\n */\nconst openLink = function (href) {\n\tconst linkUrl = new URL(href, window.location.href)\n\t// Consider rerouting links to Collectives if already inside Collectives app\n\tconst collectivesUrlBase = '/apps/collectives'\n\tif (\n\t\twindow.OCA.Collectives?.vueRouter\n\t\t&& linkUrl.pathname.toString().startsWith(generateUrl(collectivesUrlBase))\n\t) {\n\t\tconst collectivesUrl = linkUrl.href.substring(\n\t\t\tlinkUrl.href.indexOf(collectivesUrlBase) + collectivesUrlBase.length,\n\t\t)\n\t\twindow.OCA.Collectives.vueRouter.push(collectivesUrl)\n\t\treturn\n\t}\n\twindow.open(linkUrl, '_blank')\n}\n\nexport { domHref, isLinkToSelfWithHash, openLink, parseHref }\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { openLink } from '../helpers/links.js'\nimport { logger } from '../helpers/logger.js'\n\nexport const FILE = Symbol('editor:file')\nexport const ATTACHMENT_RESOLVER = Symbol('attachment:resolver')\nexport const IS_MOBILE = Symbol('editor:is-mobile')\nexport const EDITOR_UPLOAD = Symbol('editor:upload')\nexport const HOOK_MENTION_SEARCH = Symbol('hook:mention-search')\nexport const HOOK_MENTION_INSERT = Symbol('hook:mention-insert')\nexport const OPEN_LINK_HANDLER = Symbol('editor:open-link-handler')\n\nexport const useIsMobileMixin = {\n\tinject: {\n\t\t$isMobile: { from: IS_MOBILE, default: false },\n\t},\n}\n\nexport const useFileMixin = {\n\tinject: {\n\t\t$file: {\n\t\t\tfrom: FILE,\n\t\t\tdefault: () => ({\n\t\t\t\tfileId: 0,\n\t\t\t\trelativePath: null,\n\t\t\t\tdocument: null,\n\t\t\t}),\n\t\t},\n\t},\n}\n\nexport const useAttachmentResolver = {\n\tinject: {\n\t\t$attachmentResolver: {\n\t\t\tfrom: ATTACHMENT_RESOLVER,\n\t\t\tdefault: {\n\t\t\t\tresolve(src: string) {\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t'No attachment resolver provided. Some attachment sources cannot be resolved.',\n\t\t\t\t\t)\n\t\t\t\t\treturn [src]\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n}\nexport const useEditorUpload = {\n\tinject: {\n\t\t$editorUpload: {\n\t\t\tfrom: EDITOR_UPLOAD,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useMentionHook = {\n\tinject: {\n\t\t$mentionHookInsert: {\n\t\t\tfrom: HOOK_MENTION_INSERT,\n\t\t\tdefault: true,\n\t\t},\n\t\t$mentionHookSearch: {\n\t\t\tfrom: HOOK_MENTION_SEARCH,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useOpenLinkHandler = {\n\tinject: {\n\t\t$openLinkHandler: {\n\t\t\tfrom: OPEN_LINK_HANDLER,\n\t\t\tdefault: {\n\t\t\t\topenLink,\n\t\t\t},\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport const STATE_UPLOADING = Symbol('state:uploading-state')\nexport const ACTION_ATTACHMENT_PROMPT = Symbol('editor:action:attachment-prompt')\nexport const ACTION_CHOOSE_LOCAL_ATTACHMENT = Symbol(\n\t'editor:action:upload-attachment',\n)\nexport const ACTION_CREATE_ATTACHMENT = Symbol('editor:action:create-attachment')\n\nexport const useUploadingStateMixin = {\n\tinject: {\n\t\t$uploadingState: {\n\t\t\tfrom: STATE_UPLOADING,\n\t\t\tdefault: {\n\t\t\t\tisUploadingAttachments: false,\n\t\t\t},\n\t\t},\n\t},\n}\n\nexport const useActionAttachmentPromptMixin = {\n\tinject: {\n\t\t$callAttachmentPrompt: { from: ACTION_ATTACHMENT_PROMPT, default: () => {} },\n\t},\n}\n\nexport const useActionChooseLocalAttachmentMixin = {\n\tinject: {\n\t\t$callChooseLocalAttachment: {\n\t\t\tfrom: ACTION_CHOOSE_LOCAL_ATTACHMENT,\n\t\t\tdefault: () => {},\n\t\t},\n\t},\n}\n\nexport const useActionCreateAttachmentMixin = {\n\tinject: {\n\t\t$callCreateAttachment: {\n\t\t\tfrom: ACTION_CREATE_ATTACHMENT,\n\t\t\tdefault: () => (template) => {},\n\t\t},\n\t},\n}\n"],"names":["domHref","node","relativePath","ref","_a","loadState","match","id","generateUrl","parseHref","dom","isLinkToSelfWithHash","href","locationNoHash","openLink","linkUrl","collectivesUrlBase","collectivesUrl","FILE","ATTACHMENT_RESOLVER","IS_MOBILE","EDITOR_UPLOAD","HOOK_MENTION_SEARCH","HOOK_MENTION_INSERT","OPEN_LINK_HANDLER","useIsMobileMixin","useFileMixin","useAttachmentResolver","src","logger","useEditorUpload","useOpenLinkHandler","STATE_UPLOADING","ACTION_ATTACHMENT_PROMPT","ACTION_CHOOSE_LOCAL_ATTACHMENT","ACTION_CREATE_ATTACHMENT","useUploadingStateMixin","useActionAttachmentPromptMixin","useActionChooseLocalAttachmentMixin","useActionCreateAttachmentMixin","template"],"mappings":"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"}