var C=Object.defineProperty,x=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var f=(t,e,s)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,h=(t,e)=>{for(var s in e||(e={}))I.call(e,s)&&f(t,s,e[s]);if(g)for(var s of g(e))G.call(e,s)&&f(t,s,e[s]);return t},y=(t,e)=>x(t,k(e));import{t as r}from"./NcLoadingIcon-V-QWbD5-.chunk.mjs";import{N as _,s as w,b as B,c as M}from"./NcNoteCard-Dz5-u2BY-DEDsgEwb.chunk.mjs";import{n as m}from"./NcCheckboxRadioSwitch-ezquUuPz-BfX8XV6z.chunk.mjs";import{m as b,n as O,C as D,N as z,o as P,e as V,q as F,r as W,d as $,s as H,t as q,v as L}from"./EditorOutline-5fihazFh.chunk.mjs";import{r as v,s as U,w as S,c as j,o as E,b as T,e as N}from"./vue.runtime.esm-Ci2e5rf_.chunk.mjs";import{u as Z}from"./Editor-V1l6ydk5.chunk.mjs";import"./emoji-picker-DJyM6asK.chunk.mjs";import"./index-CkfhUZfI.chunk.mjs";import"./index-DUrHmx5a.chunk.mjs";import"./index-ti_56SXG.chunk.mjs";import"./logger-Btaw2hdC.chunk.mjs";import"./index-B64e8dYD.chunk.mjs";import"./preload-helper-Dlt9bAsw.chunk.mjs";import"./MediaHandler.provider-B8o03yiD.chunk.mjs";import"./index-Cqe8I0z9.chunk.mjs";import"./dav-CQDyL7M_-CH-BFZ4c.chunk.mjs";import"./MenuBar-BL9mQRNe.chunk.mjs";const J={name:"AccountMultipleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var K=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon account-multiple-outline-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(s){return t.$emit("click",s)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M13.07 10.41A5 5 0 0 0 13.07 4.59A3.39 3.39 0 0 1 15 4A3.5 3.5 0 0 1 15 11A3.39 3.39 0 0 1 13.07 10.41M5.5 7.5A3.5 3.5 0 1 1 9 11A3.5 3.5 0 0 1 5.5 7.5M7.5 7.5A1.5 1.5 0 1 0 9 6A1.5 1.5 0 0 0 7.5 7.5M16 17V19H2V17S2 13 9 13 16 17 16 17M14 17C13.86 16.22 12.67 15 9 15S4.07 16.31 4 17M15.95 13A5.32 5.32 0 0 1 18 17V19H22V17S22 13.37 15.94 13Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},Q=[],R=m(J,K,Q,!1,null,null);const X=R.exports;function Y(t){var e;const{openData:s}=b(),a=v((e=s.value)==null?void 0:e.session),o=U([]);S(s,i=>{i!=null&&i.session&&(a.value=i.session)});const d=j({get(){if(a.value&&O(a.value))return a.value},set(i){a.value=i}}),l=({sessions:i})=>{const u=Date.now()/1e3-D;o.value=i.filter(n=>n.lastContact>u).sort((n,p)=>p.lastContact-n.lastContact).filter(tt);const c=o.value.find(n=>{var p;return n.id===((p=a.value)==null?void 0:p.id)});c&&(a.value=c)};return E(()=>{t.bus.on("change",l)}),T(()=>{t.bus.off("change",l)}),{currentGuestSession:d,currentSession:N(a),sessions:N(o)}}function tt(t,e,s){return"userId"in t?!s.slice(0,e).some(a=>"userId"in a&&a.userId===t.userId):!0}const et={name:"AccountOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var st=function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon account-outline-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(s){return t.$emit("click",s)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,6A2,2 0 0,0 10,8A2,2 0 0,0 12,10A2,2 0 0,0 14,8A2,2 0 0,0 12,6M12,13C14.67,13 20,14.33 20,17V20H4V17C4,14.33 9.33,13 12,13M12,14.9C9.03,14.9 5.9,16.36 5.9,17V18.1H18.1V17C18.1,16.36 14.97,14.9 12,14.9Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},at=[],it=m(et,st,at,!1,null,null);const nt=it.exports,ot={name:"AvatarWrapper",components:{NcAvatar:z,AccountOutlineIcon:nt},props:{session:{type:Object,required:!0}},computed:{sessionAvatarStyle(){return y(h({},this.sessionBackgroundStyle),{"border-color":this.session.color})},sessionBackgroundStyle(){return{"background-color":this.session.userId?this.session.color+" !important":"var(--color-background-dark)"}},guestInitial(){return this.session.guestName===""?"?":this.session.guestName.slice(0,1).toUpperCase()}}};var rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"avatar-wrapper",style:t.sessionAvatarStyle},[t.session.userId?e("NcAvatar",{attrs:{user:t.session.userId,"is-guest":!1,"disable-menu":!0,"hide-status":"","disable-tooltip":!0}}):e("div",{staticClass:"avatar",style:t.sessionBackgroundStyle},[t.session.guestName?[t._v(" "+t._s(t.guestInitial)+" ")]:e("AccountOutlineIcon")],2)],1)},lt=[],ut=m(ot,rt,lt,!1,null,"b9aa9c07");const A=ut.exports,ct={__name:"GuestNameDialog",props:{session:{type:Object,required:!0}},emits:["update:session"],setup(t,{emit:e}){const s=t,{connection:a}=b(),{editor:o}=P(),{updateUser:d}=$(o),l=v(!1),i=v(!1),u=v(s.session.guestName);return S(()=>s.session.guestName,c=>{l.value||(u.value=c)}),{__sfc:!0,props:s,emit:e,connection:a,editor:o,updateUser:d,editing:l,loading:i,guestName:u,setGuestName:async()=>{if(!a.value){w(r("text","Not connected. Cannot update guest name."));return}const c=s.session.guestName;i.value=!0;try{const n=await H(u.value,a.value);i.value=!1,l.value=!1;try{localStorage.setItem("nick",n.guestName)}catch(p){console.warn("Could not store guest name in local storage.",p)}e("update:session",n),d(n)}catch(n){i.value=!1,console.warn("Failed to update the session",{error:n}),B(r("text","Failed to update the guest name.")),u.value=c}},t:r,NcButton:_,NcInputField:W,CheckIcon:F,PencilOutlineIcon:V,AvatarWrapper:A}}};var pt=function(){var t=this,e=t._self._c,s=t._self._setupProxy;return e("li",[s.editing?e("form",{staticClass:"guest-name-dialog",attrs:{title:s.t("text","Enter your name so other people can see who is editing")},on:{submit:function(a){return a.preventDefault(),s.setGuestName.apply(null,arguments)}}},[e(s.NcInputField,{attrs:{maxlength:"60",disabled:s.loading,label:s.t("text","Enter your name"),placeholder:s.t("text","Guest")},model:{value:s.guestName,callback:function(a){s.guestName=a},expression:"guestName"}}),e(s.NcButton,{attrs:{variant:"primary","aria-label":s.t("text","submit")},on:{click:s.setGuestName},scopedSlots:t._u([{key:"icon",fn:function(){return[e(s.CheckIcon,{attrs:{size:20}})]},proxy:!0}],null,!1,1971559621)})],1):[e(s.AvatarWrapper,{attrs:{session:t.session}}),e("span",{staticClass:"session-label guest"},[t._v(" "+t._s(s.guestName||s.t("text","you"))+" ")]),e(s.NcButton,{attrs:{"aria-label":s.t("text","edit")},on:{click:function(a){s.editing=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e(s.PencilOutlineIcon,{attrs:{size:20}})]},proxy:!0}])})]],2)},mt=[],dt=m(ct,pt,mt,!1,null,"c5c78adf");const vt=dt.exports,gt={name:"SessionList",components:{AccountMultipleOutlineIcon:X,AvatarWrapper:A,GuestNameDialog:vt,NcButton:_,NcPopover:M},setup(){const{isPublic:t}=L(),{syncService:e}=Z(),{currentGuestSession:s,currentSession:a,sessions:o}=Y(e);return{currentGuestSession:s,currentSession:a,sessions:o,isPublic:t}},computed:{label(){return r("text","Active people")},sessionList(){return this.showGuestNameDialog?this.remoteSessions:this.sessions},remoteSessions(){return this.sessions.filter(t=>{var e;return t.id!==((e=this.currentSession)==null?void 0:e.id)})},showGuestNameDialog(){return this.isPublic&&this.currentGuestSession},avatarStyle(){return t=>({opacity:t.lastContact>Date.now()/1e3-q?1:.5})},sessionsForTriggerButton(){return this.remoteSessions.slice(0,3)}},methods:{t:r,displayNameOrGuestName:t=>t.userId?t.displayName:"".concat(t.guestName||r("text","Guest")," (").concat(r("text","guest"),")")}};var ft=function(){var t=this,e=t._self._c;return e("NcPopover",{staticClass:"session-list",attrs:{"no-focus-trap":!t.showGuestNameDialog,placement:"bottom"},scopedSlots:t._u([{key:"trigger",fn:function({attrs:s}){return[e("div",[e("NcButton",t._b({staticClass:"avatar-list",attrs:{title:t.label,"aria-label":t.label,type:"tertiary"},scopedSlots:t._u([{key:"icon",fn:function(){return[e("AccountMultipleOutlineIcon",{attrs:{size:20}}),t._l(t.sessionsForTriggerButton,function(a){return e("AvatarWrapper",{key:a.id,attrs:{session:a}})})]},proxy:!0}],null,!0)},"NcButton",s,!1))],1)]}},{key:"default",fn:function(){return[e("div",{staticClass:"session-menu"},[t._t("lastSaved"),e("ul",[t.showGuestNameDialog?e("GuestNameDialog",{attrs:{session:t.currentGuestSession},on:{"update:session":function(s){t.currentGuestSession=s}}}):t._e(),t._l(t.sessionList,function(s){return e("li",{key:s.id,style:t.avatarStyle(s)},[e("AvatarWrapper",{attrs:{session:s}}),e("span",{staticClass:"session-label",class:!s.userId&&"guest"},[t._v(" "+t._s(t.displayNameOrGuestName(s))+" ")])],1)})],2)],2)]},proxy:!0}],null,!0)})},ht=[],yt=m(gt,ft,ht,!1,null,"e3a51b59");const Ft=yt.exports;export{Ft as default};
//# sourceMappingURL=SessionList-K35vvoQh.chunk.mjs.map
