{"version":3,"file":"Wrapper-CkGl4Hpn.chunk.mjs","sources":["../node_modules/@tiptap/extension-collaboration/dist/index.js","../src/composables/useEditorWidth.ts","../node_modules/@tiptap/extension-node-range/dist/index.js","../node_modules/@tiptap/extension-drag-handle/dist/index.js","../node_modules/@tiptap/extension-drag-handle-vue-2/dist/index.js","../node_modules/vue-material-design-icons/DragVertical.vue","../src/components/Editor/FloatingButtons.vue","../src/components/Editor/ContentContainer.vue","../src/apis/attach.ts","../src/components/Editor/MediaHandler.vue","../src/components/Editor/MainContainer.vue","../src/components/Editor/Wrapper.vue"],"sourcesContent":["// src/collaboration.ts\nimport { Extension } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport { redo, undo, ySyncPlugin, yUndoPlugin, yUndoPluginKey, yXmlFragmentToProsemirrorJSON } from \"@tiptap/y-tiptap\";\n\n// src/helpers/CollaborationMappablePosition.ts\nimport {\n  getUpdatedPosition as coreGetUpdatedPosition,\n  MappablePosition\n} from \"@tiptap/core\";\n\n// src/helpers/isChangeOrigin.ts\nimport { ySyncPluginKey } from \"@tiptap/y-tiptap\";\nfunction isChangeOrigin(transaction) {\n  return !!transaction.getMeta(ySyncPluginKey);\n}\n\n// src/helpers/yRelativePosition.ts\nimport {\n  absolutePositionToRelativePosition,\n  relativePositionToAbsolutePosition,\n  ySyncPluginKey as ySyncPluginKey2\n} from \"@tiptap/y-tiptap\";\nfunction getYAbsolutePosition(state, relativePos) {\n  const ystate = ySyncPluginKey2.getState(state);\n  return relativePositionToAbsolutePosition(ystate.doc, ystate.type, relativePos, ystate.binding.mapping) || 0;\n}\nfunction getYRelativePosition(state, absolutePos) {\n  const ystate = ySyncPluginKey2.getState(state);\n  return absolutePositionToRelativePosition(absolutePos, ystate.type, ystate.binding.mapping);\n}\n\n// src/helpers/CollaborationMappablePosition.ts\nvar CollaborationMappablePosition = class _CollaborationMappablePosition extends MappablePosition {\n  constructor(position, yRelativePosition) {\n    super(position);\n    this.yRelativePosition = yRelativePosition;\n  }\n  /**\n   * Creates a CollaborationMappablePosition from a JSON object.\n   */\n  static fromJSON(json) {\n    return new _CollaborationMappablePosition(json.position, json.yRelativePosition);\n  }\n  /**\n   * Converts the CollaborationMappablePosition to a JSON object.\n   */\n  toJSON() {\n    return {\n      position: this.position,\n      yRelativePosition: this.yRelativePosition\n    };\n  }\n};\nfunction createMappablePosition(position, state) {\n  const yRelativePosition = getYRelativePosition(state, position);\n  return new CollaborationMappablePosition(position, yRelativePosition);\n}\nfunction getUpdatedPosition(position, transaction, state) {\n  const yRelativePosition = position instanceof CollaborationMappablePosition ? position.yRelativePosition : null;\n  if (isChangeOrigin(transaction) && yRelativePosition) {\n    const absolutePosition2 = getYAbsolutePosition(state, yRelativePosition);\n    return {\n      position: new CollaborationMappablePosition(absolutePosition2, yRelativePosition),\n      mapResult: null\n    };\n  }\n  const result = coreGetUpdatedPosition(position, transaction);\n  const absolutePosition = result.position.position;\n  return {\n    position: new CollaborationMappablePosition(\n      absolutePosition,\n      yRelativePosition != null ? yRelativePosition : getYRelativePosition(state, absolutePosition)\n    ),\n    mapResult: result.mapResult\n  };\n}\n\n// src/collaboration.ts\nvar Collaboration = Extension.create({\n  name: \"collaboration\",\n  priority: 1e3,\n  addOptions() {\n    return {\n      document: null,\n      field: \"default\",\n      fragment: null,\n      provider: null\n    };\n  },\n  addStorage() {\n    return {\n      isDisabled: false\n    };\n  },\n  onCreate() {\n    if (this.editor.extensionManager.extensions.find((extension) => extension.name === \"undoRedo\")) {\n      console.warn(\n        '[tiptap warn]: \"@tiptap/extension-collaboration\" comes with its own history support and is not compatible with \"@tiptap/extension-undo-redo\".'\n      );\n    }\n  },\n  onBeforeCreate() {\n    this.editor.utils.getUpdatedPosition = (position, transaction) => getUpdatedPosition(position, transaction, this.editor.state);\n    this.editor.utils.createMappablePosition = (position) => createMappablePosition(position, this.editor.state);\n  },\n  addCommands() {\n    return {\n      undo: () => ({ tr, state, dispatch }) => {\n        tr.setMeta(\"preventDispatch\", true);\n        const undoManager = yUndoPluginKey.getState(state).undoManager;\n        if (undoManager.undoStack.length === 0) {\n          return false;\n        }\n        if (!dispatch) {\n          return true;\n        }\n        return undo(state);\n      },\n      redo: () => ({ tr, state, dispatch }) => {\n        tr.setMeta(\"preventDispatch\", true);\n        const undoManager = yUndoPluginKey.getState(state).undoManager;\n        if (undoManager.redoStack.length === 0) {\n          return false;\n        }\n        if (!dispatch) {\n          return true;\n        }\n        return redo(state);\n      }\n    };\n  },\n  addKeyboardShortcuts() {\n    return {\n      \"Mod-z\": () => this.editor.commands.undo(),\n      \"Mod-y\": () => this.editor.commands.redo(),\n      \"Shift-Mod-z\": () => this.editor.commands.redo()\n    };\n  },\n  addProseMirrorPlugins() {\n    var _a;\n    const fragment = this.options.fragment ? this.options.fragment : this.options.document.getXmlFragment(this.options.field);\n    const yUndoPluginInstance = yUndoPlugin(this.options.yUndoOptions);\n    const originalUndoPluginView = yUndoPluginInstance.spec.view;\n    yUndoPluginInstance.spec.view = (view) => {\n      const { undoManager } = yUndoPluginKey.getState(view.state);\n      if (undoManager.restore) {\n        undoManager.restore();\n        undoManager.restore = () => {\n        };\n      }\n      const viewRet = originalUndoPluginView ? originalUndoPluginView(view) : void 0;\n      return {\n        destroy: () => {\n          const hasUndoManSelf = undoManager.trackedOrigins.has(undoManager);\n          const observers = undoManager._observers;\n          undoManager.restore = () => {\n            if (hasUndoManSelf) {\n              undoManager.trackedOrigins.add(undoManager);\n            }\n            undoManager.doc.on(\"afterTransaction\", undoManager.afterTransactionHandler);\n            undoManager._observers = observers;\n          };\n          if (viewRet == null ? void 0 : viewRet.destroy) {\n            viewRet.destroy();\n          }\n        }\n      };\n    };\n    const ySyncPluginOptions = {\n      ...this.options.ySyncOptions,\n      onFirstRender: this.options.onFirstRender\n    };\n    const ySyncPluginInstance = ySyncPlugin(fragment, ySyncPluginOptions);\n    if (this.editor.options.enableContentCheck) {\n      (_a = fragment.doc) == null ? void 0 : _a.on(\"beforeTransaction\", () => {\n        try {\n          const jsonContent = yXmlFragmentToProsemirrorJSON(fragment);\n          if (jsonContent.content.length === 0) {\n            return;\n          }\n          this.editor.schema.nodeFromJSON(jsonContent).check();\n        } catch (error) {\n          this.editor.emit(\"contentError\", {\n            error,\n            editor: this.editor,\n            disableCollaboration: () => {\n              var _a2;\n              (_a2 = fragment.doc) == null ? void 0 : _a2.destroy();\n              this.storage.isDisabled = true;\n            }\n          });\n          return false;\n        }\n      });\n    }\n    return [\n      ySyncPluginInstance,\n      yUndoPluginInstance,\n      // Only add the filterInvalidContent plugin if content checking is enabled\n      this.editor.options.enableContentCheck && new Plugin({\n        key: new PluginKey(\"filterInvalidContent\"),\n        filterTransaction: () => {\n          var _a2;\n          if (this.storage.isDisabled !== false) {\n            (_a2 = fragment.doc) == null ? void 0 : _a2.destroy();\n            return true;\n          }\n          return true;\n        }\n      })\n    ].filter(Boolean);\n  }\n});\n\n// src/index.ts\nvar index_default = Collaboration;\nexport {\n  Collaboration,\n  CollaborationMappablePosition,\n  createMappablePosition,\n  index_default as default,\n  getUpdatedPosition,\n  isChangeOrigin\n};\n//# sourceMappingURL=index.js.map","/**\n * SPDX-FileCopyrightText: 2025 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\n/*\n * Handle the state of the full editor width toggle.\n *\n * If the css variable `--text-editor-max-width` is already set\n * for `document.body` it will be left as is and\n * no toggle will be shown in the text ui.\n * This way the collectives app handles it's per document width setting.\n *\n * Otherwise this composable handles the `is_full_width_editor` initial state.\n * It sets the css variable on the document accordingly.\n * The state is stored in a singleton to preserve and reuse it on the next mount.\n * It is persisted in the user settings across page reloads.\n *\n */\n\nimport axios from '@nextcloud/axios'\nimport { emit, subscribe } from '@nextcloud/event-bus'\nimport { loadState } from '@nextcloud/initial-state'\nimport { generateUrl } from '@nextcloud/router'\nimport { useIsMobile } from '@nextcloud/vue/composables/useIsMobile'\nimport {\n\tcomputed,\n\tinject,\n\tprovide,\n\treadonly,\n\tref,\n\twatch,\n\ttype InjectionKey,\n\ttype Ref,\n} from 'vue'\nimport { useEditorFlags } from './useEditorFlags'\n\n// Keep the current value around when leaving the editor and reopening\nlet valueSingleton = loadState('text', 'is_full_width_editor', false)\n\n// This is either the reactive value of the editor width toggle\n// or null if the width has already been set outside of text.\nexport const editorWidthKey = Symbol('text:editor:width') as InjectionKey<\n\tReadonly<Ref<boolean> | null>\n>\n\n// desktop: leave space for floating buttons and outline (2 * 40px) if necessary\n// wide screen: 80ch content, narrow screen: full width\nconst editorWidthDesktop = 'min(80ch, 100%)'\nconst editorWidthDesktopEnhanced = 'min(80ch, (100% - 2 * 40px))'\nconst fullEditorWidthDesktop = '100%'\nconst fullEditorWidthDesktopEnhanced = 'calc(100% - 2 * 40px)'\nconst editorWidthMobile = 'min(80ch, 100%)'\nconst fullEditorWidthMobile = '100%'\n\n/**\n * Detect if other apps (such as collectives) already configured texts max width.\n *\n * Check if document.body has a css variable `--text-editor-max-width` (either set or inherited).\n * Get the value set by text in the documentElement style.\n * If both values are set and match we assume text is handling the width.\n */\nfunction maxWidthSetOutsideOfText() {\n\tconst alreadySet = getComputedStyle(document.body).getPropertyValue(\n\t\t'--text-editor-max-width',\n\t)\n\tconst setByText = document.documentElement.style.getPropertyValue(\n\t\t'--text-editor-max-width',\n\t)\n\treturn Boolean(alreadySet) && alreadySet !== setByText\n}\n\nexport const provideEditorWidth = (useTableOfContents = true) => {\n\tconst isMobile = useIsMobile()\n\t// keep style that is already set - for example by collectives\n\tif (maxWidthSetOutsideOfText()) {\n\t\tprovide(editorWidthKey, null)\n\t\treturn { applyEditorWidth: () => {} }\n\t}\n\tconst isFullWidth = ref(valueSingleton)\n\tprovide(editorWidthKey, readonly(isFullWidth))\n\tsubscribe('text:editor:full-width', ({ value }) => {\n\t\tvalueSingleton = value\n\t\tisFullWidth.value = value\n\t})\n\tconst defaultEditorWidthDesktop = useTableOfContents\n\t\t? editorWidthDesktopEnhanced\n\t\t: editorWidthDesktop\n\tconst defaultFullEditorWidthDesktop = useTableOfContents\n\t\t? fullEditorWidthDesktopEnhanced\n\t\t: fullEditorWidthDesktop\n\tconst defaultEditorWidth = computed(() =>\n\t\tisMobile.value ? editorWidthMobile : defaultEditorWidthDesktop,\n\t)\n\tconst fullEditorWidth = computed(() =>\n\t\tisMobile.value ? fullEditorWidthMobile : defaultFullEditorWidthDesktop,\n\t)\n\tconst width = computed(() =>\n\t\tisFullWidth.value ? fullEditorWidth.value : defaultEditorWidth.value,\n\t)\n\tconst applyEditorWidth = () => {\n\t\tdocument.documentElement.style.setProperty(\n\t\t\t'--text-editor-max-width',\n\t\t\twidth.value,\n\t\t)\n\t}\n\twatch(width, applyEditorWidth)\n\treturn { applyEditorWidth }\n}\n\nexport const useEditorWidth = () => {\n\tconst isMobile = useIsMobile()\n\tconst { isRichWorkspace } = useEditorFlags()\n\n\t// This will be null if the width is already configured outside of text.\n\tconst isFullWidth = inject(editorWidthKey)\n\n\t// Disable if `editorWidthKey` got `null` injected or if in rich workspace or mobile view\n\tif (isFullWidth === null || isRichWorkspace || isMobile.value) {\n\t\treturn { canToggleWidth: false }\n\t}\n\tconst setFullWidth = (checked: boolean) => {\n\t\taxios.post(generateUrl('/apps/text/settings'), {\n\t\t\tkey: 'is_full_width_editor',\n\t\t\tvalue: checked ? '1' : '0',\n\t\t})\n\t\temit('text:editor:full-width', { value: checked })\n\t}\n\treturn { canToggleWidth: true, isFullWidth, setFullWidth }\n}\n","// src/node-range.ts\nimport { Extension } from \"@tiptap/core\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\n\n// src/helpers/getNodeRangeDecorations.ts\nimport { Decoration, DecorationSet } from \"@tiptap/pm/view\";\nfunction getNodeRangeDecorations(ranges) {\n  if (!ranges.length) {\n    return DecorationSet.empty;\n  }\n  const decorations = [];\n  const doc = ranges[0].$from.node(0);\n  ranges.forEach((range) => {\n    const pos = range.$from.pos;\n    const node = range.$from.nodeAfter;\n    if (!node) {\n      return;\n    }\n    decorations.push(\n      Decoration.node(pos, pos + node.nodeSize, {\n        class: \"ProseMirror-selectednoderange\"\n      })\n    );\n  });\n  return DecorationSet.create(doc, decorations);\n}\n\n// src/helpers/getSelectionRanges.ts\nimport { NodeRange } from \"@tiptap/pm/model\";\nimport { SelectionRange } from \"@tiptap/pm/state\";\nfunction getSelectionRanges($from, $to, depth) {\n  const ranges = [];\n  const doc = $from.node(0);\n  if (typeof depth === \"number\" && depth >= 0) {\n  } else if ($from.sameParent($to)) {\n    depth = Math.max(0, $from.sharedDepth($to.pos) - 1);\n  } else {\n    depth = $from.sharedDepth($to.pos);\n  }\n  const nodeRange = new NodeRange($from, $to, depth);\n  const offset = nodeRange.depth === 0 ? 0 : doc.resolve(nodeRange.start).posAtIndex(0);\n  nodeRange.parent.forEach((node, pos) => {\n    const from = offset + pos;\n    const to = from + node.nodeSize;\n    if (from < nodeRange.start || from >= nodeRange.end) {\n      return;\n    }\n    const selectionRange = new SelectionRange(doc.resolve(from), doc.resolve(to));\n    ranges.push(selectionRange);\n  });\n  return ranges;\n}\n\n// src/helpers/NodeRangeSelection.ts\nimport { Selection } from \"@tiptap/pm/state\";\n\n// src/helpers/NodeRangeBookmark.ts\nvar NodeRangeBookmark = class _NodeRangeBookmark {\n  constructor(anchor, head) {\n    this.anchor = anchor;\n    this.head = head;\n  }\n  map(mapping) {\n    return new _NodeRangeBookmark(mapping.map(this.anchor), mapping.map(this.head));\n  }\n  resolve(doc) {\n    const $anchor = doc.resolve(this.anchor);\n    const $head = doc.resolve(this.head);\n    return new NodeRangeSelection($anchor, $head);\n  }\n};\n\n// src/helpers/NodeRangeSelection.ts\nvar NodeRangeSelection = class _NodeRangeSelection extends Selection {\n  constructor($anchor, $head, depth, bias = 1) {\n    const { doc } = $anchor;\n    const isCursor = $anchor === $head;\n    const isCursorAtEnd = $anchor.pos === doc.content.size && $head.pos === doc.content.size;\n    const $correctedHead = isCursor && !isCursorAtEnd ? doc.resolve($head.pos + (bias > 0 ? 1 : -1)) : $head;\n    const $correctedAnchor = isCursor && isCursorAtEnd ? doc.resolve($anchor.pos - (bias > 0 ? 1 : -1)) : $anchor;\n    const ranges = getSelectionRanges($correctedAnchor.min($correctedHead), $correctedAnchor.max($correctedHead), depth);\n    const $rangeFrom = $correctedHead.pos >= $anchor.pos ? ranges[0].$from : ranges[ranges.length - 1].$to;\n    const $rangeTo = $correctedHead.pos >= $anchor.pos ? ranges[ranges.length - 1].$to : ranges[0].$from;\n    super($rangeFrom, $rangeTo, ranges);\n    this.depth = depth;\n  }\n  // we can safely ignore this TypeScript error: https://github.com/Microsoft/TypeScript/issues/338\n  // @ts-ignore\n  get $to() {\n    return this.ranges[this.ranges.length - 1].$to;\n  }\n  eq(other) {\n    return other instanceof _NodeRangeSelection && other.$from.pos === this.$from.pos && other.$to.pos === this.$to.pos;\n  }\n  map(doc, mapping) {\n    const $anchor = doc.resolve(mapping.map(this.anchor));\n    const $head = doc.resolve(mapping.map(this.head));\n    return new _NodeRangeSelection($anchor, $head);\n  }\n  toJSON() {\n    return {\n      type: \"nodeRange\",\n      anchor: this.anchor,\n      head: this.head\n    };\n  }\n  get isForwards() {\n    return this.head >= this.anchor;\n  }\n  get isBackwards() {\n    return !this.isForwards;\n  }\n  extendBackwards() {\n    const { doc } = this.$from;\n    if (this.isForwards && this.ranges.length > 1) {\n      const ranges = this.ranges.slice(0, -1);\n      const $from2 = ranges[0].$from;\n      const $to = ranges[ranges.length - 1].$to;\n      return new _NodeRangeSelection($from2, $to, this.depth);\n    }\n    const firstRange = this.ranges[0];\n    const $from = doc.resolve(Math.max(0, firstRange.$from.pos - 1));\n    return new _NodeRangeSelection(this.$anchor, $from, this.depth);\n  }\n  extendForwards() {\n    const { doc } = this.$from;\n    if (this.isBackwards && this.ranges.length > 1) {\n      const ranges = this.ranges.slice(1);\n      const $from = ranges[0].$from;\n      const $to2 = ranges[ranges.length - 1].$to;\n      return new _NodeRangeSelection($to2, $from, this.depth);\n    }\n    const lastRange = this.ranges[this.ranges.length - 1];\n    const $to = doc.resolve(Math.min(doc.content.size, lastRange.$to.pos + 1));\n    return new _NodeRangeSelection(this.$anchor, $to, this.depth);\n  }\n  static fromJSON(doc, json) {\n    return new _NodeRangeSelection(doc.resolve(json.anchor), doc.resolve(json.head));\n  }\n  static create(doc, anchor, head, depth, bias = 1) {\n    return new this(doc.resolve(anchor), doc.resolve(head), depth, bias);\n  }\n  getBookmark() {\n    return new NodeRangeBookmark(this.anchor, this.head);\n  }\n};\nNodeRangeSelection.prototype.visible = false;\n\n// src/helpers/isNodeRangeSelection.ts\nfunction isNodeRangeSelection(value) {\n  return value instanceof NodeRangeSelection;\n}\n\n// src/node-range.ts\nvar NodeRange2 = Extension.create({\n  name: \"nodeRange\",\n  addOptions() {\n    return {\n      depth: void 0,\n      key: \"Mod\"\n    };\n  },\n  addKeyboardShortcuts() {\n    return {\n      // extend NodeRangeSelection upwards\n      \"Shift-ArrowUp\": ({ editor }) => {\n        const { depth } = this.options;\n        const { view, state } = editor;\n        const { doc, selection, tr } = state;\n        const { anchor, head } = selection;\n        if (!isNodeRangeSelection(selection)) {\n          const nodeRangeSelection2 = NodeRangeSelection.create(doc, anchor, head, depth, -1);\n          tr.setSelection(nodeRangeSelection2);\n          view.dispatch(tr);\n          return true;\n        }\n        const nodeRangeSelection = selection.extendBackwards();\n        tr.setSelection(nodeRangeSelection);\n        view.dispatch(tr);\n        return true;\n      },\n      // extend NodeRangeSelection downwards\n      \"Shift-ArrowDown\": ({ editor }) => {\n        const { depth } = this.options;\n        const { view, state } = editor;\n        const { doc, selection, tr } = state;\n        const { anchor, head } = selection;\n        if (!isNodeRangeSelection(selection)) {\n          const nodeRangeSelection2 = NodeRangeSelection.create(doc, anchor, head, depth);\n          tr.setSelection(nodeRangeSelection2);\n          view.dispatch(tr);\n          return true;\n        }\n        const nodeRangeSelection = selection.extendForwards();\n        tr.setSelection(nodeRangeSelection);\n        view.dispatch(tr);\n        return true;\n      },\n      // add `NodeRangeSelection` to all nodes\n      \"Mod-a\": ({ editor }) => {\n        const { depth } = this.options;\n        const { view, state } = editor;\n        const { doc, tr } = state;\n        const nodeRangeSelection = NodeRangeSelection.create(doc, 0, doc.content.size, depth);\n        tr.setSelection(nodeRangeSelection);\n        view.dispatch(tr);\n        return true;\n      }\n    };\n  },\n  onSelectionUpdate() {\n    const { selection } = this.editor.state;\n    if (isNodeRangeSelection(selection)) {\n      this.editor.view.dom.classList.add(\"ProseMirror-noderangeselection\");\n    }\n  },\n  addProseMirrorPlugins() {\n    let hideTextSelection = false;\n    let activeMouseSelection = false;\n    return [\n      new Plugin({\n        key: new PluginKey(\"nodeRange\"),\n        props: {\n          attributes: () => {\n            if (hideTextSelection) {\n              return {\n                class: \"ProseMirror-noderangeselection\"\n              };\n            }\n            return { class: \"\" };\n          },\n          handleDOMEvents: {\n            mousedown: (view, event) => {\n              const { key } = this.options;\n              const isMac = /Mac/.test(navigator.platform);\n              const isShift = !!event.shiftKey;\n              const isControl = !!event.ctrlKey;\n              const isAlt = !!event.altKey;\n              const isMeta = !!event.metaKey;\n              const isMod = isMac ? isMeta : isControl;\n              if (key === null || key === void 0 || key === \"Shift\" && isShift || key === \"Control\" && isControl || key === \"Alt\" && isAlt || key === \"Meta\" && isMeta || key === \"Mod\" && isMod) {\n                activeMouseSelection = true;\n              }\n              if (!activeMouseSelection) {\n                return false;\n              }\n              document.addEventListener(\n                \"mouseup\",\n                () => {\n                  activeMouseSelection = false;\n                  const { state } = view;\n                  const { doc, selection, tr } = state;\n                  const { $anchor, $head } = selection;\n                  if ($anchor.sameParent($head)) {\n                    return;\n                  }\n                  const nodeRangeSelection = NodeRangeSelection.create(doc, $anchor.pos, $head.pos, this.options.depth);\n                  tr.setSelection(nodeRangeSelection);\n                  view.dispatch(tr);\n                },\n                { once: true }\n              );\n              return false;\n            }\n          },\n          // when selecting some text we want to render some decorations\n          // to preview a `NodeRangeSelection`\n          decorations: (state) => {\n            const { selection } = state;\n            const isNodeRange = isNodeRangeSelection(selection);\n            hideTextSelection = false;\n            if (!activeMouseSelection) {\n              if (!isNodeRange) {\n                return null;\n              }\n              hideTextSelection = true;\n              return getNodeRangeDecorations(selection.ranges);\n            }\n            const { $from, $to } = selection;\n            if (!isNodeRange && $from.sameParent($to)) {\n              return null;\n            }\n            const nodeRanges = getSelectionRanges($from, $to, this.options.depth);\n            if (!nodeRanges.length) {\n              return null;\n            }\n            hideTextSelection = true;\n            return getNodeRangeDecorations(nodeRanges);\n          }\n        }\n      })\n    ];\n  }\n});\n\n// src/index.ts\nvar index_default = NodeRange2;\nexport {\n  NodeRange2 as NodeRange,\n  NodeRangeSelection,\n  index_default as default,\n  getNodeRangeDecorations,\n  getSelectionRanges,\n  isNodeRangeSelection\n};\n//# sourceMappingURL=index.js.map","// src/drag-handle.ts\nimport { Extension } from \"@tiptap/core\";\n\n// src/drag-handle-plugin.ts\nimport { computePosition } from \"@floating-ui/dom\";\nimport { isChangeOrigin } from \"@tiptap/extension-collaboration\";\nimport { Plugin, PluginKey } from \"@tiptap/pm/state\";\nimport {\n  absolutePositionToRelativePosition,\n  relativePositionToAbsolutePosition,\n  ySyncPluginKey\n} from \"@tiptap/y-tiptap\";\n\n// src/helpers/dragHandler.ts\nimport { getSelectionRanges, NodeRangeSelection } from \"@tiptap/extension-node-range\";\n\n// src/helpers/cloneElement.ts\nfunction getCSSText(element) {\n  let value = \"\";\n  const style = getComputedStyle(element);\n  for (let i = 0; i < style.length; i += 1) {\n    value += `${style[i]}:${style.getPropertyValue(style[i])};`;\n  }\n  return value;\n}\nfunction cloneElement(node) {\n  const clonedNode = node.cloneNode(true);\n  const sourceElements = [node, ...Array.from(node.getElementsByTagName(\"*\"))];\n  const targetElements = [clonedNode, ...Array.from(clonedNode.getElementsByTagName(\"*\"))];\n  sourceElements.forEach((sourceElement, index) => {\n    targetElements[index].style.cssText = getCSSText(sourceElement);\n  });\n  return clonedNode;\n}\n\n// src/helpers/findNextElementFromCursor.ts\nfunction findClosestTopLevelBlock(element, view) {\n  let current = element;\n  while ((current == null ? void 0 : current.parentElement) && current.parentElement !== view.dom) {\n    current = current.parentElement;\n  }\n  return (current == null ? void 0 : current.parentElement) === view.dom ? current : void 0;\n}\nfunction clampToContent(view, x, y, inset = 5) {\n  const container = view.dom;\n  const firstBlock = container.firstElementChild;\n  const lastBlock = container.lastElementChild;\n  if (!firstBlock || !lastBlock) {\n    return { x, y };\n  }\n  const topRect = firstBlock.getBoundingClientRect();\n  const botRect = lastBlock.getBoundingClientRect();\n  const clampedY = Math.min(Math.max(topRect.top + inset, y), botRect.bottom - inset);\n  const epsilon = 0.5;\n  const sameLeft = Math.abs(topRect.left - botRect.left) < epsilon;\n  const sameRight = Math.abs(topRect.right - botRect.right) < epsilon;\n  let rowRect = topRect;\n  if (sameLeft && sameRight) {\n    rowRect = topRect;\n  } else {\n  }\n  const clampedX = Math.min(Math.max(rowRect.left + inset, x), rowRect.right - inset);\n  return { x: clampedX, y: clampedY };\n}\nvar findElementNextToCoords = (options) => {\n  const { x, y, editor } = options;\n  const { view, state } = editor;\n  const { x: clampedX, y: clampedY } = clampToContent(view, x, y, 5);\n  const elements = view.root.elementsFromPoint(clampedX, clampedY);\n  let block;\n  Array.prototype.some.call(elements, (el) => {\n    if (!view.dom.contains(el)) {\n      return false;\n    }\n    const candidate = findClosestTopLevelBlock(el, view);\n    if (candidate) {\n      block = candidate;\n      return true;\n    }\n    return false;\n  });\n  if (!block) {\n    return { resultElement: null, resultNode: null, pos: null };\n  }\n  let pos;\n  try {\n    pos = view.posAtDOM(block, 0);\n  } catch {\n    return { resultElement: null, resultNode: null, pos: null };\n  }\n  const node = state.doc.nodeAt(pos);\n  if (!node) {\n    const resolvedPos = state.doc.resolve(pos);\n    const parent = resolvedPos.parent;\n    return {\n      resultElement: block,\n      resultNode: parent,\n      pos: resolvedPos.start()\n    };\n  }\n  return {\n    resultElement: block,\n    resultNode: node,\n    pos\n  };\n};\n\n// src/helpers/getComputedStyle.ts\nfunction getComputedStyle2(node, property) {\n  const style = window.getComputedStyle(node);\n  return style[property];\n}\n\n// src/helpers/minMax.ts\nfunction minMax(value = 0, min = 0, max = 0) {\n  return Math.min(Math.max(value, min), max);\n}\n\n// src/helpers/getInnerCoords.ts\nfunction getInnerCoords(view, x, y) {\n  const paddingLeft = parseInt(getComputedStyle2(view.dom, \"paddingLeft\"), 10);\n  const paddingRight = parseInt(getComputedStyle2(view.dom, \"paddingRight\"), 10);\n  const borderLeft = parseInt(getComputedStyle2(view.dom, \"borderLeftWidth\"), 10);\n  const borderRight = parseInt(getComputedStyle2(view.dom, \"borderLeftWidth\"), 10);\n  const bounds = view.dom.getBoundingClientRect();\n  const coords = {\n    left: minMax(x, bounds.left + paddingLeft + borderLeft, bounds.right - paddingRight - borderRight),\n    top: y\n  };\n  return coords;\n}\n\n// src/helpers/removeNode.ts\nfunction removeNode(node) {\n  var _a;\n  (_a = node.parentNode) == null ? void 0 : _a.removeChild(node);\n}\n\n// src/helpers/dragHandler.ts\nfunction getDragHandleRanges(event, editor) {\n  const { doc } = editor.view.state;\n  const result = findElementNextToCoords({\n    editor,\n    x: event.clientX,\n    y: event.clientY,\n    direction: \"right\"\n  });\n  if (!result.resultNode || result.pos === null) {\n    return [];\n  }\n  const x = event.clientX;\n  const coords = getInnerCoords(editor.view, x, event.clientY);\n  const posAtCoords = editor.view.posAtCoords(coords);\n  if (!posAtCoords) {\n    return [];\n  }\n  const { pos } = posAtCoords;\n  const nodeAt = doc.resolve(pos).parent;\n  if (!nodeAt) {\n    return [];\n  }\n  const $from = doc.resolve(result.pos);\n  const $to = doc.resolve(result.pos + 1);\n  return getSelectionRanges($from, $to, 0);\n}\nfunction dragHandler(event, editor) {\n  const { view } = editor;\n  if (!event.dataTransfer) {\n    return;\n  }\n  const { empty, $from, $to } = view.state.selection;\n  const dragHandleRanges = getDragHandleRanges(event, editor);\n  const selectionRanges = getSelectionRanges($from, $to, 0);\n  const isDragHandleWithinSelection = selectionRanges.some((range) => {\n    return dragHandleRanges.find((dragHandleRange) => {\n      return dragHandleRange.$from === range.$from && dragHandleRange.$to === range.$to;\n    });\n  });\n  const ranges = empty || !isDragHandleWithinSelection ? dragHandleRanges : selectionRanges;\n  if (!ranges.length) {\n    return;\n  }\n  const { tr } = view.state;\n  const wrapper = document.createElement(\"div\");\n  const from = ranges[0].$from.pos;\n  const to = ranges[ranges.length - 1].$to.pos;\n  const selection = NodeRangeSelection.create(view.state.doc, from, to);\n  const slice = selection.content();\n  ranges.forEach((range) => {\n    const element = view.nodeDOM(range.$from.pos);\n    const clonedElement = cloneElement(element);\n    wrapper.append(clonedElement);\n  });\n  wrapper.style.position = \"absolute\";\n  wrapper.style.top = \"-10000px\";\n  document.body.append(wrapper);\n  event.dataTransfer.clearData();\n  event.dataTransfer.setDragImage(wrapper, 0, 0);\n  view.dragging = { slice, move: true };\n  tr.setSelection(selection);\n  view.dispatch(tr);\n  document.addEventListener(\"drop\", () => removeNode(wrapper), { once: true });\n}\n\n// src/helpers/getOuterNode.ts\nvar getOuterNodePos = (doc, pos) => {\n  const resolvedPos = doc.resolve(pos);\n  const { depth } = resolvedPos;\n  if (depth === 0) {\n    return pos;\n  }\n  const a = resolvedPos.pos - resolvedPos.parentOffset;\n  return a - 1;\n};\nvar getOuterNode = (doc, pos) => {\n  const node = doc.nodeAt(pos);\n  const resolvedPos = doc.resolve(pos);\n  let { depth } = resolvedPos;\n  let parent = node;\n  while (depth > 0) {\n    const currentNode = resolvedPos.node(depth);\n    depth -= 1;\n    if (depth === 0) {\n      parent = currentNode;\n    }\n  }\n  return parent;\n};\n\n// src/drag-handle-plugin.ts\nvar getRelativePos = (state, absolutePos) => {\n  const ystate = ySyncPluginKey.getState(state);\n  if (!ystate) {\n    return null;\n  }\n  return absolutePositionToRelativePosition(absolutePos, ystate.type, ystate.binding.mapping);\n};\nvar getAbsolutePos = (state, relativePos) => {\n  const ystate = ySyncPluginKey.getState(state);\n  if (!ystate) {\n    return -1;\n  }\n  return relativePositionToAbsolutePosition(ystate.doc, ystate.type, relativePos, ystate.binding.mapping) || 0;\n};\nvar getOuterDomNode = (view, domNode) => {\n  let tmpDomNode = domNode;\n  while (tmpDomNode == null ? void 0 : tmpDomNode.parentNode) {\n    if (tmpDomNode.parentNode === view.dom) {\n      break;\n    }\n    tmpDomNode = tmpDomNode.parentNode;\n  }\n  return tmpDomNode;\n};\nvar dragHandlePluginDefaultKey = new PluginKey(\"dragHandle\");\nvar DragHandlePlugin = ({\n  pluginKey = dragHandlePluginDefaultKey,\n  element,\n  editor,\n  computePositionConfig,\n  getReferencedVirtualElement,\n  onNodeChange,\n  onElementDragStart,\n  onElementDragEnd\n}) => {\n  const wrapper = document.createElement(\"div\");\n  let locked = false;\n  let currentNode = null;\n  let currentNodePos = -1;\n  let currentNodeRelPos;\n  let rafId = null;\n  let pendingMouseCoords = null;\n  function hideHandle() {\n    if (!element) {\n      return;\n    }\n    element.style.visibility = \"hidden\";\n    element.style.pointerEvents = \"none\";\n  }\n  function showHandle() {\n    if (!element) {\n      return;\n    }\n    if (!editor.isEditable) {\n      hideHandle();\n      return;\n    }\n    element.style.visibility = \"\";\n    element.style.pointerEvents = \"auto\";\n  }\n  function repositionDragHandle(dom) {\n    const virtualElement = (getReferencedVirtualElement == null ? void 0 : getReferencedVirtualElement()) || {\n      getBoundingClientRect: () => dom.getBoundingClientRect()\n    };\n    computePosition(virtualElement, element, computePositionConfig).then((val) => {\n      Object.assign(element.style, {\n        position: val.strategy,\n        left: `${val.x}px`,\n        top: `${val.y}px`\n      });\n    });\n  }\n  function onDragStart(e) {\n    onElementDragStart == null ? void 0 : onElementDragStart(e);\n    dragHandler(e, editor);\n    if (element) {\n      element.dataset.dragging = \"true\";\n    }\n    setTimeout(() => {\n      if (element) {\n        element.style.pointerEvents = \"none\";\n      }\n    }, 0);\n  }\n  function onDragEnd(e) {\n    onElementDragEnd == null ? void 0 : onElementDragEnd(e);\n    hideHandle();\n    if (element) {\n      element.style.pointerEvents = \"auto\";\n      element.dataset.dragging = \"false\";\n    }\n  }\n  element.addEventListener(\"dragstart\", onDragStart);\n  element.addEventListener(\"dragend\", onDragEnd);\n  wrapper.appendChild(element);\n  return {\n    unbind() {\n      element.removeEventListener(\"dragstart\", onDragStart);\n      element.removeEventListener(\"dragend\", onDragEnd);\n      if (rafId) {\n        cancelAnimationFrame(rafId);\n        rafId = null;\n        pendingMouseCoords = null;\n      }\n    },\n    plugin: new Plugin({\n      key: typeof pluginKey === \"string\" ? new PluginKey(pluginKey) : pluginKey,\n      state: {\n        init() {\n          return { locked: false };\n        },\n        apply(tr, value, _oldState, state) {\n          const isLocked = tr.getMeta(\"lockDragHandle\");\n          const hideDragHandle = tr.getMeta(\"hideDragHandle\");\n          if (isLocked !== void 0) {\n            locked = isLocked;\n          }\n          if (hideDragHandle) {\n            hideHandle();\n            locked = false;\n            currentNode = null;\n            currentNodePos = -1;\n            onNodeChange == null ? void 0 : onNodeChange({ editor, node: null, pos: -1 });\n            return value;\n          }\n          if (tr.docChanged && currentNodePos !== -1 && element) {\n            if (isChangeOrigin(tr)) {\n              const newPos = getAbsolutePos(state, currentNodeRelPos);\n              if (newPos !== currentNodePos) {\n                currentNodePos = newPos;\n              }\n            } else {\n              const newPos = tr.mapping.map(currentNodePos);\n              if (newPos !== currentNodePos) {\n                currentNodePos = newPos;\n                currentNodeRelPos = getRelativePos(state, currentNodePos);\n              }\n            }\n          }\n          return value;\n        }\n      },\n      view: (view) => {\n        var _a;\n        element.draggable = true;\n        element.style.pointerEvents = \"auto\";\n        element.dataset.dragging = \"false\";\n        (_a = editor.view.dom.parentElement) == null ? void 0 : _a.appendChild(wrapper);\n        wrapper.style.pointerEvents = \"none\";\n        wrapper.style.position = \"absolute\";\n        wrapper.style.top = \"0\";\n        wrapper.style.left = \"0\";\n        return {\n          update(_, oldState) {\n            if (!element) {\n              return;\n            }\n            if (!editor.isEditable) {\n              hideHandle();\n              return;\n            }\n            if (locked) {\n              element.draggable = false;\n            } else {\n              element.draggable = true;\n            }\n            if (view.state.doc.eq(oldState.doc) || currentNodePos === -1) {\n              return;\n            }\n            let domNode = view.nodeDOM(currentNodePos);\n            domNode = getOuterDomNode(view, domNode);\n            if (domNode === view.dom) {\n              return;\n            }\n            if ((domNode == null ? void 0 : domNode.nodeType) !== 1) {\n              return;\n            }\n            const domNodePos = view.posAtDOM(domNode, 0);\n            const outerNode = getOuterNode(editor.state.doc, domNodePos);\n            const outerNodePos = getOuterNodePos(editor.state.doc, domNodePos);\n            currentNode = outerNode;\n            currentNodePos = outerNodePos;\n            currentNodeRelPos = getRelativePos(view.state, currentNodePos);\n            onNodeChange == null ? void 0 : onNodeChange({ editor, node: currentNode, pos: currentNodePos });\n            repositionDragHandle(domNode);\n          },\n          // TODO: Kills even on hot reload\n          destroy() {\n            if (rafId) {\n              cancelAnimationFrame(rafId);\n              rafId = null;\n              pendingMouseCoords = null;\n            }\n            if (element) {\n              removeNode(wrapper);\n            }\n          }\n        };\n      },\n      props: {\n        handleDOMEvents: {\n          keydown(view) {\n            if (!element || locked) {\n              return false;\n            }\n            if (view.hasFocus()) {\n              hideHandle();\n              currentNode = null;\n              currentNodePos = -1;\n              onNodeChange == null ? void 0 : onNodeChange({ editor, node: null, pos: -1 });\n              return false;\n            }\n            return false;\n          },\n          mouseleave(_view, e) {\n            if (locked) {\n              return false;\n            }\n            if (e.target && !wrapper.contains(e.relatedTarget)) {\n              hideHandle();\n              currentNode = null;\n              currentNodePos = -1;\n              onNodeChange == null ? void 0 : onNodeChange({ editor, node: null, pos: -1 });\n            }\n            return false;\n          },\n          mousemove(view, e) {\n            if (!element || locked) {\n              return false;\n            }\n            pendingMouseCoords = { x: e.clientX, y: e.clientY };\n            if (rafId) {\n              return false;\n            }\n            rafId = requestAnimationFrame(() => {\n              rafId = null;\n              if (!pendingMouseCoords) {\n                return;\n              }\n              const { x, y } = pendingMouseCoords;\n              pendingMouseCoords = null;\n              const nodeData = findElementNextToCoords({\n                x,\n                y,\n                direction: \"right\",\n                editor\n              });\n              if (!nodeData.resultElement) {\n                return;\n              }\n              let domNode = nodeData.resultElement;\n              domNode = getOuterDomNode(view, domNode);\n              if (domNode === view.dom) {\n                return;\n              }\n              if ((domNode == null ? void 0 : domNode.nodeType) !== 1) {\n                return;\n              }\n              const domNodePos = view.posAtDOM(domNode, 0);\n              const outerNode = getOuterNode(editor.state.doc, domNodePos);\n              if (outerNode !== currentNode) {\n                const outerNodePos = getOuterNodePos(editor.state.doc, domNodePos);\n                currentNode = outerNode;\n                currentNodePos = outerNodePos;\n                currentNodeRelPos = getRelativePos(view.state, currentNodePos);\n                onNodeChange == null ? void 0 : onNodeChange({ editor, node: currentNode, pos: currentNodePos });\n                repositionDragHandle(domNode);\n                showHandle();\n              }\n            });\n            return false;\n          }\n        }\n      }\n    })\n  };\n};\n\n// src/drag-handle.ts\nvar defaultComputePositionConfig = {\n  placement: \"left-start\",\n  strategy: \"absolute\"\n};\nvar DragHandle = Extension.create({\n  name: \"dragHandle\",\n  addOptions() {\n    return {\n      render() {\n        const element = document.createElement(\"div\");\n        element.classList.add(\"drag-handle\");\n        return element;\n      },\n      computePositionConfig: {},\n      locked: false,\n      onNodeChange: () => {\n        return null;\n      },\n      onElementDragStart: void 0,\n      onElementDragEnd: void 0\n    };\n  },\n  addCommands() {\n    return {\n      lockDragHandle: () => ({ editor }) => {\n        this.options.locked = true;\n        return editor.commands.setMeta(\"lockDragHandle\", this.options.locked);\n      },\n      unlockDragHandle: () => ({ editor }) => {\n        this.options.locked = false;\n        return editor.commands.setMeta(\"lockDragHandle\", this.options.locked);\n      },\n      toggleDragHandle: () => ({ editor }) => {\n        this.options.locked = !this.options.locked;\n        return editor.commands.setMeta(\"lockDragHandle\", this.options.locked);\n      }\n    };\n  },\n  addProseMirrorPlugins() {\n    const element = this.options.render();\n    return [\n      DragHandlePlugin({\n        computePositionConfig: { ...defaultComputePositionConfig, ...this.options.computePositionConfig },\n        getReferencedVirtualElement: this.options.getReferencedVirtualElement,\n        element,\n        editor: this.editor,\n        onNodeChange: this.options.onNodeChange,\n        onElementDragStart: this.options.onElementDragStart,\n        onElementDragEnd: this.options.onElementDragEnd\n      }).plugin\n    ];\n  }\n});\n\n// src/index.ts\nvar index_default = DragHandle;\nexport {\n  DragHandle,\n  DragHandlePlugin,\n  index_default as default,\n  defaultComputePositionConfig,\n  dragHandlePluginDefaultKey\n};\n//# sourceMappingURL=index.js.map","// src/DragHandle.ts\nimport {\n  defaultComputePositionConfig,\n  DragHandlePlugin,\n  dragHandlePluginDefaultKey\n} from \"@tiptap/extension-drag-handle\";\n\n// src/Vue.ts\nimport VueDefault from \"vue\";\nvar Vue = VueDefault;\n\n// src/DragHandle.ts\nvar DragHandle = Vue.extend({\n  name: \"DragHandleVue\",\n  props: {\n    pluginKey: {\n      type: [String, Object],\n      default: () => dragHandlePluginDefaultKey\n    },\n    editor: {\n      type: Object,\n      required: true\n    },\n    computePositionConfig: {\n      type: Object,\n      default: () => ({})\n    },\n    onNodeChange: {\n      type: Function,\n      default: null\n    },\n    onElementDragStart: {\n      type: Function,\n      default: null\n    },\n    onElementDragEnd: {\n      type: Function,\n      default: null\n    },\n    class: {\n      type: String,\n      default: \"drag-handle\"\n    }\n  },\n  mounted() {\n    const { editor, pluginKey, onNodeChange, onElementDragStart, onElementDragEnd } = this.$props;\n    editor.registerPlugin(\n      DragHandlePlugin({\n        editor,\n        element: this.$el,\n        pluginKey,\n        computePositionConfig: { ...defaultComputePositionConfig, ...this.computePositionConfig },\n        onNodeChange,\n        onElementDragStart,\n        onElementDragEnd\n      }).plugin\n    );\n  },\n  // eslint-disable-next-line vue/no-deprecated-destroyed-lifecycle\n  beforeDestroy() {\n    const { pluginKey, editor } = this.$props;\n    editor.unregisterPlugin(pluginKey);\n  },\n  render(h) {\n    return h(\n      \"div\",\n      {\n        class: this.class,\n        attrs: {\n          \"data-dragging\": \"false\"\n        }\n      },\n      this.$slots.default\n    );\n  }\n});\n\n// src/index.ts\nvar index_default = DragHandle;\nexport {\n  DragHandle,\n  index_default as default\n};\n//# sourceMappingURL=index.js.map","<template>\n  <span v-bind=\"$attrs\"\n        :aria-hidden=\"title ? null : 'true'\"\n        :aria-label=\"title\"\n        class=\"material-design-icon drag-vertical-icon\"\n        role=\"img\"\n        @click=\"$emit('click', $event)\">\n    <svg :fill=\"fillColor\"\n         class=\"material-design-icon__svg\"\n         :width=\"size\"\n         :height=\"size\"\n         viewBox=\"0 0 24 24\">\n      <path d=\"M9,3H11V5H9V3M13,3H15V5H13V3M9,7H11V9H9V7M13,7H15V9H13V7M9,11H11V13H9V11M13,11H15V13H13V11M9,15H11V17H9V15M13,15H15V17H13V15M9,19H11V21H9V19M13,19H15V21H13V19Z\">\n        <title v-if=\"title\">{{ title }}</title>\n      </path>\n    </svg>\n  </span>\n</template>\n\n<script>\nexport default {\n  name: \"DragVerticalIcon\",\n  emits: ['click'],\n  props: {\n    title: {\n      type: String,\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n}\n</script>","<!--\n  - SPDX-FileCopyrightText: 2025 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<DragHandle\n\t\t:editor=\"editor\"\n\t\tclass=\"floating-buttons\"\n\t\t:class=\"{ heading: isHeadingNode }\"\n\t\t:on-node-change=\"onNodeChange\">\n\t\t<NcButton\n\t\t\tvariant=\"tertiary-no-background\"\n\t\t\tsize=\"small\"\n\t\t\t:title=\"t('text', 'Insert below')\"\n\t\t\t:aria-label=\"t('text', 'Insert below')\"\n\t\t\t@click=\"onOpenSmartPicker\">\n\t\t\t<template #icon>\n\t\t\t\t<PlusIcon :size=\"16\" />\n\t\t\t</template>\n\t\t</NcButton>\n\t\t<NcButton\n\t\t\tvariant=\"tertiary-no-background\"\n\t\t\tsize=\"small\"\n\t\t\tclass=\"drag-button\"\n\t\t\t:title=\"t('text', 'Click for options, hold to drag')\"\n\t\t\t:aria-label=\"t('text', 'Click for options, hold to drag')\">\n\t\t\t<template #icon>\n\t\t\t\t<DragVerticalIcon :size=\"16\" />\n\t\t\t</template>\n\t\t</NcButton>\n\t</DragHandle>\n</template>\n\n<script>\nimport { t } from '@nextcloud/l10n'\nimport NcButton from '@nextcloud/vue/components/NcButton'\nimport { DragHandle } from '@tiptap/extension-drag-handle-vue-2'\nimport DragVerticalIcon from 'vue-material-design-icons/DragVertical.vue'\nimport PlusIcon from 'vue-material-design-icons/Plus.vue'\nimport { useEditor } from '../../composables/useEditor.ts'\n\nexport default {\n\tname: 'FloatingButtons',\n\n\tcomponents: {\n\t\tDragHandle,\n\t\tDragVerticalIcon,\n\t\tNcButton,\n\t\tPlusIcon,\n\t},\n\n\tsetup() {\n\t\tconst { editor } = useEditor()\n\t\treturn { editor }\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tnode: null,\n\t\t\tpos: -1,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tisHeadingNode() {\n\t\t\treturn this.node?.type === this.editor.schema.nodes.heading\n\t\t},\n\t},\n\n\tmethods: {\n\t\tonNodeChange({ node, pos }) {\n\t\t\tthis.node = node\n\t\t\tthis.pos = pos\n\t\t},\n\t\tonOpenSmartPicker() {\n\t\t\tif (!this.node || this.pos === -1) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\t// Node has no children or just text children and no text content\n\t\t\tconst { schema } = this.editor\n\t\t\tconst emptyNode =\n\t\t\t\tthis.node.textContent.trim() === ''\n\t\t\t\t&& (this.node.children.length === 0\n\t\t\t\t\t|| this.node.children.every((n) => n.type === schema.nodes.text))\n\n\t\t\t// Insert at the end of the node\n\t\t\tconst pos = emptyNode ? this.pos + 1 : this.pos + this.node.nodeSize\n\t\t\tthis.editor.chain().insertContentAt(pos, '/').focus().run()\n\t\t},\n\t\tt,\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.floating-buttons {\n\tdisplay: flex;\n\n\t&.heading {\n\t\tmargin-right: 16px;\n\t}\n}\n\n.drag-button {\n\tcursor: grab;\n\n\t:deep(span),\n\t:deep(svg) {\n\t\tcursor: grab !important;\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div data-text-el=\"editor-content-wrapper\" class=\"editor__content-wrapper\">\n\t\t<slot />\n\t\t<FloatingButtons v-if=\"showFloatingButtons\" />\n\t\t<EditorContent\n\t\t\trole=\"document\"\n\t\t\tclass=\"editor__content text-editor__content\"\n\t\t\t:editor=\"editor\" />\n\t\t<TocContainer v-if=\"useTableOfContents\" />\n\t</div>\n</template>\n\n<script>\nimport { useIsMobile } from '@nextcloud/vue/composables/useIsMobile'\nimport { EditorContent } from '@tiptap/vue-2'\nimport { useEditor } from '../../composables/useEditor.ts'\nimport { useEditorFlags } from '../../composables/useEditorFlags.ts'\nimport FloatingButtons from './FloatingButtons.vue'\nimport TocContainer from './TableOfContents/TocContainer.vue'\n\nexport default {\n\tname: 'ContentContainer',\n\tcomponents: {\n\t\tEditorContent,\n\t\tFloatingButtons,\n\t\tTocContainer,\n\t},\n\tprops: {\n\t\treadOnly: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup() {\n\t\tconst isMobile = useIsMobile()\n\t\tconst { editor } = useEditor()\n\t\tconst { isRichEditor, isRichWorkspace, useTableOfContents } =\n\t\t\tuseEditorFlags()\n\t\treturn {\n\t\t\teditor,\n\t\t\tisMobile,\n\t\t\tisRichEditor,\n\t\t\tisRichWorkspace,\n\t\t\tuseTableOfContents,\n\t\t}\n\t},\n\tcomputed: {\n\t\tshowFloatingButtons() {\n\t\t\treturn (\n\t\t\t\t!this.readOnly\n\t\t\t\t&& !this.isMobile\n\t\t\t\t&& this.isRichEditor\n\t\t\t\t&& !this.isRichWorkspace\n\t\t\t)\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.editor__content-wrapper {\n\tflex-grow: 1;\n}\n\n.editor__content {\n\tmax-width: var(--text-editor-max-width);\n\tmargin: 0 auto;\n\tposition: relative;\n\t:deep([contenteditable]) {\n\t\t// drop off obsolete server styles\n\t\tmargin: 0 !important;\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2025 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\nimport { unref, type ShallowRef } from 'vue'\nimport type { Connection } from '../composables/useConnection'\n\n/**\n * Upload an attachment to the server.\n * @param connection the active connection.\n * @param file upload this file.\n */\nexport function uploadAttachment(\n\tconnection: ShallowRef<Connection> | Connection,\n\tfile: string | Blob,\n) {\n\tconst {\n\t\tdocumentId,\n\t\tsessionId,\n\t\tsessionToken,\n\t\tshareToken: token,\n\t} = unref(connection)\n\tconst formData = new FormData()\n\tformData.append('file', file)\n\tconst url = generateUrl(`apps/text/attachment/upload?`)\n\treturn axios.post(url, formData, {\n\t\theaders: { 'Content-Type': 'multipart/form-data' },\n\t\tparams: { documentId, sessionId, sessionToken, token },\n\t})\n}\n\n/**\n * Create a new attachment based on the given template\n * @param connection the active connection\n * @param template create the attachment based on this\n * @param template.app app to create the attachment with\n * @param template.extension extension to use\n */\nexport function createAttachment(\n\tconnection: ShallowRef<Connection> | Connection,\n\ttemplate: { app: string; extension: string },\n) {\n\tconst { documentId, sessionId, sessionToken } = unref(connection)\n\tconst url = generateUrl(`apps/text/attachment/create`)\n\treturn axios.post(url, {\n\t\tdocumentId,\n\t\tsessionId,\n\t\tsessionToken,\n\t\tfileName: `${template.app}${template.extension}`,\n\t})\n}\n\n/**\n * Create a new attachment based on the given template\n * @param connection the active connection\n * @param filePath path to the file on the server.\n */\nexport function insertAttachmentFile(\n\tconnection: ShallowRef<Connection> | Connection,\n\tfilePath: string,\n) {\n\tconst { documentId, sessionId, sessionToken } = unref(connection)\n\tconst url = generateUrl(`apps/text/attachment/filepath`)\n\treturn axios.post(url, {\n\t\tdocumentId,\n\t\tsessionId,\n\t\tsessionToken,\n\t\tfilePath,\n\t})\n}\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div\n\t\tclass=\"editor editor-media-handler\"\n\t\tdata-text-el=\"editor-media-handler\"\n\t\t:class=\"{ draggedOver, 'is-mobile': isMobile }\"\n\t\t@image-paste=\"onPaste\"\n\t\t@dragover.prevent.stop=\"setDraggedOver(true, $event)\"\n\t\t@dragleave.prevent.stop=\"setDraggedOver(false, $event)\"\n\t\t@drop.prevent.stop=\"setDraggedOver(false, $event)\"\n\t\t@file-drop=\"onEditorDrop\">\n\t\t<input\n\t\t\tv-show=\"false\"\n\t\t\tref=\"attachmentFileInput\"\n\t\t\tdata-text-el=\"attachment-file-input\"\n\t\t\ttype=\"file\"\n\t\t\taccept=\"*/*\"\n\t\t\tmultiple\n\t\t\t@change=\"onAttachmentUploadFilePicked\" />\n\t\t<slot />\n\t</div>\n</template>\n\n<script>\nimport { getCurrentUser } from '@nextcloud/auth'\nimport { showError } from '@nextcloud/dialogs'\nimport { emit } from '@nextcloud/event-bus'\nimport { generateUrl } from '@nextcloud/router'\nimport { useIsMobile } from '@nextcloud/vue/composables/useIsMobile'\nimport {\n\tcreateAttachment,\n\tinsertAttachmentFile,\n\tuploadAttachment,\n} from '../../apis/attach.ts'\nimport { logger } from '../../helpers/logger.js'\n\nimport { useEditor } from '../../composables/useEditor.ts'\nimport { useFileMixin } from '../Editor.provider.ts'\n\nimport { useConnection } from '../../composables/useConnection.ts'\nimport {\n\tACTION_ATTACHMENT_PROMPT,\n\tACTION_CHOOSE_LOCAL_ATTACHMENT,\n\tACTION_CREATE_ATTACHMENT,\n\tSTATE_UPLOADING,\n} from './MediaHandler.provider.js'\n\nconst getDir = (val) => val.split('/').slice(0, -1).join('/')\n\nexport default {\n\tname: 'MediaHandler',\n\tmixins: [useFileMixin],\n\tprovide() {\n\t\tconst val = {}\n\n\t\tObject.defineProperties(val, {\n\t\t\t[ACTION_ATTACHMENT_PROMPT]: {\n\t\t\t\tget: () => this.showAttachmentPrompt,\n\t\t\t},\n\t\t\t[ACTION_CHOOSE_LOCAL_ATTACHMENT]: {\n\t\t\t\tget: () => this.chooseLocalFile,\n\t\t\t},\n\t\t\t[ACTION_CREATE_ATTACHMENT]: {\n\t\t\t\tget: () => this.createAttachment,\n\t\t\t},\n\t\t\t[STATE_UPLOADING]: {\n\t\t\t\tget: () => this.state,\n\t\t\t},\n\t\t})\n\n\t\treturn val\n\t},\n\tsetup() {\n\t\tconst { connection } = useConnection()\n\t\tconst isMobile = useIsMobile()\n\t\tconst { editor } = useEditor()\n\t\treturn {\n\t\t\tconnection,\n\t\t\teditor,\n\t\t\tisMobile,\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tlastFilePath: null,\n\t\t\tdraggedOver: false,\n\t\t\t// make it reactive to be used inject/provide\n\t\t\tstate: {\n\t\t\t\tisUploadingAttachments: false,\n\t\t\t},\n\t\t}\n\t},\n\tcomputed: {\n\t\tinitialFilePath() {\n\t\t\treturn this.lastFilePath ?? getDir(this.$file?.relativePath ?? '/')\n\t\t},\n\t},\n\tmethods: {\n\t\tsetDraggedOver(val, event) {\n\t\t\tif (event.dataTransfer.types.includes('Files')) {\n\t\t\t\tthis.draggedOver = val\n\t\t\t}\n\t\t},\n\t\tonPaste(e) {\n\t\t\tthis.uploadAttachmentFiles(e.detail.files)\n\t\t},\n\t\tonEditorDrop(e) {\n\t\t\tthis.uploadAttachmentFiles(e.detail.files, e.detail.position)\n\t\t},\n\t\tonAttachmentUploadFilePicked(event) {\n\t\t\tthis.uploadAttachmentFiles(event.target.files)\n\t\t\t// Clear input to ensure that the change event will be emitted if\n\t\t\t// the same file is picked again.\n\t\t\tevent.target.value = ''\n\t\t},\n\t\tchooseLocalFile() {\n\t\t\tthis.$refs.attachmentFileInput.click()\n\t\t},\n\t\tasync uploadAttachmentFiles(files, position = null) {\n\t\t\tif (!files) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tthis.state.isUploadingAttachments = true\n\n\t\t\tconst uploadPromises = [...files].map((file) => {\n\t\t\t\treturn this.uploadAttachmentFile(file, position)\n\t\t\t})\n\n\t\t\treturn Promise.all(uploadPromises)\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Uploading multiple attachments failed', { error })\n\t\t\t\t\tshowError(t('text', 'Uploading multiple attachments failed.'))\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.state.isUploadingAttachments = false\n\t\t\t\t})\n\t\t},\n\t\tasync uploadAttachmentFile(file, position = null) {\n\t\t\tthis.state.isUploadingAttachments = true\n\n\t\t\treturn uploadAttachment(this.connection, file)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.insertAttachment(\n\t\t\t\t\t\tresponse.data?.name,\n\t\t\t\t\t\tresponse.data?.id,\n\t\t\t\t\t\tfile.type,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tresponse.data?.dirname,\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Uploading attachment failed', { error })\n\t\t\t\t\tif (error.response?.data.error) {\n\t\t\t\t\t\tshowError(\n\t\t\t\t\t\t\tt('text', 'Uploading attachment failed: {error}', {\n\t\t\t\t\t\t\t\terror: error.response.data.error,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tshowError(t('text', 'Uploading attachment failed.'))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.state.isUploadingAttachments = false\n\t\t\t\t})\n\t\t},\n\t\tshowAttachmentPrompt() {\n\t\t\tconst currentUser = getCurrentUser()\n\t\t\tif (!currentUser) {\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tOC.dialogs.filepicker(\n\t\t\t\tt('text', 'Insert an attachment'),\n\t\t\t\t(filePath) => {\n\t\t\t\t\tthis.insertFromPath(filePath)\n\t\t\t\t},\n\t\t\t\tfalse,\n\t\t\t\t[],\n\t\t\t\ttrue,\n\t\t\t\tundefined,\n\t\t\t\tthis.initialFilePath,\n\t\t\t)\n\t\t},\n\t\tinsertFromPath(filePath) {\n\t\t\tthis.lastFilePath = getDir(filePath)\n\n\t\t\tthis.state.isUploadingAttachments = true\n\n\t\t\treturn insertAttachmentFile(this.connection, filePath)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.insertAttachment(\n\t\t\t\t\t\tresponse.data?.name,\n\t\t\t\t\t\tresponse.data?.id,\n\t\t\t\t\t\tresponse.data?.mimetype,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tresponse.data?.dirname,\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Failed to insert from Files', { error })\n\t\t\t\t\tshowError(t('text', 'Failed to insert from Files'))\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.state.isUploadingAttachments = false\n\t\t\t\t})\n\t\t},\n\t\tcreateAttachment(template) {\n\t\t\tthis.state.isUploadingAttachments = true\n\t\t\treturn createAttachment(this.connection, template)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.insertAttachmentPreview(response.data?.id)\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlogger.error('Failed to create attachment', { error })\n\t\t\t\t\tshowError(t('text', 'Failed to create attachment'))\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.state.isUploadingAttachments = false\n\t\t\t\t})\n\t\t},\n\t\tinsertAttachmentPreview(fileId) {\n\t\t\tconst url = new URL(generateUrl(`/f/${fileId}`), window.origin)\n\t\t\tconst href = url.href.replaceAll(' ', '%20')\n\t\t\tthis.editor.chain().focus().insertPreview(href).run()\n\t\t},\n\t\tinsertAttachment(name, fileId, mimeType, position = null, dirname = '') {\n\t\t\t// inspired by the fixedEncodeURIComponent function suggested in\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent\n\t\t\tconst src =\n\t\t\t\tdirname\n\t\t\t\t+ '/'\n\t\t\t\t+ encodeURIComponent(name).replace(/[!'()*]/g, (c) => {\n\t\t\t\t\treturn '%' + c.charCodeAt(0).toString(16).toUpperCase()\n\t\t\t\t})\n\t\t\t// simply get rid of brackets to make sure link text is valid\n\t\t\t// as it does not need to be unique and matching the real file name\n\t\t\tconst alt = name.replaceAll(/[[\\]]/g, '')\n\n\t\t\tconst chain = position\n\t\t\t\t? this.editor.chain().focus(position)\n\t\t\t\t: this.editor.chain()\n\n\t\t\tchain.setImage({ src, alt }).run()\n\n\t\t\tconst selection = this.editor.view.state.selection\n\t\t\tif (!selection.empty) {\n\t\t\t\t// If inserted image is first element, it is selected and would get overwritten by\n\t\t\t\t// subsequent editor inserts (see tiptap#3355). So unselect the image by placing\n\t\t\t\t// the cursor at the end of the selection.\n\t\t\t\tthis.editor.commands.focus(selection.to)\n\t\t\t}\n\n\t\t\t// Scroll image into view\n\t\t\tthis.editor.commands.scrollIntoView()\n\n\t\t\t// Store last inserted attachment src to focus it in ImageView.vue\n\t\t\tthis.editor.commands.setMeta('insertedAttachmentSrc', { src })\n\n\t\t\temit('text:image-node:add', null)\n\t\t},\n\t},\n}\n</script>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"editor\">\n\t\t<MediaHandler v-if=\"$editorUpload\" class=\"text-editor__main\">\n\t\t\t<slot />\n\t\t</MediaHandler>\n\t\t<slot v-else />\n\t</div>\n</template>\n\n<script>\nimport { useEditorUpload } from '../Editor.provider.ts'\nimport MediaHandler from './MediaHandler.vue'\n\nexport default {\n\tname: 'MainContainer',\n\tcomponents: {\n\t\tMediaHandler,\n\t},\n\tmixins: [useEditorUpload],\n}\n</script>\n\n<style scoped lang=\"scss\">\n.text-editor__main,\n.editor {\n\tdisplay: flex;\n\tflex-direction: column;\n\tbackground: var(--color-main-background);\n\tcolor: var(--color-main-text);\n\tbackground-clip: padding-box;\n\tborder-radius: var(--border-radius);\n\tpadding: 0;\n\tposition: relative;\n\twidth: 100%;\n}\n\n.text-editor__main {\n\t&.is-mobile {\n\t\tflex-grow: 1;\n\t\tflex-direction: column-reverse;\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div\n\t\tclass=\"text-editor__wrapper\"\n\t\t:class=\"{\n\t\t\t'has-conflicts': isResolvingConflict,\n\t\t\t'is-rich-workspace': isRichWorkspace,\n\t\t\t'is-rich-editor': isRichEditor,\n\t\t}\">\n\t\t<slot />\n\t</div>\n</template>\n\n<script>\nimport { useEditorFlags } from '../../composables/useEditorFlags.ts'\nimport { READ_ONLY_ACTIONS } from './Wrapper.provider.js'\n\nexport default {\n\tname: 'Wrapper',\n\tprovide() {\n\t\tconst val = {}\n\n\t\tObject.defineProperties(val, {\n\t\t\t[READ_ONLY_ACTIONS]: {\n\t\t\t\tget: () => ({\n\t\t\t\t\ttoggle: this.readOnlyToggle,\n\t\t\t\t}),\n\t\t\t},\n\t\t})\n\n\t\treturn val\n\t},\n\n\tprops: {\n\t\tisResolvingConflict: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\thasConnectionIssue: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tcontentLoaded: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\n\tsetup() {\n\t\tconst { isRichEditor, isRichWorkspace } = useEditorFlags()\n\t\treturn { isRichEditor, isRichWorkspace }\n\t},\n\n\tmethods: {\n\t\treadOnlyToggle() {\n\t\t\tthis.$emit('read-only-toggled')\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.text-editor__wrapper {\n\tdisplay: flex;\n\tflex-grow: 1;\n\n\twidth: 100%;\n\n\t.ProseMirror {\n\t\tmargin-top: 0 !important;\n\t}\n}\n</style>\n"],"names":["isChangeOrigin","transaction","ySyncPluginKey","getYAbsolutePosition","state","relativePos","ystate","ySyncPluginKey2","relativePositionToAbsolutePosition","getYRelativePosition","absolutePos","absolutePositionToRelativePosition","CollaborationMappablePosition","_CollaborationMappablePosition","MappablePosition","position","yRelativePosition","json","createMappablePosition","getUpdatedPosition","absolutePosition2","result","coreGetUpdatedPosition","absolutePosition","Collaboration","Extension","extension","tr","dispatch","yUndoPluginKey","undo","redo","_a","fragment","yUndoPluginInstance","yUndoPlugin","originalUndoPluginView","view","undoManager","viewRet","hasUndoManSelf","observers","ySyncPluginOptions","ySyncPluginInstance","ySyncPlugin","jsonContent","yXmlFragmentToProsemirrorJSON","error","_a2","Plugin","PluginKey","valueSingleton","loadState","editorWidthKey","editorWidthDesktop","editorWidthDesktopEnhanced","fullEditorWidthDesktop","fullEditorWidthDesktopEnhanced","editorWidthMobile","fullEditorWidthMobile","maxWidthSetOutsideOfText","alreadySet","setByText","provideEditorWidth","useTableOfContents","isMobile","useIsMobile","provide","isFullWidth","ref","readonly","subscribe","value","defaultEditorWidthDesktop","defaultFullEditorWidthDesktop","defaultEditorWidth","computed","fullEditorWidth","width","applyEditorWidth","watch","useEditorWidth","isRichWorkspace","useEditorFlags","inject","checked","axios","generateUrl","emit","getNodeRangeDecorations","ranges","DecorationSet","decorations","doc","range","pos","node","Decoration","getSelectionRanges","$from","$to","depth","nodeRange","NodeRange","offset","from","to","selectionRange","SelectionRange","NodeRangeBookmark","_NodeRangeBookmark","anchor","head","mapping","$anchor","$head","NodeRangeSelection","_NodeRangeSelection","Selection","bias","isCursor","isCursorAtEnd","$correctedHead","$correctedAnchor","$rangeFrom","$rangeTo","other","$from2","firstRange","$to2","lastRange","isNodeRangeSelection","editor","selection","nodeRangeSelection2","nodeRangeSelection","hideTextSelection","activeMouseSelection","event","key","isMac","isShift","isControl","isAlt","isMeta","isMod","isNodeRange","nodeRanges","getCSSText","element","style","i","cloneElement","clonedNode","sourceElements","targetElements","sourceElement","index","findClosestTopLevelBlock","current","clampToContent","x","y","inset","container","firstBlock","lastBlock","topRect","botRect","clampedY","epsilon","sameLeft","sameRight","rowRect","findElementNextToCoords","options","clampedX","elements","block","el","candidate","resolvedPos","parent","getComputedStyle2","property","minMax","min","max","getInnerCoords","paddingLeft","paddingRight","borderLeft","borderRight","bounds","removeNode","getDragHandleRanges","coords","posAtCoords","dragHandler","empty","dragHandleRanges","selectionRanges","isDragHandleWithinSelection","dragHandleRange","wrapper","slice","clonedElement","getOuterNodePos","getOuterNode","currentNode","getRelativePos","getAbsolutePos","getOuterDomNode","domNode","tmpDomNode","dragHandlePluginDefaultKey","DragHandlePlugin","pluginKey","computePositionConfig","getReferencedVirtualElement","onNodeChange","onElementDragStart","onElementDragEnd","locked","currentNodePos","currentNodeRelPos","rafId","pendingMouseCoords","hideHandle","showHandle","repositionDragHandle","dom","virtualElement","computePosition","val","onDragStart","e","onDragEnd","_oldState","isLocked","hideDragHandle","newPos","_","oldState","domNodePos","outerNode","outerNodePos","_view","nodeData","defaultComputePositionConfig","Vue","VueDefault","DragHandle","h","_sfc_main","DragVerticalIcon","NcButton","PlusIcon","useEditor","schema","n","t","EditorContent","FloatingButtons","TocContainer","isRichEditor","uploadAttachment","connection","file","documentId","sessionId","sessionToken","token","unref","formData","url","createAttachment","template","insertAttachmentFile","filePath","getDir","useFileMixin","ACTION_ATTACHMENT_PROMPT","ACTION_CHOOSE_LOCAL_ATTACHMENT","ACTION_CREATE_ATTACHMENT","STATE_UPLOADING","useConnection","files","uploadPromises","logger","showError","response","getCurrentUser","fileId","href","name","mimeType","dirname","src","alt","MediaHandler","useEditorUpload","READ_ONLY_ACTIONS"],"mappings":"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","x_google_ignoreList":[0,2,3,4,5]}