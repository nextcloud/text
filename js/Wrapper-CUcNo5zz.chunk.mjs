import{b as g,d as f,u as v,j as _,O as w,k as A,l as O}from"./NcColorPicker-WFSXJRfa.chunk.mjs";import{f as h,g as x,u as F,A as b,h as C,S as P,i as $,j as y,k as U}from"./MediaHandler.provider-BJ1SsG4D.chunk.mjs";import{n as o}from"./_plugin-vue2_normalizer-wd1ZAbRr.chunk.mjs";import{g as k,e as D,s as S,u as T}from"./modulepreload-polyfill-nb9XBeg7.chunk.mjs";import{s as n}from"./NcNoteCard-ChweF_5Q-DZCruKzr.chunk.mjs";import{l as r}from"./logger-Bu78VaEB.chunk.mjs";import{m as E}from"./index-DqP6CuPc.chunk.mjs";const I={name:"ContentContainer",components:{EditorContent:g,EditorOutline:f},mixins:[h,v],computed:{showOutline(){return this.$outlineState.visible}}};var j=function(){var e=this,i=e._self._c;return i("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?i("div",{staticClass:"text-editor__content-wrapper__left"},[i("EditorOutline")],1):e._e(),e._t("default"),i("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.$editor}}),i("div",{staticClass:"text-editor__content-wrapper__right"})],2)},M=[],R=o(I,j,M,!1,null,"a3b97a85");const nt=R.exports,c=e=>e.split("/").slice(0,-1).join("/"),W={name:"MediaHandler",mixins:[h,x,F],provide(){const e={};return Object.defineProperties(e,{[b]:{get:()=>this.showAttachmentPrompt},[C]:{get:()=>this.chooseLocalFile},[P]:{get:()=>this.state}}),e},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??c(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e){this.draggedOver=e},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,i=null){if(!e)return;this.state.isUploadingAttachments=!0;const a=[...e].map(s=>this.uploadAttachmentFile(s,i));return Promise.all(a).catch(s=>{r.error("Uploading multiple attachments failed",{error:s}),n(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,i=null){return this.state.isUploadingAttachments=!0,this.$syncService.uploadAttachment(e).then(a=>{this.insertAttachment(a.data?.name,a.data?.id,e.type,i,a.data?.dirname)}).catch(a=>{r.error("Uploading attachment failed",{error:a}),a.response?.data.error?n(t("text","Uploading attachment failed: {error}",{error:a.response.data.error})):n(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){k()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=c(e),this.state.isUploadingAttachments=!0,this.$syncService.insertAttachmentFile(e).then(i=>{this.insertAttachment(i.data?.name,i.data?.id,i.data?.mimetype,null,i.data?.dirname)}).catch(i=>{r.error("Failed to insert from Files",{error:i}),n(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachment(e,i,a,s=null,u=""){const l=u+"/"+encodeURIComponent(e).replace(/[!'()*]/g,m=>"%"+m.charCodeAt(0).toString(16).toUpperCase()),p=e.replaceAll(/[[\]]/g,"");(s?this.$editor.chain().focus(s):this.$editor.chain()).setImage({src:l,alt:p}).run();const d=this.$editor.view.state.selection;d.empty||this.$editor.commands.focus(d.to),this.$editor.commands.scrollIntoView(),this.$editor.commands.setMeta("insertedAttachmentSrc",{src:l}),D("text:image-node:add",null)}}};var B=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(a){return a.preventDefault(),a.stopPropagation(),e.setDraggedOver(!0)},dragleave:function(a){return a.preventDefault(),a.stopPropagation(),e.setDraggedOver(!1)},drop:function(a){return a.preventDefault(),a.stopPropagation(),e.setDraggedOver(!1)},"file-drop":e.onEditorDrop}},[i("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},H=[],L=o(W,B,H,!1,null,null);const N=L.exports,V={name:"MainContainer",components:{MediaHandler:N},mixins:[$]};var q=function(){var e=this,i=e._self._c;return i("div",{staticClass:"editor"},[e.$editorUpload?i("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},z=[],G=o(V,q,z,!1,null,"1a11bcc3");const ot=G.exports,J={name:"Wrapper",mixins:[_,y,U],provide(){const e={};return Object.defineProperties(e,{[w]:{get:()=>this.outline},[A]:{get:()=>({toggle:this.outlineToggle})},[O]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{...E({viewWidth:e=>e.text.viewWidth}),showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return!this.$isRichWorkspace}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){S("text:keyboard:outline",this.outlineToggle),this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})})},beforeDestroy(){T("text:keyboard:outline",this.outlineToggle)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},readOnlyToggle(){this.$emit("read-only-toggled")}}};var K=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.$isRichWorkspace,"is-rich-editor":e.$isRichEditor}},[e._t("default")],2)},Q=[],X=o(J,K,Q,!1,null,"5635fcea");const rt=X.exports;export{nt as C,ot as M,rt as W};
//# sourceMappingURL=Wrapper-CUcNo5zz.chunk.mjs.map
