{"version":3,"file":"MediaHandler.provider-CjlCfPBG.chunk.mjs","sources":["../src/helpers/links.js","../src/components/Editor.provider.ts","../src/components/Editor/MediaHandler.provider.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { loadState } from '@nextcloud/initial-state'\nimport { generateUrl } from '@nextcloud/router'\n\nconst domHref = function (node, relativePath) {\n\tconst ref = node.attrs.href\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tif (!window.OCA?.Viewer) {\n\t\treturn ref\n\t}\n\tif (ref.match(/^[a-zA-Z]*:/)) {\n\t\treturn ref\n\t}\n\tif (ref.startsWith('#')) {\n\t\treturn ref\n\t}\n\t// Don't rewrite links in collectives app context\n\tif (loadState('core', 'active-app', '') === 'collectives') {\n\t\treturn ref\n\t}\n\t// Don't rewrite links to the collectives app\n\tif (ref.includes('/apps/collectives/')) {\n\t\treturn ref\n\t}\n\n\t// Rewrite links with old format from file picker to `/f/<fileId>`\n\tconst match = ref.match(/^([^?]*)\\?fileId=(\\d+)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn new URL(generateUrl(`/f/${id}`), window.origin).href\n\t}\n\treturn ref\n}\n\nconst parseHref = function (dom) {\n\tconst ref = dom.getAttribute('href')\n\tif (!ref) {\n\t\treturn ref\n\t}\n\tconst match = ref.match(/\\?dir=([^&]*)&openfile=([^&]*)#relPath=([^&]*)/)\n\tif (match) {\n\t\tconst [, , id] = match\n\t\treturn new URL(generateUrl(`/f/${id}`), window.origin).href\n\t}\n\treturn ref\n}\n\nconst isLinkToSelfWithHash = function (href) {\n\tconst locationNoHash =\n\t\twindow.location.origin + window.location.pathname + window.location.search\n\treturn href?.startsWith('#') || href?.startsWith(locationNoHash + '#')\n}\n\n/**\n * Open links, to be used as custom click handler\n *\n * @param {string} href the link href\n */\nconst openLink = function (href) {\n\tconst linkUrl = new URL(href, window.location.href)\n\t// Consider rerouting links to Collectives if already inside Collectives app\n\tconst collectivesUrlBase = '/apps/collectives'\n\tif (\n\t\twindow.OCA.Collectives?.vueRouter\n\t\t&& linkUrl.pathname.toString().startsWith(generateUrl(collectivesUrlBase))\n\t) {\n\t\tconst collectivesUrl = linkUrl.href.substring(\n\t\t\tlinkUrl.href.indexOf(collectivesUrlBase) + collectivesUrlBase.length,\n\t\t)\n\t\twindow.OCA.Collectives.vueRouter.push(collectivesUrl)\n\t\treturn\n\t}\n\twindow.open(linkUrl, '_blank')\n}\n\nexport { domHref, isLinkToSelfWithHash, openLink, parseHref }\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { openLink } from '../helpers/links.js'\nimport { logger } from '../helpers/logger.js'\n\nexport const FILE = Symbol('editor:file')\nexport const ATTACHMENT_RESOLVER = Symbol('attachment:resolver')\nexport const IS_MOBILE = Symbol('editor:is-mobile')\nexport const EDITOR_UPLOAD = Symbol('editor:upload')\nexport const HOOK_MENTION_SEARCH = Symbol('hook:mention-search')\nexport const HOOK_MENTION_INSERT = Symbol('hook:mention-insert')\nexport const OPEN_LINK_HANDLER = Symbol('editor:open-link-handler')\n\nexport const useIsMobileMixin = {\n\tinject: {\n\t\t$isMobile: { from: IS_MOBILE, default: false },\n\t},\n}\n\nexport const useFileMixin = {\n\tinject: {\n\t\t$file: {\n\t\t\tfrom: FILE,\n\t\t\tdefault: () => ({\n\t\t\t\tfileId: 0,\n\t\t\t\trelativePath: null,\n\t\t\t\tdocument: null,\n\t\t\t}),\n\t\t},\n\t},\n}\n\nexport const useAttachmentResolver = {\n\tinject: {\n\t\t$attachmentResolver: {\n\t\t\tfrom: ATTACHMENT_RESOLVER,\n\t\t\tdefault: {\n\t\t\t\tresolve(src: string) {\n\t\t\t\t\tlogger.warn(\n\t\t\t\t\t\t'No attachment resolver provided. Some attachment sources cannot be resolved.',\n\t\t\t\t\t)\n\t\t\t\t\treturn [src]\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t},\n}\nexport const useEditorUpload = {\n\tinject: {\n\t\t$editorUpload: {\n\t\t\tfrom: EDITOR_UPLOAD,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useMentionHook = {\n\tinject: {\n\t\t$mentionHookInsert: {\n\t\t\tfrom: HOOK_MENTION_INSERT,\n\t\t\tdefault: true,\n\t\t},\n\t\t$mentionHookSearch: {\n\t\t\tfrom: HOOK_MENTION_SEARCH,\n\t\t\tdefault: true,\n\t\t},\n\t},\n}\nexport const useOpenLinkHandler = {\n\tinject: {\n\t\t$openLinkHandler: {\n\t\t\tfrom: OPEN_LINK_HANDLER,\n\t\t\tdefault: {\n\t\t\t\topenLink,\n\t\t\t},\n\t\t},\n\t},\n}\n","/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nexport const STATE_UPLOADING = Symbol('state:uploading-state')\nexport const ACTION_ATTACHMENT_PROMPT = Symbol('editor:action:attachment-prompt')\nexport const ACTION_CHOOSE_LOCAL_ATTACHMENT = Symbol(\n\t'editor:action:upload-attachment',\n)\nexport const ACTION_CREATE_ATTACHMENT = Symbol('editor:action:create-attachment')\n\nexport const useUploadingStateMixin = {\n\tinject: {\n\t\t$uploadingState: {\n\t\t\tfrom: STATE_UPLOADING,\n\t\t\tdefault: {\n\t\t\t\tisUploadingAttachments: false,\n\t\t\t},\n\t\t},\n\t},\n}\n\nexport const useActionAttachmentPromptMixin = {\n\tinject: {\n\t\t$callAttachmentPrompt: { from: ACTION_ATTACHMENT_PROMPT, default: () => {} },\n\t},\n}\n\nexport const useActionChooseLocalAttachmentMixin = {\n\tinject: {\n\t\t$callChooseLocalAttachment: {\n\t\t\tfrom: ACTION_CHOOSE_LOCAL_ATTACHMENT,\n\t\t\tdefault: () => {},\n\t\t},\n\t},\n}\n\nexport const useActionCreateAttachmentMixin = {\n\tinject: {\n\t\t$callCreateAttachment: {\n\t\t\tfrom: ACTION_CREATE_ATTACHMENT,\n\t\t\tdefault: () => (template) => {},\n\t\t},\n\t},\n}\n"],"names":["domHref","node","relativePath","ref","loadState","match","id","generateUrl","parseHref","dom","isLinkToSelfWithHash","href","locationNoHash","openLink","linkUrl","collectivesUrlBase","collectivesUrl","FILE","ATTACHMENT_RESOLVER","IS_MOBILE","EDITOR_UPLOAD","HOOK_MENTION_SEARCH","HOOK_MENTION_INSERT","OPEN_LINK_HANDLER","useIsMobileMixin","useFileMixin","useAttachmentResolver","src","logger","useEditorUpload","useOpenLinkHandler","STATE_UPLOADING","ACTION_ATTACHMENT_PROMPT","ACTION_CHOOSE_LOCAL_ATTACHMENT","ACTION_CREATE_ATTACHMENT","useUploadingStateMixin","useActionAttachmentPromptMixin","useActionChooseLocalAttachmentMixin","useActionCreateAttachmentMixin","template"],"mappings":"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"}