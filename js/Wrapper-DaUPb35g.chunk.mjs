import{c as T,t as wt}from"./NcLoadingIcon-SwZTpIP3.chunk.mjs";import{s as Ct,e as it,g as xt}from"./index-CdM8BgQf.chunk.mjs";import{l as Et}from"./index-D3wiQe9-.chunk.mjs";import{g as F}from"./index-DCzdQJ7L.chunk.mjs";import{H as j,I as bt,J as W,K as kt,L as Mt,M as J,O as V,Q as Pt,S as Dt,V as St,W as $t,X as A,Y as at,Z as lt,_ as B,u as q,$ as Ft,a0 as Q,a1 as At,a2 as Ot,a3 as Ht,a4 as Rt,a5 as _t,j as X,T as Nt,E as It,h as Tt,a6 as Vt}from"./TocContainer-DIUwMMIm.chunk.mjs";import{r as Bt,p as G,e as Ut,c as z,w as Wt,i as zt,V as Lt,j as Y}from"./vue.runtime.esm-DtYIo4vn.chunk.mjs";import{N as Kt,s as $}from"./NcNoteCard-CwNXZ4vV-Bnva1u_k.chunk.mjs";import{n as S}from"./NcCheckboxRadioSwitch-CX3HXCEk-DsKhS70h.chunk.mjs";import{u as jt,S as Jt,c as qt,d as Xt,b as Yt,e as Zt}from"./MediaHandler.provider-bE4nrOxZ.chunk.mjs";import{l as R}from"./logger-DS8A9d_w.chunk.mjs";function dt(e){return!!e.getMeta(A)}function Qt(e,n){const o=A.getState(e);return at(o.doc,o.type,n,o.binding.mapping)||0}function ct(e,n){const o=A.getState(e);return lt(n,o.type,o.binding.mapping)}var I=class ut extends $t{constructor(n,o){super(n),this.yRelativePosition=o}static fromJSON(n){return new ut(n.position,n.yRelativePosition)}toJSON(){return{position:this.position,yRelativePosition:this.yRelativePosition}}};function Gt(e,n){const o=ct(n,e);return new I(e,o)}function te(e,n,o){const s=e instanceof I?e.yRelativePosition:null;if(dt(n)&&s){const a=Qt(o,s);return{position:new I(a,s),mapResult:null}}const r=St(e,n),i=r.position.position;return{position:new I(i,s??ct(o,i)),mapResult:r.mapResult}}var an=j.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null,provider:null}},addStorage(){return{isDisabled:!1}},onCreate(){this.editor.extensionManager.extensions.find(e=>e.name==="undoRedo")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-undo-redo".')},onBeforeCreate(){this.editor.utils.getUpdatedPosition=(e,n)=>te(e,n,this.editor.state),this.editor.utils.createMappablePosition=e=>Gt(e,this.editor.state)},addCommands(){return{undo:()=>({tr:e,state:n,dispatch:o})=>(e.setMeta("preventDispatch",!0),W.getState(n).undoManager.undoStack.length===0?!1:o?Dt(n):!0),redo:()=>({tr:e,state:n,dispatch:o})=>(e.setMeta("preventDispatch",!0),W.getState(n).undoManager.redoStack.length===0?!1:o?Pt(n):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){var e;const n=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),o=bt(this.options.yUndoOptions),s=o.spec.view;o.spec.view=a=>{const{undoManager:l}=W.getState(a.state);l.restore&&(l.restore(),l.restore=()=>{});const c=s?s(a):void 0;return{destroy:()=>{const d=l.trackedOrigins.has(l),u=l._observers;l.restore=()=>{d&&l.trackedOrigins.add(l),l.doc.on("afterTransaction",l.afterTransactionHandler),l._observers=u},c?.destroy&&c.destroy()}}};const r={...this.options.ySyncOptions,onFirstRender:this.options.onFirstRender},i=kt(n,r);return this.editor.options.enableContentCheck&&((e=n.doc)==null||e.on("beforeTransaction",()=>{try{const a=Mt(n);if(a.content.length===0)return;this.editor.schema.nodeFromJSON(a).check()}catch(a){return this.editor.emit("contentError",{error:a,editor:this.editor,disableCollaboration:()=>{var l;(l=n.doc)==null||l.destroy(),this.storage.isDisabled=!0}}),!1}})),[i,o,this.editor.options.enableContentCheck&&new J({key:new V("filterInvalidContent"),filterTransaction:()=>{var a;return this.storage.isDisabled!==!1&&((a=n.doc)==null||a.destroy()),!0}})].filter(Boolean)}});let tt=Et("text","is_full_width_editor",!1);const K=Symbol("text:editor:width"),ee="min(80ch, 100%)",ne="min(80ch, (100% - 2 * 40px))",oe="100%",se="calc(100% - 2 * 40px)",re="min(80ch, 100%)",ie="100%";function ae(){const e=getComputedStyle(document.body).getPropertyValue("--text-editor-max-width"),n=document.documentElement.style.getPropertyValue("--text-editor-max-width");return!!e&&e!==n}const ln=(e=!0)=>{const n=B();if(ae())return G(K,null),{applyEditorWidth:()=>{}};const o=Bt(tt);G(K,Ut(o)),Ct("text:editor:full-width",({value:d})=>{tt=d,o.value=d});const s=e?ne:ee,r=e?se:oe,i=z(()=>n.value?re:s),a=z(()=>n.value?ie:r),l=z(()=>o.value?a.value:i.value),c=()=>{document.documentElement.style.setProperty("--text-editor-max-width",l.value)};return Wt(l,c),{applyEditorWidth:c}},dn=()=>{const e=B(),{isRichWorkspace:n}=q(),o=zt(K);return o===null||n||e.value?{canToggleWidth:!1}:{canToggleWidth:!0,isFullWidth:o,setFullWidth:s=>{T.post(F("/apps/text/settings"),{key:"is_full_width_editor",value:s?"1":"0"}),it("text:editor:full-width",{value:s})}}};function et(e){if(!e.length)return Q.empty;const n=[],o=e[0].$from.node(0);return e.forEach(s=>{const r=s.$from.pos,i=s.$from.nodeAfter;i&&n.push(At.node(r,r+i.nodeSize,{class:"ProseMirror-selectednoderange"}))}),Q.create(o,n)}function U(e,n,o){const s=[],r=e.node(0);typeof o=="number"&&o>=0||(e.sameParent(n)?o=Math.max(0,e.sharedDepth(n.pos)-1):o=e.sharedDepth(n.pos));const i=new Ot(e,n,o),a=i.depth===0?0:r.resolve(i.start).posAtIndex(0);return i.parent.forEach((l,c)=>{const d=a+c,u=d+l.nodeSize;if(d<i.start||d>=i.end)return;const p=new Ht(r.resolve(d),r.resolve(u));s.push(p)}),s}var le=class pt{constructor(n,o){this.anchor=n,this.head=o}map(n){return new pt(n.map(this.anchor),n.map(this.head))}resolve(n){const o=n.resolve(this.anchor),s=n.resolve(this.head);return new M(o,s)}},M=class k extends Ft{constructor(n,o,s,r=1){const{doc:i}=n,a=n===o,l=n.pos===i.content.size&&o.pos===i.content.size,c=a&&!l?i.resolve(o.pos+(r>0?1:-1)):o,d=a&&l?i.resolve(n.pos-(r>0?1:-1)):n,u=U(d.min(c),d.max(c),s),p=c.pos>=n.pos?u[0].$from:u[u.length-1].$to,g=c.pos>=n.pos?u[u.length-1].$to:u[0].$from;super(p,g,u),this.depth=s}get $to(){return this.ranges[this.ranges.length-1].$to}eq(n){return n instanceof k&&n.$from.pos===this.$from.pos&&n.$to.pos===this.$to.pos}map(n,o){const s=n.resolve(o.map(this.anchor)),r=n.resolve(o.map(this.head));return new k(s,r)}toJSON(){return{type:"nodeRange",anchor:this.anchor,head:this.head}}get isForwards(){return this.head>=this.anchor}get isBackwards(){return!this.isForwards}extendBackwards(){const{doc:n}=this.$from;if(this.isForwards&&this.ranges.length>1){const r=this.ranges.slice(0,-1),i=r[0].$from,a=r[r.length-1].$to;return new k(i,a,this.depth)}const o=this.ranges[0],s=n.resolve(Math.max(0,o.$from.pos-1));return new k(this.$anchor,s,this.depth)}extendForwards(){const{doc:n}=this.$from;if(this.isBackwards&&this.ranges.length>1){const r=this.ranges.slice(1),i=r[0].$from,a=r[r.length-1].$to;return new k(a,i,this.depth)}const o=this.ranges[this.ranges.length-1],s=n.resolve(Math.min(n.content.size,o.$to.pos+1));return new k(this.$anchor,s,this.depth)}static fromJSON(n,o){return new k(n.resolve(o.anchor),n.resolve(o.head))}static create(n,o,s,r,i=1){return new this(n.resolve(o),n.resolve(s),r,i)}getBookmark(){return new le(this.anchor,this.head)}};M.prototype.visible=!1;function _(e){return e instanceof M}j.create({name:"nodeRange",addOptions(){return{depth:void 0,key:"Mod"}},addKeyboardShortcuts(){return{"Shift-ArrowUp":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:r,selection:i,tr:a}=s,{anchor:l,head:c}=i;if(!_(i)){const u=M.create(r,l,c,n,-1);return a.setSelection(u),o.dispatch(a),!0}const d=i.extendBackwards();return a.setSelection(d),o.dispatch(a),!0},"Shift-ArrowDown":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:r,selection:i,tr:a}=s,{anchor:l,head:c}=i;if(!_(i)){const u=M.create(r,l,c,n);return a.setSelection(u),o.dispatch(a),!0}const d=i.extendForwards();return a.setSelection(d),o.dispatch(a),!0},"Mod-a":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:r,tr:i}=s,a=M.create(r,0,r.content.size,n);return i.setSelection(a),o.dispatch(i),!0}}},onSelectionUpdate(){const{selection:e}=this.editor.state;_(e)&&this.editor.view.dom.classList.add("ProseMirror-noderangeselection")},addProseMirrorPlugins(){let e=!1,n=!1;return[new J({key:new V("nodeRange"),props:{attributes:()=>e?{class:"ProseMirror-noderangeselection"}:{class:""},handleDOMEvents:{mousedown:(o,s)=>{const{key:r}=this.options,i=/Mac/.test(navigator.platform),a=!!s.shiftKey,l=!!s.ctrlKey,c=!!s.altKey,d=!!s.metaKey,u=i?d:l;return(r==null||r==="Shift"&&a||r==="Control"&&l||r==="Alt"&&c||r==="Meta"&&d||r==="Mod"&&u)&&(n=!0),n&&document.addEventListener("mouseup",()=>{n=!1;const{state:p}=o,{doc:g,selection:m,tr:v}=p,{$anchor:w,$head:E}=m;if(w.sameParent(E))return;const b=M.create(g,w.pos,E.pos,this.options.depth);v.setSelection(b),o.dispatch(v)},{once:!0}),!1}},decorations:o=>{const{selection:s}=o,r=_(s);if(e=!1,!n)return r?(e=!0,et(s.ranges)):null;const{$from:i,$to:a}=s;if(!r&&i.sameParent(a))return null;const l=U(i,a,this.options.depth);return l.length?(e=!0,et(l)):null}}})]}});function de(e){let n="";const o=getComputedStyle(e);for(let s=0;s<o.length;s+=1)n+=`${o[s]}:${o.getPropertyValue(o[s])};`;return n}function ce(e){const n=e.cloneNode(!0),o=[e,...Array.from(e.getElementsByTagName("*"))],s=[n,...Array.from(n.getElementsByTagName("*"))];return o.forEach((r,i)=>{s[i].style.cssText=de(r)}),n}function ue(e,n){let o=e;for(;o?.parentElement&&o.parentElement!==n.dom;)o=o.parentElement;return o?.parentElement===n.dom?o:void 0}function pe(e,n,o,s=5){const r=e.dom,i=r.firstElementChild,a=r.lastElementChild;if(!i||!a)return{x:n,y:o};const l=i.getBoundingClientRect(),c=a.getBoundingClientRect(),d=Math.min(Math.max(l.top+s,o),c.bottom-s),u=.5,p=Math.abs(l.left-c.left)<u,g=Math.abs(l.right-c.right)<u;let m=l;return p&&g&&(m=l),{x:Math.min(Math.max(m.left+s,n),m.right-s),y:d}}var ht=e=>{const{x:n,y:o,editor:s}=e,{view:r,state:i}=s,{x:a,y:l}=pe(r,n,o,5),c=r.root.elementsFromPoint(a,l);let d;if(Array.prototype.some.call(c,g=>{if(!r.dom.contains(g))return!1;const m=ue(g,r);return m?(d=m,!0):!1}),!d)return{resultElement:null,resultNode:null,pos:null};let u;try{u=r.posAtDOM(d,0)}catch{return{resultElement:null,resultNode:null,pos:null}}const p=i.doc.nodeAt(u);if(!p){const g=i.doc.resolve(u),m=g.parent;return{resultElement:d,resultNode:m,pos:g.start()}}return{resultElement:d,resultNode:p,pos:u}};function N(e,n){return window.getComputedStyle(e)[n]}function he(e=0,n=0,o=0){return Math.min(Math.max(e,n),o)}function me(e,n,o){const s=parseInt(N(e.dom,"paddingLeft"),10),r=parseInt(N(e.dom,"paddingRight"),10),i=parseInt(N(e.dom,"borderLeftWidth"),10),a=parseInt(N(e.dom,"borderLeftWidth"),10),l=e.dom.getBoundingClientRect();return{left:he(n,l.left+s+i,l.right-r-a),top:o}}function mt(e){var n;(n=e.parentNode)==null||n.removeChild(e)}function ge(e,n){const{doc:o}=n.view.state,s=ht({editor:n,x:e.clientX,y:e.clientY});if(!s.resultNode||s.pos===null)return[];const r=e.clientX,i=me(n.view,r,e.clientY),a=n.view.posAtCoords(i);if(!a)return[];const{pos:l}=a;if(!o.resolve(l).parent)return[];const c=o.resolve(s.pos),d=o.resolve(s.pos+1);return U(c,d,0)}function fe(e,n){const{view:o}=n;if(!e.dataTransfer)return;const{empty:s,$from:r,$to:i}=o.state.selection,a=ge(e,n),l=U(r,i,0),c=l.some(E=>a.find(b=>b.$from===E.$from&&b.$to===E.$to)),d=s||!c?a:l;if(!d.length)return;const{tr:u}=o.state,p=document.createElement("div"),g=d[0].$from.pos,m=d[d.length-1].$to.pos,v=M.create(o.state.doc,g,m),w=v.content();d.forEach(E=>{const b=o.nodeDOM(E.$from.pos),O=ce(b);p.append(O)}),p.style.position="absolute",p.style.top="-10000px",document.body.append(p),e.dataTransfer.clearData(),e.dataTransfer.setDragImage(p,0,0),o.dragging={slice:w,move:!0},u.setSelection(v),o.dispatch(u),document.addEventListener("drop",()=>mt(p),{once:!0})}var nt=(e,n)=>{const o=e.resolve(n),{depth:s}=o;return s===0?n:o.pos-o.parentOffset-1},ot=(e,n)=>{const o=e.nodeAt(n),s=e.resolve(n);let{depth:r}=s,i=o;for(;r>0;){const a=s.node(r);r-=1,r===0&&(i=a)}return i},L=(e,n)=>{const o=A.getState(e);return o?lt(n,o.type,o.binding.mapping):null},ve=(e,n)=>{const o=A.getState(e);return o?at(o.doc,o.type,n,o.binding.mapping)||0:-1},st=(e,n)=>{let o=n;for(;o?.parentNode&&o.parentNode!==e.dom;)o=o.parentNode;return o},gt=new V("dragHandle"),ft=({pluginKey:e=gt,element:n,editor:o,computePositionConfig:s,getReferencedVirtualElement:r,onNodeChange:i,onElementDragStart:a,onElementDragEnd:l})=>{const c=document.createElement("div");let d=!1,u=null,p=-1,g,m=null,v=null;function w(){n&&(n.style.visibility="hidden",n.style.pointerEvents="none")}function E(){if(n){if(!o.isEditable){w();return}n.style.visibility="",n.style.pointerEvents="auto"}}function b(h){const f=r?.()||{getBoundingClientRect:()=>h.getBoundingClientRect()};Rt(f,n,s).then(P=>{Object.assign(n.style,{position:P.strategy,left:`${P.x}px`,top:`${P.y}px`})})}function O(h){a?.(h),fe(h,o),n&&(n.dataset.dragging="true"),setTimeout(()=>{n&&(n.style.pointerEvents="none")},0)}function Z(h){l?.(h),w(),n&&(n.style.pointerEvents="auto",n.dataset.dragging="false")}return n.addEventListener("dragstart",O),n.addEventListener("dragend",Z),c.appendChild(n),{unbind(){n.removeEventListener("dragstart",O),n.removeEventListener("dragend",Z),m&&(cancelAnimationFrame(m),m=null,v=null)},plugin:new J({key:typeof e=="string"?new V(e):e,state:{init(){return{locked:!1}},apply(h,f,P,D){const y=h.getMeta("lockDragHandle"),C=h.getMeta("hideDragHandle");if(y!==void 0&&(d=y),C)return w(),d=!1,u=null,p=-1,i?.({editor:o,node:null,pos:-1}),f;if(h.docChanged&&p!==-1&&n)if(dt(h)){const x=ve(D,g);x!==p&&(p=x)}else{const x=h.mapping.map(p);x!==p&&(p=x,g=L(D,p))}return f}},view:h=>{var f;return n.draggable=!0,n.style.pointerEvents="auto",n.dataset.dragging="false",(f=o.view.dom.parentElement)==null||f.appendChild(c),c.style.pointerEvents="none",c.style.position="absolute",c.style.top="0",c.style.left="0",{update(P,D){if(!n)return;if(!o.isEditable){w();return}if(d?n.draggable=!1:n.draggable=!0,h.state.doc.eq(D.doc)||p===-1)return;let y=h.nodeDOM(p);if(y=st(h,y),y===h.dom||y?.nodeType!==1)return;const C=h.posAtDOM(y,0),x=ot(o.state.doc,C),H=nt(o.state.doc,C);u=x,p=H,g=L(h.state,p),i?.({editor:o,node:u,pos:p}),b(y)},destroy(){m&&(cancelAnimationFrame(m),m=null,v=null),n&&mt(c)}}},props:{handleDOMEvents:{keydown(h){return!n||d||h.hasFocus()&&(w(),u=null,p=-1,i?.({editor:o,node:null,pos:-1})),!1},mouseleave(h,f){return d||f.target&&!c.contains(f.relatedTarget)&&(w(),u=null,p=-1,i?.({editor:o,node:null,pos:-1})),!1},mousemove(h,f){return!n||d||(v={x:f.clientX,y:f.clientY},m)||(m=requestAnimationFrame(()=>{if(m=null,!v)return;const{x:P,y:D}=v;v=null;const y=ht({x:P,y:D,editor:o});if(!y.resultElement)return;let C=y.resultElement;if(C=st(h,C),C===h.dom||C?.nodeType!==1)return;const x=h.posAtDOM(C,0),H=ot(o.state.doc,x);if(H!==u){const yt=nt(o.state.doc,x);u=H,p=yt,g=L(h.state,p),i?.({editor:o,node:u,pos:p}),b(C),E()}})),!1}}}})}},vt={placement:"left-start",strategy:"absolute"};j.create({name:"dragHandle",addOptions(){return{render(){const e=document.createElement("div");return e.classList.add("drag-handle"),e},computePositionConfig:{},locked:!1,onNodeChange:()=>null,onElementDragStart:void 0,onElementDragEnd:void 0}},addCommands(){return{lockDragHandle:()=>({editor:e})=>(this.options.locked=!0,e.commands.setMeta("lockDragHandle",this.options.locked)),unlockDragHandle:()=>({editor:e})=>(this.options.locked=!1,e.commands.setMeta("lockDragHandle",this.options.locked)),toggleDragHandle:()=>({editor:e})=>(this.options.locked=!this.options.locked,e.commands.setMeta("lockDragHandle",this.options.locked))}},addProseMirrorPlugins(){const e=this.options.render();return[ft({computePositionConfig:{...vt,...this.options.computePositionConfig},getReferencedVirtualElement:this.options.getReferencedVirtualElement,element:e,editor:this.editor,onNodeChange:this.options.onNodeChange,onElementDragStart:this.options.onElementDragStart,onElementDragEnd:this.options.onElementDragEnd}).plugin]}});var ye=Lt,we=ye.extend({name:"DragHandleVue",props:{pluginKey:{type:[String,Object],default:()=>gt},editor:{type:Object,required:!0},computePositionConfig:{type:Object,default:()=>({})},onNodeChange:{type:Function,default:null},onElementDragStart:{type:Function,default:null},onElementDragEnd:{type:Function,default:null},class:{type:String,default:"drag-handle"}},mounted(){const{editor:e,pluginKey:n,onNodeChange:o,onElementDragStart:s,onElementDragEnd:r}=this.$props;e.registerPlugin(ft({editor:e,element:this.$el,pluginKey:n,computePositionConfig:{...vt,...this.computePositionConfig},onNodeChange:o,onElementDragStart:s,onElementDragEnd:r}).plugin)},beforeDestroy(){const{pluginKey:e,editor:n}=this.$props;n.unregisterPlugin(e)},render(e){return e("div",{class:this.class,attrs:{"data-dragging":"false"}},this.$slots.default)}});const Ce={name:"DragVerticalIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var xe=function(){var e=this,n=e._self._c;return n("span",e._b({staticClass:"material-design-icon drag-vertical-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(o){return e.$emit("click",o)}}},"span",e.$attrs,!1),[n("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M9,3H11V5H9V3M13,3H15V5H13V3M9,7H11V9H9V7M13,7H15V9H13V7M9,11H11V13H9V11M13,11H15V13H13V11M9,15H11V17H9V15M13,15H15V17H13V15M9,19H11V21H9V19M13,19H15V21H13V19Z"}},[e.title?n("title",[e._v(e._s(e.title))]):e._e()])])])},Ee=[],be=S(Ce,xe,Ee,!1,null,null);const ke=be.exports,Me={name:"FloatingButtons",components:{DragHandle:we,DragVerticalIcon:ke,NcButton:Kt,PlusIcon:_t},setup(){const{editor:e}=X();return{editor:e}},data(){return{node:null,pos:-1}},computed:{isHeadingNode(){return this.node?.type===this.editor.schema.nodes.heading}},methods:{onNodeChange({node:e,pos:n}){this.node=e,this.pos=n},onOpenSmartPicker(){if(!this.node||this.pos===-1)return;const{schema:e}=this.editor,n=this.node.textContent.trim()===""&&(this.node.children.length===0||this.node.children.every(o=>o.type===e.nodes.text))?this.pos+1:this.pos+this.node.nodeSize;this.editor.chain().insertContentAt(n,"/").focus().run()},t:wt}};var Pe=function(){var e=this,n=e._self._c;return n("DragHandle",{staticClass:"floating-buttons",class:{heading:e.isHeadingNode},attrs:{editor:e.editor,"on-node-change":e.onNodeChange}},[n("NcButton",{attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Insert below"),"aria-label":e.t("text","Insert below")},on:{click:e.onOpenSmartPicker},scopedSlots:e._u([{key:"icon",fn:function(){return[n("PlusIcon",{attrs:{size:16}})]},proxy:!0}])}),n("NcButton",{staticClass:"drag-button",attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Click for options, hold to drag"),"aria-label":e.t("text","Click for options, hold to drag")},scopedSlots:e._u([{key:"icon",fn:function(){return[n("DragVerticalIcon",{attrs:{size:16}})]},proxy:!0}])})],1)},De=[],Se=S(Me,Pe,De,!1,null,"3e6ea9fb");const $e=Se.exports,Fe={name:"ContentContainer",components:{EditorContent:It,FloatingButtons:$e,TocContainer:Nt},props:{readOnly:{type:Boolean,required:!0}},setup(){const e=B(),{editor:n}=X(),{isRichEditor:o,isRichWorkspace:s,useTableOfContents:r}=q();return{editor:n,isMobile:e,isRichEditor:o,isRichWorkspace:s,useTableOfContents:r}},computed:{showFloatingButtons(){return!this.readOnly&&!this.isMobile&&this.isRichEditor&&!this.isRichWorkspace}}};var Ae=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor__content-wrapper",attrs:{"data-text-el":"editor-content-wrapper"}},[e._t("default"),e.showFloatingButtons?n("FloatingButtons"):e._e(),n("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.editor}}),e.useTableOfContents?n("TocContainer"):e._e()],2)},Oe=[],He=S(Fe,Ae,Oe,!1,null,"9ddccc0f");const cn=He.exports;function Re(e,n){const{documentId:o,sessionId:s,sessionToken:r,shareToken:i}=Y(e),a=new FormData;a.append("file",n);const l=F("apps/text/attachment/upload?");return T.post(l,a,{headers:{"Content-Type":"multipart/form-data"},params:{documentId:o,sessionId:s,sessionToken:r,token:i}})}function _e(e,n){const{documentId:o,sessionId:s,sessionToken:r}=Y(e),i=F("apps/text/attachment/create");return T.post(i,{documentId:o,sessionId:s,sessionToken:r,fileName:`${n.app}${n.extension}`})}function Ne(e,n){const{documentId:o,sessionId:s,sessionToken:r}=Y(e),i=F("apps/text/attachment/filepath");return T.post(i,{documentId:o,sessionId:s,sessionToken:r,filePath:n})}const rt=e=>e.split("/").slice(0,-1).join("/"),Ie={name:"MediaHandler",mixins:[jt],provide(){const e={};return Object.defineProperties(e,{[Yt]:{get:()=>this.showAttachmentPrompt},[Xt]:{get:()=>this.chooseLocalFile},[qt]:{get:()=>this.createAttachment},[Jt]:{get:()=>this.state}}),e},setup(){const{connection:e}=Tt(),n=B(),{editor:o}=X();return{connection:e,editor:o,isMobile:n}},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??rt(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e,n){n.dataTransfer.types.includes("Files")&&(this.draggedOver=e)},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,n=null){if(!e)return;this.state.isUploadingAttachments=!0;const o=[...e].map(s=>this.uploadAttachmentFile(s,n));return Promise.all(o).catch(s=>{R.error("Uploading multiple attachments failed",{error:s}),$(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,n=null){return this.state.isUploadingAttachments=!0,Re(this.connection,e).then(o=>{this.insertAttachment(o.data?.name,o.data?.id,e.type,n,o.data?.dirname)}).catch(o=>{R.error("Uploading attachment failed",{error:o}),o.response?.data.error?$(t("text","Uploading attachment failed: {error}",{error:o.response.data.error})):$(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){xt()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=rt(e),this.state.isUploadingAttachments=!0,Ne(this.connection,e).then(n=>{this.insertAttachment(n.data?.name,n.data?.id,n.data?.mimetype,null,n.data?.dirname)}).catch(n=>{R.error("Failed to insert from Files",{error:n}),$(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},createAttachment(e){return this.state.isUploadingAttachments=!0,_e(this.connection,e).then(n=>{this.insertAttachmentPreview(n.data?.id)}).catch(n=>{R.error("Failed to create attachment",{error:n}),$(t("text","Failed to create attachment"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachmentPreview(e){const n=new URL(F(`/f/${e}`),window.origin).href.replaceAll(" ","%20");this.editor.chain().focus().insertPreview(n).run()},insertAttachment(e,n,o,s=null,r=""){const i=r+"/"+encodeURIComponent(e).replace(/[!'()*]/g,c=>"%"+c.charCodeAt(0).toString(16).toUpperCase()),a=e.replaceAll(/[[\]]/g,"");(s?this.editor.chain().focus(s):this.editor.chain()).setImage({src:i,alt:a}).run();const l=this.editor.view.state.selection;l.empty||this.editor.commands.focus(l.to),this.editor.commands.scrollIntoView(),this.editor.commands.setMeta("insertedAttachmentSrc",{src:i}),it("text:image-node:add",null)}}};var Te=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver,"is-mobile":e.isMobile},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!0,o)},dragleave:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!1,o)},drop:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!1,o)},"file-drop":e.onEditorDrop}},[n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},Ve=[],Be=S(Ie,Te,Ve,!1,null,null);const Ue=Be.exports,We={name:"MainContainer",components:{MediaHandler:Ue},mixins:[Zt]};var ze=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor"},[e.$editorUpload?n("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},Le=[],Ke=S(We,ze,Le,!1,null,"e0c9a19c");const un=Ke.exports,je={name:"Wrapper",provide(){const e={};return Object.defineProperties(e,{[Vt]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0}},setup(){const{isRichEditor:e,isRichWorkspace:n}=q();return{isRichEditor:e,isRichWorkspace:n}},methods:{readOnlyToggle(){this.$emit("read-only-toggled")}}};var Je=function(){var e=this,n=e._self._c;return n("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.isRichWorkspace,"is-rich-editor":e.isRichEditor}},[e._t("default")],2)},qe=[],Xe=S(je,Je,qe,!1,null,"bc674721");const pn=Xe.exports;export{cn as C,un as M,pn as W,an as a,K as e,ln as p,dn as u};
//# sourceMappingURL=Wrapper-DaUPb35g.chunk.mjs.map
