import{c as B,t as kt}from"./NcLoadingIcon-CR2lMUNM.chunk.mjs";import{s as Mt,e as ut,g as Ft}from"./index-CdM8BgQf.chunk.mjs";import{l as Dt}from"./index-D3wiQe9-.chunk.mjs";import{g as R}from"./index-DCzdQJ7L.chunk.mjs";import{H as X,I as Pt,J as W,K as $t,L as St,M as Y,O as U,Q as Ot,S as At,V as Nt,W as Rt,X as _,Y as pt,Z as ht,_ as z,u as Z,$ as _t,a0 as et,a1 as Ht,a2 as It,a3 as Tt,a4 as Vt,a5 as Bt,a6 as Ut,a7 as zt,j as Q,T as Lt,E as Wt,h as Kt,a8 as jt}from"./TocContainer-CknkaVgg.chunk.mjs";import{r as qt,p as nt,f as Jt,c as K,w as Xt,i as Yt,V as Zt,j as G}from"./vue.runtime.esm-nXYIs6vL.chunk.mjs";import{N as Qt,s as N}from"./NcNoteCard-CwNXZ4vV-Dff94GWm.chunk.mjs";import{n as O}from"./NcCheckboxRadioSwitch-CgbTELjq-C7Y7tXRC.chunk.mjs";import{u as Gt,S as te,c as ee,d as ne,b as oe,e as se}from"./MediaHandler.provider-bE4nrOxZ.chunk.mjs";import{l as I}from"./logger-DS8A9d_w.chunk.mjs";function mt(e){return!!e.getMeta(_)}function re(e,n){const o=_.getState(e);return pt(o.doc,o.type,n,o.binding.mapping)||0}function gt(e,n){const o=_.getState(e);return ht(n,o.type,o.binding.mapping)}var V=class ft extends Rt{constructor(n,o){super(n),this.yRelativePosition=o}static fromJSON(n){return new ft(n.position,n.yRelativePosition)}toJSON(){return{position:this.position,yRelativePosition:this.yRelativePosition}}};function ie(e,n){const o=gt(n,e);return new V(e,o)}function ae(e,n,o){const s=e instanceof V?e.yRelativePosition:null;if(mt(n)&&s){const a=re(o,s);return{position:new V(a,s),mapResult:null}}const r=Nt(e,n),i=r.position.position;return{position:new V(i,s??gt(o,i)),mapResult:r.mapResult}}var En=X.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null,provider:null}},addStorage(){return{isDisabled:!1}},onCreate(){this.editor.extensionManager.extensions.find(e=>e.name==="undoRedo")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-undo-redo".')},onBeforeCreate(){this.editor.utils.getUpdatedPosition=(e,n)=>ae(e,n,this.editor.state),this.editor.utils.createMappablePosition=e=>ie(e,this.editor.state)},addCommands(){return{undo:()=>({tr:e,state:n,dispatch:o})=>(e.setMeta("preventDispatch",!0),W.getState(n).undoManager.undoStack.length===0?!1:o?At(n):!0),redo:()=>({tr:e,state:n,dispatch:o})=>(e.setMeta("preventDispatch",!0),W.getState(n).undoManager.redoStack.length===0?!1:o?Ot(n):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){var e;const n=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),o=Pt(this.options.yUndoOptions),s=o.spec.view;o.spec.view=a=>{const{undoManager:l}=W.getState(a.state);l.restore&&(l.restore(),l.restore=()=>{});const c=s?s(a):void 0;return{destroy:()=>{const d=l.trackedOrigins.has(l),u=l._observers;l.restore=()=>{d&&l.trackedOrigins.add(l),l.doc.on("afterTransaction",l.afterTransactionHandler),l._observers=u},c?.destroy&&c.destroy()}}};const r={...this.options.ySyncOptions,onFirstRender:this.options.onFirstRender},i=$t(n,r);return this.editor.options.enableContentCheck&&((e=n.doc)==null||e.on("beforeTransaction",()=>{try{const a=St(n);if(a.content.length===0)return;this.editor.schema.nodeFromJSON(a).check()}catch(a){return this.editor.emit("contentError",{error:a,editor:this.editor,disableCollaboration:()=>{var l;(l=n.doc)==null||l.destroy(),this.storage.isDisabled=!0}}),!1}})),[i,o,this.editor.options.enableContentCheck&&new Y({key:new U("filterInvalidContent"),filterTransaction:()=>{var a;return this.storage.isDisabled!==!1&&((a=n.doc)==null||a.destroy()),!0}})].filter(Boolean)}});let ot=Dt("text","is_full_width_editor",!1);const J=Symbol("text:editor:width"),le="min(80ch, 100%)",de="min(80ch, (100% - 2 * 40px))",ce="100%",ue="calc(100% - 2 * 40px)",pe="min(80ch, 100%)",he="100%";function me(){const e=getComputedStyle(document.body).getPropertyValue("--text-editor-max-width"),n=document.documentElement.style.getPropertyValue("--text-editor-max-width");return!!e&&e!==n}const xn=(e=!0)=>{const n=z();if(me())return nt(J,null),{applyEditorWidth:()=>{}};const o=qt(ot);nt(J,Jt(o)),Mt("text:editor:full-width",({value:d})=>{ot=d,o.value=d});const s=e?de:le,r=e?ue:ce,i=K(()=>n.value?pe:s),a=K(()=>n.value?he:r),l=K(()=>o.value?a.value:i.value),c=()=>{document.documentElement.style.setProperty("--text-editor-max-width",l.value)};return Xt(l,c),{applyEditorWidth:c}},kn=()=>{const e=z(),{isRichWorkspace:n}=Z(),o=Yt(J);return o===null||n||e.value?{canToggleWidth:!1}:{canToggleWidth:!0,isFullWidth:o,setFullWidth:s=>{B.post(R("/apps/text/settings"),{key:"is_full_width_editor",value:s?"1":"0"}),ut("text:editor:full-width",{value:s})}}};function st(e){if(!e.length)return et.empty;const n=[],o=e[0].$from.node(0);return e.forEach(s=>{const r=s.$from.pos,i=s.$from.nodeAfter;i&&n.push(Ht.node(r,r+i.nodeSize,{class:"ProseMirror-selectednoderange"}))}),et.create(o,n)}function L(e,n,o){const s=[],r=e.node(0);typeof o=="number"&&o>=0||(e.sameParent(n)?o=Math.max(0,e.sharedDepth(n.pos)-1):o=e.sharedDepth(n.pos));const i=new It(e,n,o),a=i.depth===0?0:r.resolve(i.start).posAtIndex(0);return i.parent.forEach((l,c)=>{const d=a+c,u=d+l.nodeSize;if(d<i.start||d>=i.end)return;const h=new Tt(r.resolve(d),r.resolve(u));s.push(h)}),s}var ge=class vt{constructor(n,o){this.anchor=n,this.head=o}map(n){return new vt(n.map(this.anchor),n.map(this.head))}resolve(n){const o=n.resolve(this.anchor),s=n.resolve(this.head);return new D(o,s)}},D=class F extends _t{constructor(n,o,s,r=1){const{doc:i}=n,a=n===o,l=n.pos===i.content.size&&o.pos===i.content.size,c=a&&!l?i.resolve(o.pos+(r>0?1:-1)):o,d=a&&l?i.resolve(n.pos-(r>0?1:-1)):n,u=L(d.min(c),d.max(c),s),h=c.pos>=n.pos?u[0].$from:u[u.length-1].$to,p=c.pos>=n.pos?u[u.length-1].$to:u[0].$from;super(h,p,u),this.depth=s}get $to(){return this.ranges[this.ranges.length-1].$to}eq(n){return n instanceof F&&n.$from.pos===this.$from.pos&&n.$to.pos===this.$to.pos}map(n,o){const s=n.resolve(o.map(this.anchor)),r=n.resolve(o.map(this.head));return new F(s,r)}toJSON(){return{type:"nodeRange",anchor:this.anchor,head:this.head}}get isForwards(){return this.head>=this.anchor}get isBackwards(){return!this.isForwards}extendBackwards(){const{doc:n}=this.$from;if(this.isForwards&&this.ranges.length>1){const r=this.ranges.slice(0,-1),i=r[0].$from,a=r[r.length-1].$to;return new F(i,a,this.depth)}const o=this.ranges[0],s=n.resolve(Math.max(0,o.$from.pos-1));return new F(this.$anchor,s,this.depth)}extendForwards(){const{doc:n}=this.$from;if(this.isBackwards&&this.ranges.length>1){const r=this.ranges.slice(1),i=r[0].$from,a=r[r.length-1].$to;return new F(a,i,this.depth)}const o=this.ranges[this.ranges.length-1],s=n.resolve(Math.min(n.content.size,o.$to.pos+1));return new F(this.$anchor,s,this.depth)}static fromJSON(n,o){return new F(n.resolve(o.anchor),n.resolve(o.head))}static create(n,o,s,r,i=1){return new this(n.resolve(o),n.resolve(s),r,i)}getBookmark(){return new ge(this.anchor,this.head)}};D.prototype.visible=!1;function T(e){return e instanceof D}X.create({name:"nodeRange",addOptions(){return{depth:void 0,key:"Mod"}},addKeyboardShortcuts(){return{"Shift-ArrowUp":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:r,selection:i,tr:a}=s,{anchor:l,head:c}=i;if(!T(i)){const u=D.create(r,l,c,n,-1);return a.setSelection(u),o.dispatch(a),!0}const d=i.extendBackwards();return a.setSelection(d),o.dispatch(a),!0},"Shift-ArrowDown":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:r,selection:i,tr:a}=s,{anchor:l,head:c}=i;if(!T(i)){const u=D.create(r,l,c,n);return a.setSelection(u),o.dispatch(a),!0}const d=i.extendForwards();return a.setSelection(d),o.dispatch(a),!0},"Mod-a":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:r,tr:i}=s,a=D.create(r,0,r.content.size,n);return i.setSelection(a),o.dispatch(i),!0}}},onSelectionUpdate(){const{selection:e}=this.editor.state;T(e)&&this.editor.view.dom.classList.add("ProseMirror-noderangeselection")},addProseMirrorPlugins(){let e=!1,n=!1;return[new Y({key:new U("nodeRange"),props:{attributes:()=>e?{class:"ProseMirror-noderangeselection"}:{class:""},handleDOMEvents:{mousedown:(o,s)=>{const{key:r}=this.options,i=/Mac/.test(navigator.platform),a=!!s.shiftKey,l=!!s.ctrlKey,c=!!s.altKey,d=!!s.metaKey,u=i?d:l;return(r==null||r==="Shift"&&a||r==="Control"&&l||r==="Alt"&&c||r==="Meta"&&d||r==="Mod"&&u)&&(n=!0),n&&document.addEventListener("mouseup",()=>{n=!1;const{state:h}=o,{doc:p,selection:f,tr:m}=h,{$anchor:v,$head:y}=f;if(v.sameParent(y))return;const x=D.create(p,v.pos,y.pos,this.options.depth);m.setSelection(x),o.dispatch(m)},{once:!0}),!1}},decorations:o=>{const{selection:s}=o,r=T(s);if(e=!1,!n)return r?(e=!0,st(s.ranges)):null;const{$from:i,$to:a}=s;if(!r&&i.sameParent(a))return null;const l=L(i,a,this.options.depth);return l.length?(e=!0,st(l)):null}}})]}});function fe(e){let n="";const o=getComputedStyle(e);for(let s=0;s<o.length;s+=1)n+=`${o[s]}:${o.getPropertyValue(o[s])};`;return n}function ve(e){const n=e.cloneNode(!0),o=[e,...Array.from(e.getElementsByTagName("*"))],s=[n,...Array.from(n.getElementsByTagName("*"))];return o.forEach((r,i)=>{s[i].style.cssText=fe(r)}),n}var ye={id:"listItemFirstChild",evaluate:({parent:e,isFirst:n})=>n&&e&&["listItem","taskItem"].includes(e.type.name)?1e3:0},we={id:"listWrapperDeprioritize",evaluate:({node:e})=>{const n=["listItem","taskItem"],o=e.firstChild;return o&&n.includes(o.type.name)?1e3:0}},be={id:"inlineContent",evaluate:({node:e})=>e.isInline||e.isText?1e3:0},Ce=[ye,we,be],rt={edges:["left","top"],threshold:12,strength:500};function j(e){return e===void 0||e==="left"?{...rt}:e==="right"?{edges:["right","top"],threshold:12,strength:500}:e==="both"?{edges:["left","right","top"],threshold:12,strength:500}:e==="none"?{edges:[],threshold:0,strength:0}:{...rt,...e}}function Ee(e,n,o){if(o.edges.length===0)return!1;const s=n.getBoundingClientRect(),{threshold:r,edges:i}=o;return i.some(a=>a==="left"?e.x-s.left<r:a==="right"?s.right-e.x<r:a==="top"?e.y-s.top<r:a==="bottom"?s.bottom-e.y<r:!1)}function xe(e,n,o,s){return!n||o.edges.length===0?0:Ee(e,n,o)?o.strength*s:0}var ke=1e3;function Me(e,n,o,s){let r=ke,i=!1;if(n.every(l=>{const c=l.evaluate(e);return r-=c,r<=0?(i=!0,!1):!0}),i)return-1;const a=e.view.nodeDOM(e.pos);return r-=xe(s,a,o,e.depth),r<=0?-1:r}function Fe(e,n,o){return Array.from({length:n},(s,r)=>n-1-r).some(s=>o.includes(e.node(s).type.name))}function De(e,n,o){if(!Number.isFinite(n.x)||!Number.isFinite(n.y))return null;const s=e.posAtCoords({left:n.x,top:n.y});if(!s)return null;const{doc:r}=e.state,i=r.resolve(s.pos),a=[];o.defaultRules&&a.push(...Ce),a.push(...o.rules);const l=Array.from({length:i.depth},(d,u)=>i.depth-u).map(d=>{const u=i.node(d),h=i.before(d);if(o.allowedContainers&&d>0&&!Fe(i,d,o.allowedContainers))return null;const p=d>0?i.node(d-1):null,f=d>0?i.index(d-1):0,m=p?p.childCount:1,v={node:u,pos:h,depth:d,parent:p,index:f,isFirst:f===0,isLast:f===m-1,$pos:i,view:e},y=Me(v,a,o.edgeDetection,n);if(y<0)return null;const x=e.nodeDOM(h);return{node:u,pos:h,depth:d,score:y,dom:x}}).filter(d=>d!==null);if(l.length===0)return null;l.sort((d,u)=>u.score!==d.score?u.score-d.score:u.depth-d.depth);const c=l[0];return c.dom?{node:c.node,pos:c.pos,dom:c.dom}:null}function Pe(e,n){let o=e;for(;o?.parentElement&&o.parentElement!==n.dom;)o=o.parentElement;return o?.parentElement===n.dom?o:void 0}function it(e){return Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)&&e.width>0&&e.height>0}function $e(e,n,o,s=5){if(!Number.isFinite(n)||!Number.isFinite(o))return null;const r=e.dom,i=r.firstElementChild,a=r.lastElementChild;if(!i||!a)return null;const l=i.getBoundingClientRect(),c=a.getBoundingClientRect();if(!it(l)||!it(c))return null;const d=Math.min(Math.max(l.top+s,o),c.bottom-s),u=.5,h=Math.abs(l.left-c.left)<u,p=Math.abs(l.right-c.right)<u;let f=l;h&&p&&(f=l);const m=Math.min(Math.max(f.left+s,n),f.right-s);return!Number.isFinite(m)||!Number.isFinite(d)?null:{x:m,y:d}}var yt=e=>{const{x:n,y:o,editor:s,nestedOptions:r}=e,{view:i,state:a}=s,l=$e(i,n,o,5);if(!l)return{resultElement:null,resultNode:null,pos:null};const{x:c,y:d}=l;if(r?.enabled){const m=De(i,{x:c,y:d},r);return m?{resultElement:m.dom,resultNode:m.node,pos:m.pos}:{resultElement:null,resultNode:null,pos:null}}const u=i.root.elementsFromPoint(c,d);let h;if(Array.prototype.some.call(u,m=>{if(!i.dom.contains(m))return!1;const v=Pe(m,i);return v?(h=v,!0):!1}),!h)return{resultElement:null,resultNode:null,pos:null};let p;try{p=i.posAtDOM(h,0)}catch{return{resultElement:null,resultNode:null,pos:null}}const f=a.doc.nodeAt(p);if(!f){const m=a.doc.resolve(p),v=m.parent;return{resultElement:h,resultNode:v,pos:m.start()}}return{resultElement:h,resultNode:f,pos:p}};function wt(e){var n;(n=e.parentNode)==null||n.removeChild(e)}function Se(e,n,o,s){const{doc:r}=n.view.state;if(o?.enabled&&s?.node&&s.pos>=0){const c=s.pos,d=s.pos+s.node.nodeSize;return[{$from:r.resolve(c),$to:r.resolve(d)}]}const i=yt({editor:n,x:e.clientX,y:e.clientY,nestedOptions:o});if(!i.resultNode||i.pos===null)return[];const a=r.resolve(i.pos),l=r.resolve(i.pos+i.resultNode.nodeSize);return L(a,l,0)}function Oe(e,n,o,s){const{view:r}=n;if(!e.dataTransfer)return;const{empty:i,$from:a,$to:l}=r.state.selection,c=Se(e,n,o,s),d=L(a,l,0),u=d.some(k=>c.find(M=>M.$from===k.$from&&M.$to===k.$to)),h=i||!u?c:d;if(!h.length)return;const{tr:p}=r.state,f=document.createElement("div"),m=h[0].$from.pos,v=h[h.length-1].$to.pos,y=o?.enabled&&s?.node;let x,P;y?(x=r.state.doc.slice(m,v),P=Ut.create(r.state.doc,m)):(P=D.create(r.state.doc,m,v),x=P.content()),h.forEach(k=>{const M=r.nodeDOM(k.$from.pos),A=ve(M);f.append(A)}),f.style.position="absolute",f.style.top="-10000px",document.body.append(f),e.dataTransfer.clearData(),e.dataTransfer.setDragImage(f,0,0),r.dragging={slice:x,move:!0},p.setSelection(P),r.dispatch(p),document.addEventListener("drop",()=>wt(f),{once:!0})}var at=(e,n)=>{const o=e.resolve(n),{depth:s}=o;return s===0?n:o.pos-o.parentOffset-1},lt=(e,n)=>{const o=e.nodeAt(n),s=e.resolve(n);let{depth:r}=s,i=o;for(;r>0;){const a=s.node(r);r-=1,r===0&&(i=a)}return i},q=(e,n)=>{const o=_.getState(e);return o?ht(n,o.type,o.binding.mapping):null},Ae=(e,n)=>{const o=_.getState(e);return o?pt(o.doc,o.type,n,o.binding.mapping)||0:-1},dt=(e,n)=>{let o=n;for(;o?.parentNode&&o.parentNode!==e.dom;)o=o.parentNode;return o},bt=new U("dragHandle"),Ct=({pluginKey:e=bt,element:n,editor:o,computePositionConfig:s,getReferencedVirtualElement:r,onNodeChange:i,onElementDragStart:a,onElementDragEnd:l,nestedOptions:c})=>{const d=document.createElement("div");let u=!1,h=null,p=-1,f,m=null,v=null;function y(){n&&(n.style.visibility="hidden",n.style.pointerEvents="none")}function x(){if(n){if(!o.isEditable){y();return}n.style.visibility="",n.style.pointerEvents="auto"}}function P(g){const b=r?.()||{getBoundingClientRect:()=>g.getBoundingClientRect()};Bt(b,n,s).then($=>{Object.assign(n.style,{position:$.strategy,left:`${$.x}px`,top:`${$.y}px`})})}function k(g){a?.(g),Oe(g,o,c,{node:h,pos:p}),n&&(n.dataset.dragging="true"),setTimeout(()=>{n&&(n.style.pointerEvents="none")},0)}function M(g){l?.(g),y(),n&&(n.style.pointerEvents="auto",n.dataset.dragging="false")}function A(){if(Vt()){const g=o.view.dom;requestAnimationFrame(()=>{g.isContentEditable&&(g.contentEditable="false",g.contentEditable="true")})}}return n.addEventListener("dragstart",k),n.addEventListener("dragend",M),document.addEventListener("drop",A),d.appendChild(n),{unbind(){n.removeEventListener("dragstart",k),n.removeEventListener("dragend",M),document.removeEventListener("drop",A),m&&(cancelAnimationFrame(m),m=null,v=null)},plugin:new Y({key:typeof e=="string"?new U(e):e,state:{init(){return{locked:!1}},apply(g,b,$,S){const w=g.getMeta("lockDragHandle"),C=g.getMeta("hideDragHandle");if(w!==void 0&&(u=w),C)return y(),u=!1,h=null,p=-1,i?.({editor:o,node:null,pos:-1}),b;if(g.docChanged&&p!==-1&&n)if(mt(g)){const E=Ae(S,f);E!==p&&(p=E)}else{const E=g.mapping.map(p);E!==p&&(p=E,f=q(S,p))}return b}},view:g=>{var b;return n.draggable=!0,n.style.pointerEvents="auto",n.dataset.dragging="false",(b=o.view.dom.parentElement)==null||b.appendChild(d),d.style.pointerEvents="none",d.style.position="absolute",d.style.top="0",d.style.left="0",{update($,S){if(!n)return;if(!o.isEditable){y();return}if(u?n.draggable=!1:n.draggable=!0,g.state.doc.eq(S.doc)||p===-1)return;let w=g.nodeDOM(p);if(w=dt(g,w),w===g.dom||w?.nodeType!==1)return;const C=g.posAtDOM(w,0),E=lt(o.state.doc,C),H=at(o.state.doc,C);h=E,p=H,f=q(g.state,p),i?.({editor:o,node:h,pos:p}),P(w)},destroy(){n.removeEventListener("dragstart",k),n.removeEventListener("dragend",M),document.removeEventListener("drop",A),m&&(cancelAnimationFrame(m),m=null,v=null),n&&wt(d)}}},props:{handleDOMEvents:{keydown(g){return!n||u||g.hasFocus()&&(y(),h=null,p=-1,i?.({editor:o,node:null,pos:-1})),!1},mouseleave(g,b){return u||b.target&&!d.contains(b.relatedTarget)&&(y(),h=null,p=-1,i?.({editor:o,node:null,pos:-1})),!1},mousemove(g,b){return!n||u||(v={x:b.clientX,y:b.clientY},m)||(m=requestAnimationFrame(()=>{if(m=null,!v)return;const{x:$,y:S}=v;v=null;const w=yt({x:$,y:S,editor:o,nestedOptions:c});if(!w.resultElement)return;let C=w.resultElement,E=w.resultNode,H=w.pos;if(!c?.enabled){if(C=dt(g,C),C===g.dom||C?.nodeType!==1)return;const tt=g.posAtDOM(C,0);E=lt(o.state.doc,tt),H=at(o.state.doc,tt)}E!==h&&(h=E,p=H??-1,f=q(g.state,p),i?.({editor:o,node:h,pos:p}),P(C),x())})),!1}}}})}};function Et(e){var n,o;return e===!1||e===void 0?{enabled:!1,rules:[],defaultRules:!0,allowedContainers:void 0,edgeDetection:j("none")}:e===!0?{enabled:!0,rules:[],defaultRules:!0,allowedContainers:void 0,edgeDetection:j("left")}:{enabled:!0,rules:(n=e.rules)!=null?n:[],defaultRules:(o=e.defaultRules)!=null?o:!0,allowedContainers:e.allowedContainers,edgeDetection:j(e.edgeDetection)}}var xt={placement:"left-start",strategy:"absolute"};X.create({name:"dragHandle",addOptions(){return{render(){const e=document.createElement("div");return e.classList.add("drag-handle"),e},computePositionConfig:{},locked:!1,onNodeChange:()=>null,onElementDragStart:void 0,onElementDragEnd:void 0,nested:!1}},addCommands(){return{lockDragHandle:()=>({editor:e})=>(this.options.locked=!0,e.commands.setMeta("lockDragHandle",this.options.locked)),unlockDragHandle:()=>({editor:e})=>(this.options.locked=!1,e.commands.setMeta("lockDragHandle",this.options.locked)),toggleDragHandle:()=>({editor:e})=>(this.options.locked=!this.options.locked,e.commands.setMeta("lockDragHandle",this.options.locked))}},addProseMirrorPlugins(){const e=this.options.render(),n=Et(this.options.nested);return[Ct({computePositionConfig:{...xt,...this.options.computePositionConfig},getReferencedVirtualElement:this.options.getReferencedVirtualElement,element:e,editor:this.editor,onNodeChange:this.options.onNodeChange,onElementDragStart:this.options.onElementDragStart,onElementDragEnd:this.options.onElementDragEnd,nestedOptions:n}).plugin]}});var Ne=Zt,Re=Ne.extend({name:"DragHandleVue",props:{pluginKey:{type:[String,Object],default:()=>bt},editor:{type:Object,required:!0},computePositionConfig:{type:Object,default:()=>({})},onNodeChange:{type:Function,default:null},onElementDragStart:{type:Function,default:null},onElementDragEnd:{type:Function,default:null},class:{type:String,default:"drag-handle"},nested:{type:[Boolean,Object],default:!1}},mounted(){const{editor:e,pluginKey:n,onNodeChange:o,onElementDragStart:s,onElementDragEnd:r,nested:i}=this.$props,a=Et(i);e.registerPlugin(Ct({editor:e,element:this.$el,pluginKey:n,computePositionConfig:{...xt,...this.computePositionConfig},onNodeChange:o,onElementDragStart:s,onElementDragEnd:r,nestedOptions:a}).plugin)},beforeDestroy(){const{pluginKey:e,editor:n}=this.$props;n.unregisterPlugin(e)},render(e){return e("div",{class:this.class,attrs:{"data-dragging":"false"}},this.$slots.default)}});const _e={name:"DragVerticalIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var He=function(){var e=this,n=e._self._c;return n("span",e._b({staticClass:"material-design-icon drag-vertical-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(o){return e.$emit("click",o)}}},"span",e.$attrs,!1),[n("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M9,3H11V5H9V3M13,3H15V5H13V3M9,7H11V9H9V7M13,7H15V9H13V7M9,11H11V13H9V11M13,11H15V13H13V11M9,15H11V17H9V15M13,15H15V17H13V15M9,19H11V21H9V19M13,19H15V21H13V19Z"}},[e.title?n("title",[e._v(e._s(e.title))]):e._e()])])])},Ie=[],Te=O(_e,He,Ie,!1,null,null);const Ve=Te.exports,Be={name:"FloatingButtons",components:{DragHandle:Re,DragVerticalIcon:Ve,NcButton:Qt,PlusIcon:zt},setup(){const{editor:e}=Q();return{editor:e}},data(){return{node:null,pos:-1}},computed:{isHeadingNode(){return this.node?.type===this.editor.schema.nodes.heading}},methods:{onNodeChange({node:e,pos:n}){this.node=e,this.pos=n},onOpenSmartPicker(){if(!this.node||this.pos===-1)return;const{schema:e}=this.editor,n=this.node.textContent.trim()===""&&(this.node.children.length===0||this.node.children.every(o=>o.type===e.nodes.text))?this.pos+1:this.pos+this.node.nodeSize;this.editor.chain().insertContentAt(n,"/").focus().run()},t:kt}};var Ue=function(){var e=this,n=e._self._c;return n("DragHandle",{staticClass:"floating-buttons",class:{heading:e.isHeadingNode},attrs:{editor:e.editor,"on-node-change":e.onNodeChange}},[n("NcButton",{attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Insert below"),"aria-label":e.t("text","Insert below")},on:{click:e.onOpenSmartPicker},scopedSlots:e._u([{key:"icon",fn:function(){return[n("PlusIcon",{attrs:{size:16}})]},proxy:!0}])}),n("NcButton",{staticClass:"drag-button",attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Click for options, hold to drag"),"aria-label":e.t("text","Click for options, hold to drag")},scopedSlots:e._u([{key:"icon",fn:function(){return[n("DragVerticalIcon",{attrs:{size:16}})]},proxy:!0}])})],1)},ze=[],Le=O(Be,Ue,ze,!1,null,"3e6ea9fb");const We=Le.exports,Ke={name:"ContentContainer",components:{EditorContent:Wt,FloatingButtons:We,TocContainer:Lt},props:{readOnly:{type:Boolean,required:!0}},setup(){const e=z(),{editor:n}=Q(),{isRichEditor:o,isRichWorkspace:s,useTableOfContents:r}=Z();return{editor:n,isMobile:e,isRichEditor:o,isRichWorkspace:s,useTableOfContents:r}},computed:{showFloatingButtons(){return!this.readOnly&&!this.isMobile&&this.isRichEditor&&!this.isRichWorkspace}}};var je=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor__content-wrapper",attrs:{"data-text-el":"editor-content-wrapper"}},[e._t("default"),e.showFloatingButtons?n("FloatingButtons"):e._e(),n("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.editor}}),e.useTableOfContents?n("TocContainer"):e._e()],2)},qe=[],Je=O(Ke,je,qe,!1,null,"424b5b08");const Mn=Je.exports;function Xe(e,n){const{documentId:o,sessionId:s,sessionToken:r,shareToken:i}=G(e),a=new FormData;a.append("file",n);const l=R("apps/text/attachment/upload?");return B.post(l,a,{headers:{"Content-Type":"multipart/form-data"},params:{documentId:o,sessionId:s,sessionToken:r,token:i}})}function Ye(e,n){const{documentId:o,sessionId:s,sessionToken:r}=G(e),i=R("apps/text/attachment/create");return B.post(i,{documentId:o,sessionId:s,sessionToken:r,fileName:`${n.app}${n.extension}`})}function Ze(e,n){const{documentId:o,sessionId:s,sessionToken:r}=G(e),i=R("apps/text/attachment/filepath");return B.post(i,{documentId:o,sessionId:s,sessionToken:r,filePath:n})}const ct=e=>e.split("/").slice(0,-1).join("/"),Qe={name:"MediaHandler",mixins:[Gt],provide(){const e={};return Object.defineProperties(e,{[oe]:{get:()=>this.showAttachmentPrompt},[ne]:{get:()=>this.chooseLocalFile},[ee]:{get:()=>this.createAttachment},[te]:{get:()=>this.state}}),e},setup(){const{connection:e}=Kt(),n=z(),{editor:o}=Q();return{connection:e,editor:o,isMobile:n}},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??ct(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e,n){n.dataTransfer.types.includes("Files")&&(this.draggedOver=e)},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,n=null){if(!e)return;this.state.isUploadingAttachments=!0;const o=[...e].map(s=>this.uploadAttachmentFile(s,n));return Promise.all(o).catch(s=>{I.error("Uploading multiple attachments failed",{error:s}),N(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,n=null){return this.state.isUploadingAttachments=!0,Xe(this.connection,e).then(o=>{this.insertAttachment(o.data?.name,o.data?.id,e.type,n,o.data?.dirname)}).catch(o=>{I.error("Uploading attachment failed",{error:o}),o.response?.data.error?N(t("text","Uploading attachment failed: {error}",{error:o.response.data.error})):N(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){Ft()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=ct(e),this.state.isUploadingAttachments=!0,Ze(this.connection,e).then(n=>{this.insertAttachment(n.data?.name,n.data?.id,n.data?.mimetype,null,n.data?.dirname)}).catch(n=>{I.error("Failed to insert from Files",{error:n}),N(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},createAttachment(e){return this.state.isUploadingAttachments=!0,Ye(this.connection,e).then(n=>{this.insertAttachmentPreview(n.data?.id)}).catch(n=>{I.error("Failed to create attachment",{error:n}),N(t("text","Failed to create attachment"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachmentPreview(e){const n=new URL(R(`/f/${e}`),window.origin).href.replaceAll(" ","%20");this.editor.chain().focus().insertPreview(n).run()},insertAttachment(e,n,o,s=null,r=""){const i=r+"/"+encodeURIComponent(e).replace(/[!'()*]/g,c=>"%"+c.charCodeAt(0).toString(16).toUpperCase()),a=e.replaceAll(/[[\]]/g,"");(s?this.editor.chain().focus(s):this.editor.chain()).setImage({src:i,alt:a}).run();const l=this.editor.view.state.selection;l.empty||this.editor.commands.focus(l.to),this.editor.commands.scrollIntoView(),this.editor.commands.setMeta("insertedAttachmentSrc",{src:i}),ut("text:image-node:add",null)}}};var Ge=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver,"is-mobile":e.isMobile},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!0,o)},dragleave:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!1,o)},drop:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!1,o)},"file-drop":e.onEditorDrop}},[n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},tn=[],en=O(Qe,Ge,tn,!1,null,null);const nn=en.exports,on={name:"MainContainer",components:{MediaHandler:nn},mixins:[se]};var sn=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor"},[e.$editorUpload?n("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},rn=[],an=O(on,sn,rn,!1,null,"e0c9a19c");const Fn=an.exports,ln={name:"Wrapper",provide(){const e={};return Object.defineProperties(e,{[jt]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0}},setup(){const{isRichEditor:e,isRichWorkspace:n}=Z();return{isRichEditor:e,isRichWorkspace:n}},methods:{readOnlyToggle(){this.$emit("read-only-toggled")}}};var dn=function(){var e=this,n=e._self._c;return n("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.isRichWorkspace,"is-rich-editor":e.isRichEditor}},[e._t("default")],2)},cn=[],un=O(ln,dn,cn,!1,null,"bc674721");const Dn=un.exports;export{Mn as C,Fn as M,Dn as W,En as a,J as e,xn as p,kn as u};
//# sourceMappingURL=Wrapper-Bwac550a.chunk.mjs.map
