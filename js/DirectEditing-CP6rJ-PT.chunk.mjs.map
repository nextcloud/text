{"version":3,"file":"DirectEditing-CP6rJ-PT.chunk.mjs","sources":["../src/views/DirectEditing.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div id=\"direct-editor\" :class=\"{'icon-loading': saving}\">\n\t\t<Editor ref=\"editor\"\n\t\t\t:initial-session=\"initialSession\"\n\t\t\t:file-id=\"initial.fileId\"\n\t\t\t:active=\"true\"\n\t\t\t:mime=\"initial.mimetype\"\n\t\t\t:is-direct-editing=\"true\"\n\t\t\t@ready=\"loaded\">\n\t\t\t<template v-if=\"isMobile\" #header>\n\t\t\t\t<button class=\"icon-share\" @click=\"share\" />\n\t\t\t\t<button class=\"icon-close\" @click=\"close\" />\n\t\t\t</template>\n\t\t</Editor>\n\t</div>\n</template>\n\n<script>\nimport Vue from 'vue'\nimport Editor from '../components/Editor.vue'\n\nimport { logger } from '../helpers/logger.js'\n\nconst log = Vue.observable({\n\tmessages: [],\n\tmtime: 0,\n})\n\nconst callMobileMessage = (messageName, attributes) => {\n\tlogger.debug(`callMobileMessage ${messageName}`, { attributes })\n\tlet message = messageName\n\tif (typeof attributes !== 'undefined') {\n\t\tmessage = {\n\t\t\tMessageName: messageName,\n\t\t\tValues: attributes,\n\t\t}\n\t}\n\tlet attributesString = null\n\ttry {\n\t\tattributesString = JSON.stringify(attributes)\n\t} catch (e) {\n\t\tattributesString = null\n\t}\n\n\t// Forward to mobile handler\n\tif (window.DirectEditingMobileInterface && typeof window.DirectEditingMobileInterface[messageName] === 'function') {\n\t\tif (attributesString === null || typeof attributesString === 'undefined') {\n\t\t\twindow.DirectEditingMobileInterface[messageName]()\n\t\t} else {\n\t\t\twindow.DirectEditingMobileInterface[messageName](attributesString)\n\t\t}\n\t}\n\n\t// iOS webkit fallback\n\tif (window.webkit\n\t\t&& window.webkit.messageHandlers\n\t\t&& window.webkit.messageHandlers.DirectEditingMobileInterface) {\n\t\twindow.webkit.messageHandlers.DirectEditingMobileInterface.postMessage(message)\n\t}\n\n\twindow.postMessage(message)\n}\n\nwindow.addEventListener('message', function(message) {\n\tlog.messages.push(message.data)\n\tlogger.debug('postMessage', { message })\n})\n\nexport default {\n\tname: 'DirectEditing',\n\tcomponents: { Editor },\n\tdata() {\n\t\treturn {\n\t\t\tinitial: OCP.InitialState.loadState('text', 'file'),\n\t\t\tmessages: log.messages,\n\t\t\tlog,\n\t\t\tsaving: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\tinitialSession() {\n\t\t\treturn JSON.parse(this.initial.session) || null\n\t\t},\n\t\tisMobile() {\n\t\t\treturn (window.DirectEditingMobileInterface || (window.webkit\n\t\t\t\t&& window.webkit.messageHandlers\n\t\t\t\t&& window.webkit.messageHandlers.DirectEditingMobileInterface))\n\t\t},\n\t},\n\tbeforeMount() {\n\t\tcallMobileMessage('loading')\n\t},\n\tmounted() {\n\t\tdocument.querySelector('meta[name=\"viewport\"]').setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0')\n\n\t\tthis.$refs.editor.$on('push:forbidden', () => {\n\t\t\tlogger.warn('push was forbidden due to invalidated session')\n\t\t\tthis.reload()\n\t\t})\n\t},\n\tmethods: {\n\t\tasync close() {\n\t\t\tthis.saving = true\n\t\t\tsetTimeout(async () => {\n\t\t\t\tawait this.$refs.editor.$destroy()\n\t\t\t\tcallMobileMessage('close')\n\t\t\t}, 0)\n\t\t},\n\t\tshare() {\n\t\t\tcallMobileMessage('share')\n\t\t},\n\t\tloaded() {\n\t\t\tcallMobileMessage('loaded')\n\t\t},\n\t\treload() {\n\t\t\tcallMobileMessage('reload')\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\">\n\tbody {\n\t\tposition: fixed;\n\t\tbackground-color: var(--color-main-background);\n\t}\n\n\t#content[class=app-public] {\n\t\tmargin: 0;\n\t\tmargin-top: 0;\n\t}\n</style>\n\n<style scoped lang=\"scss\">\n\t#direct-editor {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tposition: fixed;\n\t\toverflow: auto;\n\n\t\t&:deep(.text-editor) {\n\t\t\theight: 100%;\n\t\t\ttop: 0;\n\t\t}\n\t\t&:deep(.text-editor__wrapper div.ProseMirror) {\n\t\t\tmargin-top: 0;\n\t\t}\n\t}\n\n\tpre {\n\t\twidth: 100%;\n\t\tmax-width: 700px;\n\t\tmargin: auto;\n\t\tbackground-color: var(--color-background-dark);\n\t}\n\n\tbutton {\n\t\twidth: var(--default-clickable-area);\n\t\theight: var(--default-clickable-area);\n\t\tmargin: 0;\n\t\tbackground-size: 16px;\n\t\tborder: 0;\n\t\tbackground-color: transparent;\n\t\topacity: .5;\n\t\tcolor: var(--color-main-text);\n\t\tbackground-position: center center;\n\t\tvertical-align: top;\n\t\t&:hover, &:focus, &:active {\n\t\t\tbackground-color: var(--color-background-dark);\n\t\t}\n\t\t&.is-active,\n\t\t&:hover,\n\t\t&:focus {\n\t\t\topacity: 1;\n\t\t}\n\t}\n</style>\n"],"names":["log","Vue","callMobileMessage","messageName","attributes","logger","message","attributesString","_sfc_main","Editor"],"mappings":"k2BA4BA,MAAAA,EAAAC,EAAA,WAAA,CACA,SAAA,CAAA,EACA,MAAA,CACA,CAAA,EAEAC,EAAA,CAAAC,EAAAC,IAAA,CACAC,EAAA,MAAA,qBAAAF,CAAA,GAAA,CAAA,WAAAC,EAAA,EACA,IAAAE,EAAAH,EAOAI,EAAA,KACA,GAAA,CACAA,EAAA,KAAA,UAAAH,CAAA,CACA,MAAA,CACAG,EAAA,IACA,CAGA,OAAA,8BAAA,OAAA,OAAA,6BAAAJ,CAAA,GAAA,aACAI,IAAA,MAAA,OAAAA,EAAA,IACA,OAAA,6BAAAJ,CAAA,EAAA,EAEA,OAAA,6BAAAA,CAAA,EAAAI,CAAA,GAKA,OAAA,QACA,OAAA,OAAA,iBACA,OAAA,OAAA,gBAAA,8BACA,OAAA,OAAA,gBAAA,6BAAA,YAAAD,CAAA,EAGA,OAAA,YAAAA,CAAA,CACA,EAEA,OAAA,iBAAA,UAAA,SAAAA,EAAA,CACAN,EAAA,SAAA,KAAAM,EAAA,IAAA,EACAD,EAAA,MAAA,cAAA,CAAA,QAAAC,CAAA,CAAA,CACA,CAAA,EAEA,MAAAE,EAAA,CACA,KAAA,gBACA,WAAA,CAAA,OAAAC,CAAA,EACA,MAAA,CACA,MAAA,CACA,QAAA,IAAA,aAAA,UAAA,OAAA,MAAA,EACA,SAAAT,EAAA,SACA,IAAAA,EACA,OAAA,EACA,CACA,EACA,SAAA,CACA,gBAAA,CACA,OAAA,KAAA,MAAA,KAAA,QAAA,OAAA,GAAA,IACA,EACA,UAAA,CACA,OAAA,OAAA,8BAAA,OAAA,QACA,OAAA,OAAA,iBACA,OAAA,OAAA,gBAAA,4BACA,CACA,EACA,aAAA,CACAE,EAAA,SAAA,CACA,EACA,SAAA,CACA,SAAA,cAAA,uBAAA,EAAA,aAAA,UAAA,2EAAA,EAEA,KAAA,MAAA,OAAA,IAAA,iBAAA,IAAA,CACAG,EAAA,KAAA,+CAAA,EACA,KAAA,OAAA,CACA,CAAA,CACA,EACA,QAAA,CACA,MAAA,OAAA,CACA,KAAA,OAAA,GACA,WAAA,SAAA,CACA,MAAA,KAAA,MAAA,OAAA,SAAA,EACAH,EAAA,OAAA,CACA,EAAA,CAAA,CACA,EACA,OAAA,CACAA,EAAA,OAAA,CACA,EACA,QAAA,CACAA,EAAA,QAAA,CACA,EACA,QAAA,CACAA,EAAA,QAAA,CACA,CACA,CACA"}