import{t as h,c as n}from"./NcLoadingIcon-pzx-bM2e.chunk.mjs";import{u as o,s as i}from"./index-gMaV0V1e.chunk.mjs";import{l}from"./index-B64e8dYD.chunk.mjs";import{v as c}from"./index-DUrHmx5a.chunk.mjs";import{g as u,i as p}from"./NcNoteCard-Dz5-u2BY-DlVQ92TX.chunk.mjs";import{g as f}from"./Editor.singleton-DQvnHjNX.chunk.mjs";import{R as m}from"./RichTextReader-gfgCnO2W.chunk.mjs";import{n as k}from"./_plugin-vue2_normalizer-XSZyZ-Zg.chunk.mjs";import"./emoji-picker-DQhTjoLy.chunk.mjs";import"./vue.runtime.esm-UAI8SE-v.chunk.mjs";import"./EditorOutline-DfbrCuMb.chunk.mjs";import"./logger-DH1Ckv9w.chunk.mjs";import"./NcCheckboxRadioSwitch-CLnWsBwK-De_MbaV5.chunk.mjs";import"./MediaHandler.provider-B-6EH1Bu.chunk.mjs";import"./BaseReader-iF-dlwhh.chunk.mjs";const r=p(),R=c("apps/text"+(r?"/public":"")+"/workspace",2),w=h("text","Readme")+"."+l("text","default_file_extension"),d=[w,"Readme.md","README.md","readme.md"],y={name:"RichWorkspace",components:{RichTextReader:m,Editor:f},props:{content:{type:String,default:""},path:{type:String,required:!0},active:{type:Boolean,default:!0},hasRichWorkspace:{type:Boolean,default:!1}},data(){var e,t,s,a;return{localHasRichWorkspace:!1,focus:!1,folder:null,file:null,loaded:!1,ready:!1,autofocus:!1,shouldAutofocus:!1,hideMenu:!0,darkTheme:((t=(e=window==null?void 0:window.OCA)==null?void 0:e.Accessibility)==null?void 0:t.theme)==="dark",enabled:(a=(s=window==null?void 0:window.OCA)==null?void 0:s.Text)==null?void 0:a.RichWorkspaceEnabled}},computed:{shareToken(){return u()},shouldRender(){return this.enabled&&this.localHasRichWorkspace}},watch:{path(){this.reset()},ready(){this.shouldAutofocus=!1},focus(e){e||document.querySelector("#rich-workspace .text-editor__main").scrollTo(0,0)},shouldRender(e){e&&this.getFileInfo()},hasRichWorkspace(e){this.localHasRichWorkspace=e}},mounted(){this.localHasRichWorkspace=this.hasRichWorkspace,i("Text::showRichWorkspace",this.showRichWorkspace),i("Text::hideRichWorkspace",this.hideRichWorkspace),i("files:node:created",this.onFileCreated),i("files:node:deleted",this.onFileDeleted),i("files:node:renamed",this.onFileRenamed),this.listenKeydownEvents()},beforeDestroy(){o("Text::showRichWorkspace",this.showRichWorkspace),o("Text::hideRichWorkspace",this.hideRichWorkspace),o("files:node:created",this.onFileCreated),o("files:node:deleted",this.onFileDeleted),o("files:node:renamed",this.onFileRenamed),this.unlistenKeydownEvents()},methods:{onFocus(){this.focus=!0,this.hideMenu=!1,this.unlistenKeydownEvents()},reset(){this.file=null,this.focus=!1,this.shouldAutofocus=!1,this.$nextTick(()=>{this.shouldRender&&this.getFileInfo()})},getFileInfo(){this.file=null,this.ready=!1,this.loaded=!0;const e={path:this.path};return r&&(e.shareToken=this.shareToken),n.get(R,{params:e}).then(t=>{const s=t.data.ocs.data;return this.folder=s.folder||null,this.file=s.file,this.editing=!0,this.loaded=!0,this.autofocus=this.shouldAutofocus,!0}).catch(t=>(t.response.data.ocs&&t.response.data.ocs.data.folder?this.folder=t.response.data.ocs.data.folder:this.folder=null,this.file=null,this.loaded=!0,this.ready=!0,!1))},showRichWorkspace(e){this.enabled=!0},hideRichWorkspace(){this.enabled=!1},listenKeydownEvents(){window.addEventListener("keydown",this.onKeydown)},unlistenKeydownEvents(){window.removeEventListener("keydown",this.onKeydown)},onKeydown(e){e.key==="Tab"&&(this.hideMenu=!1)},onFileCreated(e){d.includes(e.basename)&&(this.shouldAutofocus=this.enabled,this.localHasRichWorkspace=!0)},onFileDeleted(e){var t;e.path===((t=this.file)==null?void 0:t.path)&&(this.localHasRichWorkspace=!1)},onFileRenamed(e){var t,s;d.includes(e.basename)?this.localHasRichWorkspace=!0:e.fileid===((t=this.file)==null?void 0:t.id)&&e.path!==((s=this.file)==null?void 0:s.path)&&(this.localHasRichWorkspace=!1)},t:h}};var W=function(){var e=this,t=e._self._c;return e.shouldRender?t("div",{class:{focus:e.focus,dark:e.darkTheme},attrs:{id:"rich-workspace"}},[!e.loaded||!e.ready?t("RichTextReader",{staticClass:"rich-workspace--preview",attrs:{content:e.content}}):e._e(),e.file?t("Editor",{directives:[{name:"show",rawName:"v-show",value:e.ready,expression:"ready"}],key:e.file.path,attrs:{"file-id":e.file.id,"relative-path":e.file.path,"share-token":e.shareToken,mime:e.file.mimetype,autofocus:e.autofocus,"hide-menu":e.hideMenu,active:"","rich-workspace":""},on:{ready:function(s){e.ready=!0},focus:e.onFocus}}):e._e()],1):e._e()},v=[],x=k(y,W,v,!1,null,"ddfd769f");const B=x.exports;export{B as default};
//# sourceMappingURL=RichWorkspace-oRHwl8Qu.chunk.mjs.map
