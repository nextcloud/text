var qt=Object.defineProperty,Jt=Object.defineProperties;var Yt=Object.getOwnPropertyDescriptors;var mt=Object.getOwnPropertySymbols;var Xt=Object.prototype.hasOwnProperty,Qt=Object.prototype.propertyIsEnumerable;var ft=e=>{throw TypeError(e)};var gt=(e,n,i)=>n in e?qt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,F=(e,n)=>{for(var i in n||(n={}))Xt.call(n,i)&&gt(e,i,n[i]);if(mt)for(var i of mt(n))Qt.call(n,i)&&gt(e,i,n[i]);return e},Q=(e,n)=>Jt(e,Yt(n));var Z=(e,n,i)=>n.has(e)||ft("Cannot "+i);var C=(e,n,i)=>(Z(e,n,"read from private field"),i?i.call(e):n.get(e)),M=(e,n,i)=>n.has(e)?ft("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(e):n.set(e,i),S=(e,n,i,s)=>(Z(e,n,"write to private field"),s?s.call(e,i):n.set(e,i),i),w=(e,n,i)=>(Z(e,n,"access private method"),i);import{f as U,r as I,c as A,p as vt,e as Zt,w as Gt,i as te,V as ee,j as rt}from"./vue.runtime.esm-UAI8SE-v.chunk.mjs";import{f as J,J as E,K as O,L as ne,U as ie,O as se,Q as oe,Y as ae,S as re,h as lt,T as le,V as de,g as Y,W as dt,x as ct,u as Ot,X as ce,Z as $t,_ as ue,y as he,$ as pe,a0 as me,a1 as yt,s as ut,a2 as ge,a3 as fe,a4 as _t,a5 as ve,a6 as ye,a7 as _e,a8 as be,a9 as ke,aa as xe,E as Ce,b as we,m as W,k as Me,ab as Se,ac as Ae,ad as Ee,ae as Oe,af as $e,ag as Te,ah as Ne,ai as Ie,aj as Pe,ak as Be,al as Fe,am as He,an as bt,ao as De}from"./EditorOutline-C4Z6-9-r.chunk.mjs";import{n as Tt,G as Nt,t as N,c as K,k as kt}from"./NcLoadingIcon-pzx-bM2e.chunk.mjs";import{u as It,c as Re,S as Le,d as Ve,e as Ue,b as We,f as Ke}from"./MediaHandler.provider-B-6EH1Bu.chunk.mjs";import{n as x}from"./_plugin-vue2_normalizer-XSZyZ-Zg.chunk.mjs";import{_ as T,U as je}from"./index-DUrHmx5a.chunk.mjs";import{g as ze}from"./emoji-picker-DQhTjoLy.chunk.mjs";import{N as qe,j as Je,u as Pt,e as Ye,b as Bt,s as H}from"./NcNoteCard-Dz5-u2BY-DlVQ92TX.chunk.mjs";import{s as Ft,e as ht,a as Xe,u as Qe}from"./index-gMaV0V1e.chunk.mjs";import{l as j}from"./logger-DH1Ckv9w.chunk.mjs";import{l as Ht}from"./index-B64e8dYD.chunk.mjs";import{u as Ze}from"./NcCheckboxRadioSwitch-CLnWsBwK-De_MbaV5.chunk.mjs";const Ge=e=>{var n,i;return((i=(n=E.getState(e))==null?void 0:n.undoManager)==null?void 0:i.undo())!=null},tn=e=>{var n,i;return((i=(n=E.getState(e))==null?void 0:n.undoManager)==null?void 0:i.redo())!=null},en=new Set(["paragraph"]),nn=(e,n)=>!(e instanceof se)||!(e.content instanceof oe)||!(e.content.type instanceof ae||e.content.type instanceof re&&n.has(e.content.type.nodeName))||e.content.type._length===0,sn=({protectedNodes:e=en,trackedOrigins:n=[],undoManager:i=null}={})=>new J({key:E,state:{init:(s,o)=>{const a=O.getState(o),r=i||new ie(a.type,{trackedOrigins:new Set([O].concat(n)),deleteFilter:l=>nn(l,e),captureTransaction:l=>l.meta.get("addToHistory")!==!1});return{undoManager:r,prevSel:null,hasUndoOps:r.undoStack.length>0,hasRedoOps:r.redoStack.length>0}},apply:(s,o,a,r)=>{const l=O.getState(r).binding,h=o.undoManager,c=h.undoStack.length>0,p=h.redoStack.length>0;return l?{undoManager:h,prevSel:ne(l,a),hasUndoOps:c,hasRedoOps:p}:c!==o.hasUndoOps||p!==o.hasRedoOps?Object.assign({},o,{hasUndoOps:h.undoStack.length>0,hasRedoOps:h.redoStack.length>0}):o}},view:s=>{const o=O.getState(s.state),a=E.getState(s.state).undoManager;return a.on("stack-item-added",({stackItem:r})=>{const l=o.binding;l&&r.meta.set(l,E.getState(s.state).prevSel)}),a.on("stack-item-popped",({stackItem:r})=>{const l=o.binding;l&&(l.beforeTransactionSelection=r.meta.get(l)||l.beforeTransactionSelection)}),{destroy:()=>{a.destroy()}}}}),rs=lt.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},addStorage(){return{isDisabled:!1}},onCreate(){this.editor.extensionManager.extensions.find(e=>e.name==="history")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:e,state:n,dispatch:i})=>(e.setMeta("preventDispatch",!0),E.getState(n).undoManager.undoStack.length===0?!1:i?Ge(n):!0),redo:()=>({tr:e,state:n,dispatch:i})=>(e.setMeta("preventDispatch",!0),E.getState(n).undoManager.redoStack.length===0?!1:i?tn(n):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){var e;const n=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),i=sn(this.options.yUndoOptions),s=i.spec.view;i.spec.view=r=>{const{undoManager:l}=E.getState(r.state);l.restore&&(l.restore(),l.restore=()=>{});const h=s?s(r):void 0;return{destroy:()=>{const c=l.trackedOrigins.has(l),p=l._observers;l.restore=()=>{c&&l.trackedOrigins.add(l),l.doc.on("afterTransaction",l.afterTransactionHandler),l._observers=p},h!=null&&h.destroy&&h.destroy()}}};const o=Q(F({},this.options.ySyncOptions),{onFirstRender:this.options.onFirstRender}),a=le(n,o);return this.editor.options.enableContentCheck&&((e=n.doc)===null||e===void 0||e.on("beforeTransaction",()=>{try{const r=de(n);if(r.content.length===0)return;this.editor.schema.nodeFromJSON(r).check()}catch(r){return this.editor.emit("contentError",{error:r,editor:this.editor,disableCollaboration:()=>{var l;(l=n.doc)===null||l===void 0||l.destroy(),this.storage.isDisabled=!0}}),!1}})),[a,i,this.editor.options.enableContentCheck&&new J({key:new Y("filterInvalidContent"),filterTransaction:()=>{var r;return this.storage.isDisabled&&((r=n.doc)===null||r===void 0||r.destroy()),!0}})].filter(Boolean)}});function on(e){return!!e.getMeta(O)}const an=U({name:"NcDialog",components:{NcDialogButton:Je,NcModal:qe},props:{name:{type:String,required:!0},message:{type:String,default:""},additionalTrapElements:{type:Array,validator:e=>Array.isArray(e)&&e.every(n=>typeof n=="string"||n instanceof HTMLElement),default:()=>[]},container:{type:String,required:!1,default:"body"},open:{type:Boolean,default:!0},size:{type:String,required:!1,default:"small",validator:e=>typeof e=="string"&&["small","normal","large","full"].includes(e)},buttons:{type:Array,required:!1,default:()=>[],validator:e=>Array.isArray(e)&&e.every(n=>typeof n=="object")},noClose:{type:Boolean,default:!1},canClose:{type:Boolean,default:!0},closeOnClickOutside:{type:Boolean,default:!1},isForm:{type:Boolean,default:!1},outTransition:{type:Boolean,default:!1},navigationClasses:{type:[String,Array,Object],required:!1,default:""},navigationAriaLabel:{type:String,required:!1,default:""},navigationAriaLabelledby:{type:String,required:!1,default:""},contentClasses:{type:[String,Array,Object],required:!1,default:""},dialogClasses:{type:[String,Array,Object],required:!1,default:""}},emits:["closing","update:open","submit"],setup(e,{emit:n,slots:i}){const s=I(),{width:o}=Pt(s,{width:900}),a=A(()=>o.value<876),r=A(()=>(i==null?void 0:i.navigation)!==void 0),l=Nt(),h=A(()=>e.navigationAriaLabel||void 0),c=A(()=>{if(!e.navigationAriaLabel)return e.navigationAriaLabelledby||l}),p=I(),d=A(()=>e.isForm&&!r.value?"form":"div"),u=A(()=>d.value==="form"?{submit(b){b.preventDefault(),n("submit",b)},reset(b){b.preventDefault(),n("reset",b)}}:{}),y=I(!0);function f(b,zt){(b.type==="submit"||b.nativeType==="submit")&&d.value==="form"&&!p.value.reportValidity()||(m(zt),window.setTimeout(()=>v(),300))}function m(b){y.value=!1,n("closing",b)}function v(){y.value=!0,n("update:open",!1)}const g=A(()=>({noClose:e.noClose||!e.canClose,container:e.container===void 0?"body":e.container,labelId:l,size:e.size,show:e.open&&y.value,outTransition:e.outTransition,closeOnClickOutside:e.closeOnClickOutside,additionalTrapElements:e.additionalTrapElements}));return{dialogElement:p,dialogListeners:u,dialogTagName:d,handleButtonClose:f,handleClosing:m,handleClosed:v,hasNavigation:r,navigationId:l,navigationAriaLabelAttr:h,navigationAriaLabelledbyAttr:c,isNavigationCollapsed:a,modalProps:g,wrapper:s}}});var rn=function(){var e=this,n=e._self._c;return e._self._setupProxy,e.open?n("NcModal",e._b({staticClass:"dialog__modal",attrs:{"enable-slideshow":!1,"enable-swipe":!1},on:{close:e.handleClosed,"update:show":function(i){return e.handleClosing()}}},"NcModal",e.modalProps,!1),[n("h2",{staticClass:"dialog__name",attrs:{id:e.navigationId},domProps:{textContent:e._s(e.name)}}),n(e.dialogTagName,e._g({ref:"dialogElement",tag:"component",staticClass:"dialog",class:e.dialogClasses},e.dialogListeners),[n("div",{ref:"wrapper",staticClass:"dialog__wrapper",class:{"dialog__wrapper--collapsed":e.isNavigationCollapsed}},[e.hasNavigation?n("nav",{staticClass:"dialog__navigation",class:e.navigationClasses,attrs:{"aria-label":e.navigationAriaLabelAttr,"aria-labelledby":e.navigationAriaLabelledbyAttr}},[e._t("navigation",null,{isCollapsed:e.isNavigationCollapsed})],2):e._e(),n("div",{staticClass:"dialog__content",class:e.contentClasses},[e._t("default",function(){return[n("p",{staticClass:"dialog__text"},[e._v(" "+e._s(e.message)+" ")])]})],2)]),n("div",{staticClass:"dialog__actions"},[e._t("actions",function(){return e._l(e.buttons,function(i,s){return n("NcDialogButton",e._b({key:s,on:{click:(o,a)=>e.handleButtonClose(i,a)}},"NcDialogButton",i,!1))})})],2)])],1):e._e()},ln=[],dn=Tt(an,rn,ln,!1,null,"66c29e13");const cn=dn.exports,un={name:"NcActionButton",components:{NextcloudVueNcActionButton:ct},extends:dt,mounted(){var e;(e=this.editor)==null||e.on("transaction",()=>this.updateState())},methods:{runAction(){var n,i;const{actionEntry:e}=this;e.click?e.click(this):(i=e.action((n=this.editor)==null?void 0:n.chain().focus(),this.editor))==null||i.run(),this.$nextTick(()=>{this.$emit("trigged",F({},e))})}}};var hn=function(){var e=this,n=e._self._c;return n("NextcloudVueNcActionButton",e._g({staticClass:"entry-single-action entry-action entry-action-item",class:e.state.class,attrs:{title:e.listItemTooltip||void 0,disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,type:e.state.type,"model-value":e.state.type!=="button"?e.state.active:void 0,"close-after-click":""},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[n(e.icon,{tag:"component"})]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.label)+" ")])},pn=[],mn=x(un,hn,pn,!1,null,null);const gn=mn.exports,fn={name:"ActionList",components:{NcActions:Ye,NcActionSeparator:$t,ActionListItem:gn},extends:dt,mixins:[Ot,ce],props:{forceEnabled:{type:Boolean,default:!1}},data:()=>({visible:!1,hasEnabledChild:!0}),computed:{currentChild(){const{state:e,editor:n,actionEntry:{children:i}}=this;return e.active?i.find(s=>pe(s,n)):null},icon(){return this.currentChild?this.currentChild.icon:this.actionEntry.icon},iconKey(){return"".concat(this.actionEntry.key,"/").concat(this.activeKey)},activeKey(){var e;return(e=this.currentChild)==null?void 0:e.key},children(){return this.actionEntry.children.filter(({visible:e})=>e===void 0?!0:typeof e=="function"?e(this):e)},labelWithSelected(){return this.currentChild?N("text",'{menuItemName}, "{selectedSubMenuItemName}" is selected',{menuItemName:this.actionEntry.label,selectedSubMenuItemName:this.currentChild.label}):this.actionEntry.label},isEnabled(){return this.forceEnabled||this.hasEnabledChild}},mounted(){var e,n;this.$_updateState=he(this.checkStateOfChildren.bind(this),50),(e=this.editor)==null||e.on("update",this.$_updateState),(n=this.editor)==null||n.on("selectionUpdate",this.$_updateState)},beforeDestroy(){var e,n;(e=this.editor)==null||e.off("update",this.$_updateState),(n=this.editor)==null||n.off("selectionUpdate",this.$_updateState)},methods:{onOpenChange(e){this.visible=e},runAction(){},onTrigger(e){var n;e!=null&&e.click||((n=this.editor)==null||n.chain().focus().run(),this.$emit("trigged",e))},checkStateOfChildren(){this.hasEnabledChild=this.children.some(e=>this.isChildEnabled(e))},isChildEnabled(e){return!e.isSeparator&&!ue(e,this.editor).disabled}}};var vn=function(){var e=this,n=e._self._c;return n("NcActions",e._b({staticClass:"entry-list-action entry-action",attrs:{title:e.tooltip,container:e.menuIDSelector,"aria-label":e.labelWithSelected,type:e.state.active?"primary":"tertiary","force-menu":!0,"data-text-action-entry":e.actionEntry.key,"data-text-action-active":e.activeKey,disabled:!e.isEnabled},on:{"update:open":e.onOpenChange},scopedSlots:e._u([{key:"icon",fn:function(){return[n(e.icon,{key:e.iconKey,tag:"component"})]},proxy:!0}])},"NcActions",e.state,!1),[e._l(e.children,function(i){var s;return[i.isSeparator?n("NcActionSeparator",{key:"child-".concat(i.key)}):n("ActionListItem",e._g({key:"child-".concat(i.key),attrs:{active:((s=e.currentChild)==null?void 0:s.key)===i.key,"is-item":"","action-entry":i},on:{trigged:e.onTrigger}},e.$listeners))]}),e._t("lastAction",null,null,{visible:e.visible})],2)},yn=[],_n=x(fn,vn,yn,!1,null,null);const Dt=_n.exports,bn={name:"ActionSingle",components:{NcButton:Bt},extends:dt,props:{isItem:{type:Boolean,default:!1}},mounted(){var e;(e=this.editor)==null||e.on("transaction",()=>this.updateState())},methods:{runAction(){var n,i;const{actionEntry:e}=this;e.click?e.click(this):(i=e.action((n=this.editor)==null?void 0:n.chain().focus(),this.editor))==null||i.run(),this.$nextTick(()=>{this.$emit("trigged",F({},e))})}}};var kn=function(){var e=this,n=e._self._c;return n("NcButton",e._g({staticClass:"entry-single-action entry-action",class:e.state.class,attrs:{disabled:e.state.disabled,"aria-keyshortcuts":e.keyshortcuts||void 0,"data-text-action-entry":e.actionEntry.key,"aria-label":e.label,title:e.tooltip,type:"tertiary",pressed:e.state.type!=="button"?e.state.active:void 0},on:{click:e.runAction},scopedSlots:e._u([{key:"icon",fn:function(){return[n(e.icon,{tag:"component"})]},proxy:!0},e.actionEntry.forceLabel?{key:"default",fn:function(){return[e._v(" "+e._s(e.label)+" ")]},proxy:!0}:null],null,!0)},e.$listeners))},xn=[],Cn=x(bn,kn,xn,!1,null,null);const Rt=Cn.exports,Lt=U({data(){return{activeMenuEntry:0,entries:[]}},computed:{visibleEntries(){return this.entries}},watch:{visibleEntries(){this.$nextTick(()=>{var e;(this.activeMenuEntry>this.visibleEntries.length||(e=this.visibleEntries[this.activeMenuEntry])!=null&&e.disabled)&&this.setNextMenuEntry()})}},methods:{disableMenuEntry(e,n){const i=this.visibleEntries.findIndex(({key:s})=>s===e);this.visibleEntries[i].disabled=n,n===!1&&this.activeMenuEntry===i&&this.$nextTick(()=>this.setNextMenuEntry())},setNextMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do this.activeMenuEntry=(this.activeMenuEntry+1)%e;while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},setPreviousMenuEntry(){const e=this.visibleEntries.length+(this.$refs.remainingEntries?1:0);do{const n=this.activeMenuEntry-1;this.activeMenuEntry=(n%e+e)%e}while(this.activeMenuEntry<this.visibleEntries.length&&this.visibleEntries[this.activeMenuEntry].disabled)},handleToolbarNavigation(e){var n,i;e.key==="ArrowRight"?this.setNextMenuEntry():e.key==="ArrowLeft"&&this.setPreviousMenuEntry(),this.activeMenuEntry===this.visibleEntries.length?(i=(n=this.$refs.remainingEntries)==null?void 0:n.focusButton)==null||i.call(n):[...this.$refs.menuEntries].sort((s,o)=>this.visibleEntries.findIndex(({key:a})=>a===s.$vnode.data.key)-this.visibleEntries.findIndex(({key:a})=>a===o.$vnode.data.key))[this.activeMenuEntry].focusButton()}}}),wn=U({name:"ReadonlyBar",components:{ActionList:Dt,ActionSingle:Rt},extends:Lt,mixins:[It],props:{isHidden:{type:Boolean,default:!1},openReadOnly:{type:Boolean,default:!1}},emits:["update:loaded"],setup(){const{isRichWorkspace:e}=ut();return{isRichWorkspace:e}},data(){return{entries:this.openReadOnly?[...me,...yt]:[...yt],isReady:!1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{t:N}});var Mn=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("div",{staticClass:"text-readonly-bar",class:{"text-readonly-bar--ready":e.isReady,"text-readonly-bar--is-workspace":e.isRichWorkspace,"text-readonly-bar--hide":e.isHidden,"is-mobile":e.$isMobile},attrs:{"data-text-el":"readonly-bar"}},[n("div",{ref:"menubar",staticClass:"text-readonly-bar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Editor actions")}},e._l(e.visibleEntries,function(i,s){return n(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(o){return e.disableMenuEntry(i.key,o)}}})}),1),n("div",{staticClass:"text-readonly-bar__slot"},[e._t("default")],2)])},Sn=[],An=x(wn,Mn,Sn,!1,null,"988a9965");const ls=An.exports;let xt=Ht("text","is_full_width_editor",!1);const et=Symbol("text:editor:width");function En(){const e=getComputedStyle(document.body).getPropertyValue("--text-editor-max-width"),n=document.documentElement.style.getPropertyValue("--text-editor-max-width");return!!e&&e!==n}const ds=()=>{if(En())return vt(et,null),{applyEditorWidth:()=>{}};const e=I(xt);vt(et,Zt(e)),Ft("text:editor:full-width",({value:s})=>{xt=s,e.value=s});const n=A(()=>e.value?"100%":"calc(80ch + 2 * 15 * var(--default-grid-baseline))"),i=()=>{document.documentElement.style.setProperty("--text-editor-max-width",n.value)};return Gt(n,i),{applyEditorWidth:i}},On=()=>{const e=te(et);return e===null?{canToggleWidth:!1}:{canToggleWidth:!0,isFullWidth:e,setFullWidth:n=>{K.post(T("/apps/text/settings"),{key:"is_full_width_editor",value:n?"1":"0"}),ht("text:editor:full-width",{value:n})}}},$n={name:"NcActionCheckbox",mixins:[ge],inject:{isInSemanticMenu:{from:"NcActions:isSemanticMenu",default:!1}},model:{prop:"modelValue",event:"update:modelValue"},props:{id:{type:String,default:()=>"action-"+Nt(),validator:e=>e.trim()!==""},checked:{type:Boolean,default:void 0},modelValue:{type:Boolean,default:!1},value:{type:[String,Number],default:""},disabled:{type:Boolean,default:!1}},emits:["change","check","uncheck","update:checked","update:modelValue","update:model-value"],setup(){return{model:Ze("checked","update:checked")}},computed:{isFocusable(){return!this.disabled},ariaChecked(){if(this.isInSemanticMenu)return this.model?"true":"false"}},methods:{checkInput(){this.$refs.label.click()},onChange(e){this.model=this.$refs.checkbox.checked,this.$emit("change",e),this.$refs.checkbox.checked?this.$emit("check"):this.$emit("uncheck")}}};var Tn=function(){var e=this,n=e._self._c;return n("li",{staticClass:"action",class:{"action--disabled":e.disabled},attrs:{role:e.isInSemanticMenu&&"presentation"}},[n("span",{staticClass:"action-checkbox",attrs:{role:e.isInSemanticMenu&&"menuitemcheckbox","aria-checked":e.ariaChecked}},[n("input",{ref:"checkbox",staticClass:"checkbox action-checkbox__checkbox",class:{focusable:e.isFocusable},attrs:{id:e.id,disabled:e.disabled,type:"checkbox"},domProps:{checked:e.model,value:e.value},on:{keydown:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")||i.ctrlKey||i.shiftKey||i.altKey||i.metaKey?null:(i.preventDefault(),e.checkInput.apply(null,arguments))},change:e.onChange}}),n("label",{ref:"label",staticClass:"action-checkbox__label",attrs:{for:e.id}},[e._v(e._s(e.text))]),e._e()],2)])},Nn=[],In=Tt($n,Tn,Nn,!1,null,"ee7191e1");const Pn=In.exports;var G={exports:{}},Ct;function Bn(){return Ct||(Ct=1,function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;function i(p){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},i(p)}var s=47,o=46,a=function(p){var d=i(p);if(d!=="string")throw new TypeError("Expected a string, got a ".concat(d))},r=function(p,d){for(var u="",y=0,f=-1,m=0,v,g=0;g<=p.length;++g){if(g<p.length)v=p.charCodeAt(g);else{if(v===s)break;v=s}if(v===s){if(!(f===g-1||m===1))if(f!==g-1&&m===2){if(u.length<2||y!==2||u.charCodeAt(u.length-1)!==o||u.charCodeAt(u.length-2)!==o){if(u.length>2){var b=u.lastIndexOf("/");if(b!==u.length-1){b===-1?(u="",y=0):(u=u.slice(0,b),y=u.length-1-u.lastIndexOf("/")),f=g,m=0;continue}}else if(u.length===2||u.length===1){u="",y=0,f=g,m=0;continue}}d&&(u.length>0?u+="/..":u="..",y=2)}else u.length>0?u+="/"+p.slice(f+1,g):u=p.slice(f+1,g),y=g-f-1;f=g,m=0}else v===o&&m!==-1?++m:m=-1}return u},l=function(p){try{return decodeURIComponent(p)}catch(d){return p}},h=function(p){a(p);var d=p;if(d.length===0)return".";var u=d.charCodeAt(0)===s,y=d.charCodeAt(d.length-1)===s;return d=l(d),d=r(d,!u),d.length===0&&!u&&(d="."),d.length>0&&y&&(d+="/"),u?"/"+d:d},c=h;n.default=c,e.exports=n.default}(G,G.exports)),G.exports}var Fn=Bn();const Hn=ze(Fn);var $,P,B,D,R,L,V,_,nt,it,st,ot,Vt,at;class cs{constructor({session:n,user:i,shareToken:s,currentDirectory:o,fileId:a}){M(this,_);M(this,$);M(this,P);M(this,B);M(this,D);M(this,R);M(this,L);M(this,V,[]);S(this,$,n),S(this,P,i),S(this,B,s),S(this,D,o),S(this,R,a!=null?a:n.documentId),S(this,L,w(this,_,nt).call(this))}async resolve(n,i=!0){let s;const o=/^\.attachments\.\d+\//;if(n.match(o)){const a=decodeURIComponent(n.replace(o,"").split("?")[0]);if(await C(this,L),s=w(this,_,it).call(this,a),i&&!s&&(await w(this,_,nt).call(this),s=w(this,_,it).call(this,a)),s)return s}return Dn(n)?{isImage:!0,name:w(this,_,st).call(this,n),previewUrl:n,fullUrl:n}:{isImage:!0,name:w(this,_,st).call(this,n),previewUrl:w(this,_,ot).call(this,n),fullUrl:w(this,_,ot).call(this,n)}}}$=new WeakMap,P=new WeakMap,B=new WeakMap,D=new WeakMap,R=new WeakMap,L=new WeakMap,V=new WeakMap,_=new WeakSet,nt=async function(){var i,s,o,a;const n=await K.post(T("/apps/text/attachments"),{documentId:(s=(i=C(this,$))==null?void 0:i.documentId)!=null?s:C(this,R),sessionId:(o=C(this,$))==null?void 0:o.id,sessionToken:(a=C(this,$))==null?void 0:a.token,shareToken:C(this,B)});S(this,V,n.data)},it=function(n){return C(this,V).find(i=>i.name===n)},st=function(n){return n.split("/").pop()},ot=function(n){if(C(this,P)){const a=C(this,P).uid,r=w(this,_,at).call(this,n).split("/").map(encodeURIComponent).join("/");return je("dav/files/".concat(a).concat(r))}const i=w(this,_,at).call(this,n).split("/"),s=i.pop(),o=i.join("/");return T("/s/{token}/download?path={dirname}&files={basename}",{token:C(this,B),basename:s,dirname:o})},Vt=function(n){return decodeURI(n.split("?")[0])},at=function(n){const i=[C(this,D),w(this,_,Vt).call(this,n)].join("/");return Hn(i)};function Dn(e){return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:")}function wt(e){if(!e.length)return _t.empty;const n=[],i=e[0].$from.node(0);return e.forEach(s=>{const o=s.$from.pos,a=s.$from.nodeAfter;a&&n.push(ve.node(o,o+a.nodeSize,{class:"ProseMirror-selectednoderange"}))}),_t.create(i,n)}function X(e,n,i){const s=[],o=e.node(0);i=typeof i=="number"&&i>=0?i:e.sameParent(n)?Math.max(0,e.sharedDepth(n.pos)-1):e.sharedDepth(n.pos);const a=new ye(e,n,i),r=a.depth===0?0:o.resolve(a.start).posAtIndex(0);return a.parent.forEach((l,h)=>{const c=r+h,p=c+l.nodeSize;if(c<a.start||c>=a.end)return;const d=new _e(o.resolve(c),o.resolve(p));s.push(d)}),s}class pt{constructor(n,i){this.anchor=n,this.head=i}map(n){return new pt(n.map(this.anchor),n.map(this.head))}resolve(n){const i=n.resolve(this.anchor),s=n.resolve(this.head);return new k(i,s)}}class k extends fe{constructor(n,i,s,o=1){const{doc:a}=n,r=n===i,l=n.pos===a.content.size&&i.pos===a.content.size,h=r&&!l?a.resolve(i.pos+(o>0?1:-1)):i,c=r&&l?a.resolve(n.pos-(o>0?1:-1)):n,p=X(c.min(h),c.max(h),s),d=h.pos>=n.pos?p[0].$from:p[p.length-1].$to,u=h.pos>=n.pos?p[p.length-1].$to:p[0].$from;super(d,u,p),this.depth=s}get $to(){return this.ranges[this.ranges.length-1].$to}eq(n){return n instanceof k&&n.$from.pos===this.$from.pos&&n.$to.pos===this.$to.pos}map(n,i){const s=n.resolve(i.map(this.anchor)),o=n.resolve(i.map(this.head));return new k(s,o)}toJSON(){return{type:"nodeRange",anchor:this.anchor,head:this.head}}get isForwards(){return this.head>=this.anchor}get isBackwards(){return!this.isForwards}extendBackwards(){const{doc:n}=this.$from;if(this.isForwards&&this.ranges.length>1){const o=this.ranges.slice(0,-1),a=o[0].$from,r=o[o.length-1].$to;return new k(a,r,this.depth)}const i=this.ranges[0],s=n.resolve(Math.max(0,i.$from.pos-1));return new k(this.$anchor,s,this.depth)}extendForwards(){const{doc:n}=this.$from;if(this.isBackwards&&this.ranges.length>1){const o=this.ranges.slice(1),a=o[0].$from,r=o[o.length-1].$to;return new k(r,a,this.depth)}const i=this.ranges[this.ranges.length-1],s=n.resolve(Math.min(n.content.size,i.$to.pos+1));return new k(this.$anchor,s,this.depth)}static fromJSON(n,i){return new k(n.resolve(i.anchor),n.resolve(i.head))}static create(n,i,s,o,a=1){return new this(n.resolve(i),n.resolve(s),o,a)}getBookmark(){return new pt(this.anchor,this.head)}}k.prototype.visible=!1;function z(e){return e instanceof k}lt.create({name:"nodeRange",addOptions(){return{depth:void 0,key:"Mod"}},addKeyboardShortcuts(){return{"Shift-ArrowUp":({editor:e})=>{const{depth:n}=this.options,{view:i,state:s}=e,{doc:o,selection:a,tr:r}=s,{anchor:l,head:h}=a;if(!z(a)){const p=k.create(o,l,h,n,-1);return r.setSelection(p),i.dispatch(r),!0}const c=a.extendBackwards();return r.setSelection(c),i.dispatch(r),!0},"Shift-ArrowDown":({editor:e})=>{const{depth:n}=this.options,{view:i,state:s}=e,{doc:o,selection:a,tr:r}=s,{anchor:l,head:h}=a;if(!z(a)){const p=k.create(o,l,h,n);return r.setSelection(p),i.dispatch(r),!0}const c=a.extendForwards();return r.setSelection(c),i.dispatch(r),!0},"Mod-a":({editor:e})=>{const{depth:n}=this.options,{view:i,state:s}=e,{doc:o,tr:a}=s,r=k.create(o,0,o.content.size,n);return a.setSelection(r),i.dispatch(a),!0}}},onSelectionUpdate(){const{selection:e}=this.editor.state;z(e)&&this.editor.view.dom.classList.add("ProseMirror-noderangeselection")},addProseMirrorPlugins(){let e=!1,n=!1;return[new J({key:new Y("nodeRange"),props:{attributes:()=>e?{class:"ProseMirror-noderangeselection"}:{class:""},handleDOMEvents:{mousedown:(i,s)=>{const{key:o}=this.options,a=/Mac/.test(navigator.platform),r=!!s.shiftKey,l=!!s.ctrlKey,h=!!s.altKey,c=!!s.metaKey,p=a?c:l;return(o==null||o==="Shift"&&r||o==="Control"&&l||o==="Alt"&&h||o==="Meta"&&c||o==="Mod"&&p)&&(n=!0),n&&document.addEventListener("mouseup",()=>{n=!1;const{state:d}=i,{doc:u,selection:y,tr:f}=d,{$anchor:m,$head:v}=y;if(m.sameParent(v))return;const g=k.create(u,m.pos,v.pos,this.options.depth);f.setSelection(g),i.dispatch(f)},{once:!0}),!1}},decorations:i=>{const{selection:s}=i,o=z(s);if(e=!1,!n)return o?(e=!0,wt(s.ranges)):null;const{$from:a,$to:r}=s;if(!o&&a.sameParent(r))return null;const l=X(a,r,this.options.depth);return l.length?(e=!0,wt(l)):null}}})]}});function Rn(e){let n="";const i=getComputedStyle(e);for(let s=0;s<i.length;s+=1)n+="".concat(i[s],":").concat(i.getPropertyValue(i[s]),";");return n}function Ln(e){const n=e.cloneNode(!0),i=[e,...Array.from(e.getElementsByTagName("*"))],s=[n,...Array.from(n.getElementsByTagName("*"))];return i.forEach((o,a)=>{s[a].style.cssText=Rn(o)}),n}const Ut=e=>{const{x:n,y:i,direction:s,editor:o}=e;let a=null,r=null,l=null,h=n;for(;r===null&&h<window.innerWidth&&h>0;){const c=document.elementsFromPoint(h,i),p=c.findIndex(u=>u.classList.contains("ProseMirror")),d=c.slice(0,p);if(d.length>0){const u=d[0];if(a=u,l=o.view.posAtDOM(u,0),l>=0){r=o.state.doc.nodeAt(Math.max(l-1,0)),r!=null&&r.isText&&(r=o.state.doc.nodeAt(Math.max(l-1,0))),r||(r=o.state.doc.nodeAt(Math.max(l,0)));break}}s==="left"?h-=1:h+=1}return{resultElement:a,resultNode:r,pos:l!=null?l:null}};function q(e,n){return window.getComputedStyle(e)[n]}function Vn(e=0,n=0,i=0){return Math.min(Math.max(e,n),i)}function Un(e,n,i){const s=parseInt(q(e.dom,"paddingLeft"),10),o=parseInt(q(e.dom,"paddingRight"),10),a=parseInt(q(e.dom,"borderLeftWidth"),10),r=parseInt(q(e.dom,"borderLeftWidth"),10),l=e.dom.getBoundingClientRect();return{left:Vn(n,l.left+s+a,l.right-o-r),top:i}}function Wt(e){var n;(n=e.parentNode)===null||n===void 0||n.removeChild(e)}function Wn(e,n){const{doc:i}=n.view.state,s=Ut({editor:n,x:e.clientX,y:e.clientY,direction:"right"});if(!s.resultNode||s.pos===null)return[];const o=e.clientX,a=Un(n.view,o,e.clientY),r=n.view.posAtCoords(a);if(!r)return[];const{pos:l}=r;if(!i.resolve(l).parent)return[];const h=i.resolve(s.pos),c=i.resolve(s.pos+1);return X(h,c,0)}function Kn(e,n){const{view:i}=n;if(!e.dataTransfer)return;const{empty:s,$from:o,$to:a}=i.state.selection,r=Wn(e,n),l=X(o,a,0),h=l.some(v=>r.find(g=>g.$from===v.$from&&g.$to===v.$to)),c=s||!h?r:l;if(!c.length)return;const{tr:p}=i.state,d=document.createElement("div"),u=c[0].$from.pos,y=c[c.length-1].$to.pos,f=k.create(i.state.doc,u,y),m=f.content();c.forEach(v=>{const g=i.nodeDOM(v.$from.pos),b=Ln(g);d.append(b)}),d.style.position="absolute",d.style.top="-10000px",document.body.append(d),e.dataTransfer.clearData(),e.dataTransfer.setDragImage(d,0,0),i.dragging={slice:m,move:!0},p.setSelection(f),i.dispatch(p),document.addEventListener("drop",()=>Wt(d),{once:!0})}const Mt=(e,n)=>{const i=e.resolve(n),{depth:s}=i;return s===0?n:i.pos-i.parentOffset-1},St=(e,n)=>{const i=e.nodeAt(n),s=e.resolve(n);let{depth:o}=s,a=i;for(;o>0;){const r=s.node(o);o-=1,o===0&&(a=r)}return a},tt=(e,n)=>{const i=O.getState(e);return i?ke(n,i.type,i.binding.mapping):null},jn=(e,n)=>{const i=O.getState(e);return i?xe(i.doc,i.type,n,i.binding.mapping)||0:-1},At=(e,n)=>{let i=n;for(;i&&i.parentNode&&i.parentNode!==e.dom;)i=i.parentNode;return i},Kt=new Y("dragHandle"),jt=({pluginKey:e=Kt,element:n,editor:i,tippyOptions:s,onNodeChange:o})=>{const a=document.createElement("div");let r=null,l=!1,h=null,c=-1,p;return n.addEventListener("dragstart",d=>{Kn(d,i),setTimeout(()=>{n&&(n.style.pointerEvents="none")},0)}),n.addEventListener("dragend",()=>{n&&(n.style.pointerEvents="auto")}),new J({key:typeof e=="string"?new Y(e):e,state:{init(){return{locked:!1}},apply(d,u,y,f){const m=d.getMeta("lockDragHandle"),v=d.getMeta("hideDragHandle");if(m!==void 0&&(l=m),v&&r)return r.hide(),l=!1,h=null,c=-1,o==null||o({editor:i,node:null,pos:-1}),u;if(d.docChanged&&c!==-1&&n&&r)if(on(d)){const g=jn(f,p);g!==c&&(c=g)}else{const g=d.mapping.map(c);g!==c&&(c=g,p=tt(f,c))}return u}},view:d=>{var u;return n.draggable=!0,n.style.pointerEvents="auto",(u=i.view.dom.parentElement)===null||u===void 0||u.appendChild(a),a.appendChild(n),a.style.pointerEvents="none",a.style.position="absolute",a.style.top="0",a.style.left="0",{update(y,f){if(!n)return;if(!i.isEditable){r==null||r.destroy(),r=null;return}if(r||(r=be(d.dom,Q(F({getReferenceClientRect:null,interactive:!0,trigger:"manual",placement:"left-start",hideOnClick:!1,duration:100,popperOptions:{modifiers:[{name:"flip",enabled:!1},{name:"preventOverflow",options:{rootBoundary:"document",mainAxis:!1}}]}},s),{appendTo:a,content:n}))),l?n.draggable=!1:n.draggable=!0,d.state.doc.eq(f.doc)||c===-1)return;let m=d.nodeDOM(c);if(m=At(d,m),m===d.dom||(m==null?void 0:m.nodeType)!==1)return;const v=d.posAtDOM(m,0),g=St(i.state.doc,v),b=Mt(i.state.doc,v);h=g,c=b,p=tt(d.state,c),o==null||o({editor:i,node:h,pos:c}),r.setProps({getReferenceClientRect:()=>m.getBoundingClientRect()})},destroy(){r==null||r.destroy(),n&&Wt(a)}}},props:{handleDOMEvents:{keydown(d){return r&&r.state.isVisible&&d.hasFocus()&&r.hide(),!1},mouseleave(d,u){return l||u.target&&!a.contains(u.relatedTarget)&&(r==null||r.hide(),h=null,c=-1,o==null||o({editor:i,node:null,pos:-1})),!1},mousemove(d,u){if(!n||!r||l)return!1;const y=Ut({x:u.clientX,y:u.clientY,direction:"right",editor:i});if(!y.resultElement)return!1;let f=y.resultElement;if(f=At(d,f),f===d.dom||(f==null?void 0:f.nodeType)!==1)return!1;const m=d.posAtDOM(f,0),v=St(i.state.doc,m);if(v!==h){const g=Mt(i.state.doc,m);h=v,c=g,p=tt(d.state,c),o==null||o({editor:i,node:h,pos:c}),r.setProps({getReferenceClientRect:()=>f.getBoundingClientRect()}),r.show()}return!1}}}})};lt.create({name:"dragHandle",addOptions(){return{render(){const e=document.createElement("div");return e.classList.add("drag-handle"),e},tippyOptions:{},locked:!1,onNodeChange:()=>null}},addCommands(){return{lockDragHandle:()=>({editor:e})=>(this.options.locked=!0,e.commands.setMeta("lockDragHandle",this.options.locked)),unlockDragHandle:()=>({editor:e})=>(this.options.locked=!1,e.commands.setMeta("lockDragHandle",this.options.locked)),toggleDragHandle:()=>({editor:e})=>(this.options.locked=!this.options.locked,e.commands.setMeta("lockDragHandle",this.options.locked))}},addProseMirrorPlugins(){const e=this.options.render();return[jt({tippyOptions:this.options.tippyOptions,element:e,editor:this.editor,onNodeChange:this.options.onNodeChange})]}});const zn=ee.extend({name:"DragHandleVue",props:{pluginKey:{type:[String,Object],default:Kt},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},onNodeChange:{type:Function,default:null},class:{type:String,default:"drag-handle"}},mounted(){const{editor:e,pluginKey:n,onNodeChange:i,tippyOptions:s}=this.$props;e.registerPlugin(jt({editor:e,element:this.$el,pluginKey:n,tippyOptions:s,onNodeChange:i}))},beforeDestroy(){const{pluginKey:e,editor:n}=this.$props;n.unregisterPlugin(e)},render(e){return e("div",{class:this.class},this.$slots.default)}}),qn={name:"DragVerticalIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Jn=function(){var e=this,n=e._self._c;return n("span",e._b({staticClass:"material-design-icon drag-vertical-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[n("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M9,3H11V5H9V3M13,3H15V5H13V3M9,7H11V9H9V7M13,7H15V9H13V7M9,11H11V13H9V11M13,11H15V13H13V11M9,15H11V17H9V15M13,15H15V17H13V15M9,19H11V21H9V19M13,19H15V21H13V19Z"}},[e.title?n("title",[e._v(e._s(e.title))]):e._e()])])])},Yn=[],Xn=x(qn,Jn,Yn,!1,null,null);const Qn=Xn.exports,Zn={name:"ContentContainer",components:{EditorContent:we,EditorOutline:Ce,NcButton:Bt,DragHandle:zn,DragVerticalIcon:Qn},mixins:[Ot],setup(){const{editor:e}=W();return{editor:e}},computed:{showOutline(){return this.$outlineState.visible}}};var Gn=function(){var e=this,n=e._self._c;return n("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?n("div",{staticClass:"text-editor__content-wrapper__left"},[n("EditorOutline")],1):e._e(),e._t("default"),n("DragHandle",{staticClass:"drag-handle--button",attrs:{editor:e.editor}},[n("NcButton",{attrs:{type:"tertiary-no-background",size:"normal"},scopedSlots:e._u([{key:"icon",fn:function(){return[n("DragVerticalIcon",{attrs:{size:20}})]},proxy:!0}])})],1),n("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.editor}}),n("div",{staticClass:"text-editor__content-wrapper__right"})],2)},ti=[],ei=x(Zn,Gn,ti,!1,null,"645c6c0c");const us=ei.exports;function ni(e,n){const{documentId:i,sessionId:s,sessionToken:o,shareToken:a}=rt(e),r=new FormData;r.append("file",n);const l=T("apps/text/attachment/upload?");return K.post(l,r,{headers:{"Content-Type":"multipart/form-data"},params:{documentId:i,sessionId:s,sessionToken:o,token:a}})}function ii(e,n){const{documentId:i,sessionId:s,sessionToken:o}=rt(e),a=T("apps/text/attachment/create");return K.post(a,{documentId:i,sessionId:s,sessionToken:o,fileName:"".concat(n.app).concat(n.extension)})}function si(e,n){const{documentId:i,sessionId:s,sessionToken:o}=rt(e),a=T("apps/text/attachment/filepath");return K.post(a,{documentId:i,sessionId:s,sessionToken:o,filePath:n})}const Et=e=>e.split("/").slice(0,-1).join("/"),oi={name:"MediaHandler",mixins:[Re],provide(){const e={};return Object.defineProperties(e,{[We]:{get:()=>this.showAttachmentPrompt},[Ue]:{get:()=>this.chooseLocalFile},[Ve]:{get:()=>this.createAttachment},[Le]:{get:()=>this.state}}),e},setup(){const{connection:e}=Me(),n=Se(),{editor:i}=W();return{connection:e,editor:i,isMobile:n}},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){var e,n,i;return(i=this.lastFilePath)!=null?i:Et((n=(e=this.$file)==null?void 0:e.relativePath)!=null?n:"/")}},methods:{setDraggedOver(e,n){n.dataTransfer.types.includes("Files")&&(this.draggedOver=e)},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,n=null){if(!e)return;this.state.isUploadingAttachments=!0;const i=[...e].map(s=>this.uploadAttachmentFile(s,n));return Promise.all(i).catch(s=>{j.error("Uploading multiple attachments failed",{error:s}),H(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,n=null){return this.state.isUploadingAttachments=!0,ni(this.connection,e).then(i=>{var s,o,a;this.insertAttachment((s=i.data)==null?void 0:s.name,(o=i.data)==null?void 0:o.id,e.type,n,(a=i.data)==null?void 0:a.dirname)}).catch(i=>{var s;j.error("Uploading attachment failed",{error:i}),(s=i.response)!=null&&s.data.error?H(t("text","Uploading attachment failed: {error}",{error:i.response.data.error})):H(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){Xe()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=Et(e),this.state.isUploadingAttachments=!0,si(this.connection,e).then(n=>{var i,s,o,a;this.insertAttachment((i=n.data)==null?void 0:i.name,(s=n.data)==null?void 0:s.id,(o=n.data)==null?void 0:o.mimetype,null,(a=n.data)==null?void 0:a.dirname)}).catch(n=>{j.error("Failed to insert from Files",{error:n}),H(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},createAttachment(e){return this.state.isUploadingAttachments=!0,ii(this.connection,e).then(n=>{var i;this.insertAttachmentPreview((i=n.data)==null?void 0:i.id)}).catch(n=>{j.error("Failed to create attachment",{error:n}),H(t("text","Failed to create attachment"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachmentPreview(e){const n=new URL(T("/f/".concat(e)),window.origin).href.replaceAll(" ","%20");this.editor.chain().focus().insertPreview(n).run()},insertAttachment(e,n,i,s=null,o=""){const a=o+"/"+encodeURIComponent(e).replace(/[!'()*]/g,h=>"%"+h.charCodeAt(0).toString(16).toUpperCase()),r=e.replaceAll(/[[\]]/g,"");(s?this.editor.chain().focus(s):this.editor.chain()).setImage({src:a,alt:r}).run();const l=this.editor.view.state.selection;l.empty||this.editor.commands.focus(l.to),this.editor.commands.scrollIntoView(),this.editor.commands.setMeta("insertedAttachmentSrc",{src:a}),ht("text:image-node:add",null)}}};var ai=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver,"is-mobile":e.isMobile},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!0,i)},dragleave:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!1,i)},drop:function(i){return i.preventDefault(),i.stopPropagation(),e.setDraggedOver(!1,i)},"file-drop":e.onEditorDrop}},[n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},ri=[],li=x(oi,ai,ri,!1,null,null);const di=li.exports,ci={name:"MainContainer",components:{MediaHandler:di},mixins:[Ke]};var ui=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor"},[e.$editorUpload?n("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},hi=[],pi=x(ci,ui,hi,!1,null,"e0c9a19c");const hs=pi.exports,mi={name:"Wrapper",provide(){const e={};return Object.defineProperties(e,{[Oe]:{get:()=>this.outline},[Ee]:{get:()=>({toggle:this.outlineToggle})},[Ae]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},setup(){const{isRichEditor:e,isRichWorkspace:n}=ut();return{isRichEditor:e,isRichWorkspace:n}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return!this.isRichWorkspace}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){Ft("text:keyboard:outline",this.outlineToggle),this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})})},beforeDestroy(){Qe("text:keyboard:outline",this.outlineToggle)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},readOnlyToggle(){this.$emit("read-only-toggled")}}};var gi=function(){var e=this,n=e._self._c;return n("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.isRichWorkspace,"is-rich-editor":e.isRichEditor}},[e._t("default")],2)},fi=[],vi=x(mi,gi,fi,!1,null,"ae654636");const ps=vi.exports;function yi(){var e;return((e=navigator==null?void 0:navigator.userAgentData)==null?void 0:e.mobile)!==void 0?navigator.userAgentData.mobile:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/playbook/i,/silk/i,/BlackBerry/i,/Windows Phone/i].some(n=>navigator.userAgent.match(n))}const _i={name:"HelpModal",components:{NcDialog:cn},data(){return{formatted:{bold:!0,italic:!0,strikethrough:!0,heading1:!0,heading6:!0,unorderdList:!0,orderedList:!0,checkList:!0,blockQuote:!0,codeBlock:!0},ctrlOrModKey:$e[Te.Mod]}},computed:{isFormatted(){return e=>this.formatted[e]},isMobileCached(){return this.isMobilePlatform()}},methods:{t:N,toggleFormatted(e){this.formatted[e]=!this.formatted[e]},isMobilePlatform:yi}};var bi=function(){var e=this,n=e._self._c;return n("NcDialog",{attrs:{size:"large","data-text-el":"formatting-help",name:e.t("text","Formatting and shortcuts"),"close-on-click-outside":!0},on:{closing:function(i){return e.$emit("close")}}},[n("h2",[e._v(e._s(e.t("text","Formatting and shortcuts")))]),n("p",[e._v(e._s(e.t("text","Speed up your writing with simple shortcuts.")))]),e.isMobileCached?n("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax from below."))+" ")]):n("p",[e._v(" "+e._s(e.t("text","Just type the Markdown syntax or use keyboard shortcuts from below."))+" ")]),n("table",[n("thead",[n("tr",[n("th",[e._v(e._s(e.t("text","Style")))]),n("th",[e._v(e._s(e.t("text","Syntax")))]),e.isMobileCached?e._e():n("th",[e._v(" "+e._s(e.t("text","Keyboard shortcuts"))+" ")])])]),n("tbody",[n("tr",[n("td",[e._v(e._s(e.t("text","New paragraph")))]),n("td",[n("kbd",[e._v(e._s(e.t("text","Enter")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Hard line break")))]),n("td",[n("kbd",[e._v(e._s(e.t("text","Enter")))]),e._v(" "+e._s(e.t("text","followed by"))+" "),n("kbd",[e._v(e._s(e.t("text","Backspace")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Enter")))])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Bold")))]),n("td",[n("code",[e._v("**"+e._s(e.t("text","Bold text"))+"**")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("B")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Italic")))]),n("td",[n("code",[e._v("*"+e._s(e.t("text","Italicized text"))+"*")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("I")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Strikethrough")))]),n("td",[n("code",[e._v("~~"+e._s(e.t("text","Mistaken text"))+"~~")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("S")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Underline")))]),n("td",[n("code",[e._v("__"+e._s(e.t("text","Underlined text"))+"__")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("U")])])]),n("tr",[n("td",{staticClass:"ellipsis_top"},[e._v(" "+e._s(e.t("text","Heading 1"))+" ")]),n("td",{staticClass:"ellipsis_top"},[n("code",[e._v("# "+e._s(e.t("text","Heading level 1")))])]),e.isMobileCached?e._e():n("td",{staticClass:"ellipsis_top"},[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("1")])])]),n("tr",[n("td",{staticClass:"noborder ellipsis"},[e._v("…")]),n("td",{staticClass:"noborder ellipsis"},[e._v("…")]),e.isMobileCached?e._e():n("td",{staticClass:"ellipsis noborder"},[e._v("…")])]),n("tr",[n("td",{staticClass:"noborder ellipsis_bottom"},[e._v(" "+e._s(e.t("text","Heading 6"))+" ")]),n("td",{staticClass:"noborder ellipsis_bottom"},[n("code",[e._v("###### "+e._s(e.t("text","Heading level 6")))])]),e.isMobileCached?e._e():n("td",{staticClass:"noborder ellipsis_bottom"},[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("6")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Unordered list")))]),n("td",[n("code",[e._v("* "+e._s(e.t("text","An item")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("8")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Ordered list")))]),n("td",[n("code",[e._v("1. "+e._s(e.t("text","First item")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("7")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Checklist")))]),n("td",[n("code",[e._v("* [] "+e._s(e.t("text","To-Do item")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Shift")))]),e._v(" + "),n("kbd",[e._v("9")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Blockquote")))]),n("td",[n("code",[e._v("> "+e._s(e.t("text","Quoted text")))])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(">")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Code block")))]),n("td",[n("code",[e._v("``` "+e._s(e.t("text","Some code")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Link")))]),n("td",[n("code",[e._v("[Title](https://example.org)")])]),e.isMobileCached?e._e():n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("K")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Insert emoji")))]),n("td",[n("code",[e._v(":"+e._s(e.t("text","emoji")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Mention someone")))]),n("td",[n("code",[e._v("@"+e._s(e.t("text","name")))])]),e.isMobileCached?e._e():n("td")]),n("tr",[n("td",[e._v(e._s(e.t("text","Smart picker")))]),n("td",[n("code",[e._v("/"+e._s(e.t("text","something")))])]),e.isMobileCached?e._e():n("td")])])]),n("table",{attrs:{vif:"!isMobileCached"}},[n("thead",[n("tr",[n("th",[e._v(e._s(e.t("text","Action")))]),n("th",[e._v(e._s(e.t("text","Keyboard shortcuts")))])])]),n("tbody",[n("tr",[n("td",[e._v(e._s(e.t("text","Undo")))]),n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("Z")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Redo")))]),n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v("Y")])])]),n("tr",[n("td",[e._v(e._s(e.t("text","Toggle outline")))]),n("td",[n("kbd",[e._v(e._s(e.ctrlOrModKey))]),e._v(" + "),n("kbd",[e._v(e._s(e.t("text","Alt")))]),e._v(" + "),n("kbd",[e._v("H")])])])])])])},ki=[],xi=x(_i,bi,ki,!1,null,"5bb25ea4");const Ci=xi.exports,wi=U({name:"NcActionButton",components:{NextcloudVueNcActionButton:ct,Help:Ne},methods:{t:N}});var Mi=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("NextcloudVueNcActionButton",e._g({attrs:{"close-after-click":"","data-text-action-entry":"formatting-help"},scopedSlots:e._u([{key:"icon",fn:function(){return[n("Help")]},proxy:!0}])},e.$listeners),[e._v(" "+e._s(e.t("text","Formatting help"))+" ")])},Si=[],Ai=x(wi,Mi,Si,!1,null,null);const Ei=Ai.exports,Oi=U({name:"CharacterCount",components:{AlphabeticalVariant:Pe,NcActionText:Ie},props:{visible:Boolean},setup(){const{editor:e}=W(),n=I("");return{countString:n,refresh:()=>{const{storage:i,state:s}=e,o=i.characterCount.words({node:s.doc}),a=i.characterCount.characters({node:s.doc}),r=kt("text","%n word","%n words",o),l=kt("text","%n char","%n chars",a);n.value=[r,l].join(", "),console.debug({wordCount:o,charCount:a,countString:n.value})}}},watch:{visible:"refresh"},created(){this.refresh()}});var $i=function(){var e=this,n=e._self._c;return e._self._setupProxy,n("NcActionText",{attrs:{"data-text-action-entry":"character-count",name:e.countString},scopedSlots:e._u([{key:"icon",fn:function(){return[n("AlphabeticalVariant")]},proxy:!0}])})},Ti=[],Ni=x(Oi,$i,Ti,!1,null,null);const Ii=Ni.exports,Pi={__name:"TranslateButton",setup(e){var o;const{editor:n}=W(),i=Ht("text","translation_languages",{});console.debug(i);const s=!!((o=i.from)!=null&&o.length);return{__sfc:!0,editor:n,languages:i,canTranslate:s,showTranslate:()=>{const{commands:a,view:{state:r}}=n.value,{from:l,to:h}=r.selection;let c=r.doc.textBetween(l,h," ");c.trim().length||(a.selectAll(),c=r.doc.textContent),ht("text:translate-modal:show",{content:c})},t:N,NcActionButton:ct,TranslateVariant:Be}}};var Bi=function(){var e=this,n=e._self._c,i=e._self._setupProxy;return i.canTranslate?n(i.NcActionButton,{attrs:{"close-after-click":""},on:{click:i.showTranslate},scopedSlots:e._u([{key:"icon",fn:function(){return[n(i.TranslateVariant)]},proxy:!0}],null,!1,1799497554)},[e._v(" "+e._s(i.t("text","Translate"))+" ")]):e._e()},Fi=[],Hi=x(Pi,Bi,Fi,!1,null,null);const Di=Hi.exports,Ri={__name:"WidthToggle",setup(e){const{canToggleWidth:n,isFullWidth:i,setFullWidth:s}=On();return{__sfc:!0,canToggleWidth:n,isFullWidth:i,setFullWidth:s,t:N,NcActionCheckbox:Pn}}};var Li=function(){var e=this,n=e._self._c,i=e._self._setupProxy;return i.canToggleWidth?n(i.NcActionCheckbox,{attrs:{checked:i.isFullWidth},on:{"update:checked":i.setFullWidth}},[e._v(" "+e._s(i.t("text","Full width editor"))+" ")]):e._e()},Vi=[],Ui=x(Ri,Li,Vi,!1,null,null);const Wi=Ui.exports,Ki={name:"MenuBar",components:{ActionFormattingHelp:Ei,ActionList:Dt,ActionSingle:Rt,HelpModal:Ci,NcActionSeparator:$t,CharacterCount:Ii,TranslateButton:Di,WidthToggle:Wi},extends:Lt,mixins:[It],provide(){const e={};return Object.defineProperties(e,{[De]:{get:()=>this.randomID}}),e},props:{isHidden:{type:Boolean,default:!1},openReadOnly:{type:Boolean,default:!1}},setup(){const e=W(),{isRichEditor:n,isRichWorkspace:i}=ut(),s=I(),{width:o}=Pt(s);return{editor:e,isRichEditor:n,isRichWorkspace:i,menubar:s,width:o}},data(){return{entries:this.openReadOnly?[...He,...bt]:[...bt],randomID:"menu-bar-".concat(Math.ceil(Math.random()*1e4+500).toString(16)),displayHelp:!1,isReady:!1,resize:null}},computed:{visibleEntries(){return this.entries.filter(({priority:e})=>e===void 0||e<=this.iconsLimit)},hiddenEntries(){const e=this.entries.filter(({priority:i})=>i!==void 0&&i>this.iconsLimit),n=e.reduce((i,s,o)=>{var r;const a=(r=s.children)!=null?r:[s];if(a.length>1){const l=i.length&&!i.at(-1).isSeparator?[{key:"separator-before-".concat(s.id),isSeparator:!0}]:[],h=o!==e.length-1?[{key:"separator-after-".concat(s.id),isSeparator:!0}]:[];return[...i,...l,...a,...h]}return[...i,...a]},[]);return{key:"remain",label:this.t("text","Remaining actions"),icon:Fe,children:n}},iconWidth(){var n;const e=(n=this.menubar&&getComputedStyle(this.menubar))==null?void 0:n.getPropertyValue("--default-clickable-area");return parseInt(e)||34},iconsLimit(){const e=this.width-4,n=this.$isMobile?this.iconWidth:this.iconWidth+2;return Math.floor(e/n)-1}},mounted(){this.$nextTick(()=>{this.isReady=!0,this.$emit("update:loaded",!0)})},methods:{showHelp(){this.displayHelp=!0},hideHelp(){this.displayHelp=!1},t:N}};var ji=function(){var e=this,n=e._self._c;return n("div",{staticClass:"text-menubar",class:{"text-menubar--ready":e.isReady,"text-menubar--hide":e.isHidden,"text-menubar--is-workspace":e.isRichWorkspace,"is-mobile":e.$isMobile},attrs:{id:e.randomID,"data-text-el":"menubar",role:"region","aria-label":e.t("text","Editor actions")}},[e.displayHelp?n("HelpModal",{on:{close:e.hideHelp}}):e._e(),e.isRichEditor?n("div",{ref:"menubar",staticClass:"text-menubar__entries",attrs:{role:"toolbar","aria-label":e.t("text","Formatting menu bar")},on:{keyup:[function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&i.button!==0?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))},function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"right",39,i.key,["Right","ArrowRight"])||"button"in i&&i.button!==2?null:(i.stopPropagation(),e.handleToolbarNavigation.apply(null,arguments))}]}},[e._l(e.visibleEntries,function(i,s){return n(i.component?i.component:i.children?"ActionList":"ActionSingle",{key:i.key,ref:"menuEntries",refInFor:!0,tag:"component",attrs:{"action-entry":i,"can-be-focussed":e.activeMenuEntry===s},on:{disabled:function(o){return e.disableMenuEntry(i.key,o)},click:function(o){e.activeMenuEntry=s}}})}),n("ActionList",{ref:"remainingEntries",attrs:{"action-entry":e.hiddenEntries,"can-be-focussed":e.activeMenuEntry===e.visibleEntries.length,"force-enabled":!0},on:{click:function(i){e.activeMenuEntry="remain"}},scopedSlots:e._u([{key:"lastAction",fn:function({visible:i}){return[n("TranslateButton"),n("WidthToggle"),n("ActionFormattingHelp",{on:{click:e.showHelp}}),n("NcActionSeparator"),n("CharacterCount",e._b({},"CharacterCount",{visible:i},!1))]}}],null,!1,2138617236)})],2):e._e(),n("div",{staticClass:"text-menubar__slot"},[e._t("default")],2)],1)},zi=[],qi=x(Ki,ji,zi,!1,null,"a1de2021");const ms=qi.exports;export{cs as A,us as C,hs as M,cn as N,ls as R,ps as W,ms as a,rs as b,ds as p};
//# sourceMappingURL=MenuBar-D9PZRYXo.chunk.mjs.map
