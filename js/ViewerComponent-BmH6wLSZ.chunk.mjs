import{t as d,c as a}from"./NcLoadingIcon-n1legKz-.chunk.mjs";import{g as l,a as m}from"./dav-CQDyL7M_-SEe1KM7k.chunk.mjs";import{g as c,e as u}from"./EditorOutline-CAW-gHrT.chunk.mjs";import{N as p}from"./NcNoteCard-Dz5-u2BY-HSSBwaix.chunk.mjs";import{V as i}from"./vue.runtime.esm-Ci2e5rf_.chunk.mjs";import n from"./MarkdownContentEditor-DcTU43m2.chunk.mjs";import{P as r}from"./PlainTextReader-BQRpaUN7.chunk.mjs";import{g as f}from"./Editor.singleton-BTxLHxPL.chunk.mjs";import{n as h}from"./NcCheckboxRadioSwitch-CLnWsBwK-Cm2sDwes.chunk.mjs";import"./emoji-picker-DQhTjoLy.chunk.mjs";import"./index-BlQK9zQa.chunk.mjs";import"./index-DUrHmx5a.chunk.mjs";import"./index-CbuzdoNK.chunk.mjs";import"./logger-pVziSYm9.chunk.mjs";import"./index-B64e8dYD.chunk.mjs";import"./preload-helper-Dlt9bAsw.chunk.mjs";import"./MediaHandler.provider-8ybWSZ6u.chunk.mjs";import"./MenuBar-DeGSsJYz.chunk.mjs";import"./BaseReader-Dhl9GtAg.chunk.mjs";const g={name:"ViewerComponent",components:{NcButton:i.extend(p),PencilOutlineIcon:i.extend(u),PlainTextReader:i.extend(r),MarkdownContentEditor:i.extend(n),Editor:f},provide(){return{isEmbedded:this.isEmbedded}},props:{filename:{type:String,default:null},fileid:{type:Number,default:null},active:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!0},shareToken:{type:String,default:()=>c()},mime:{type:String,default:null},showOutlineOutside:{type:Boolean,default:!1},permissions:{type:String,default:""},source:{type:String,default:void 0},isEmbedded:{type:Boolean,default:!1}},data(){return{content:"",hasToggledInteractiveEmbedding:!1}},computed:{useSourceView(){return this.source&&(this.fileVersion||!this.fileid||this.isEmbedded||this.isEncrypted)&&!this.hasToggledInteractiveEmbedding},isEncrypted(){return this.$attrs.e2EeIsEncrypted||!1},isMarkdown(){return this.mime==="text/markdown"||this.mime==="text/x-web-markdown"},readerComponent(){return this.isMarkdown?n:r}},watch:{source(){this.loadFileContent()}},mounted(){this.loadFileContent()},methods:{async loadFileContent(){if(this.useSourceView)if(this.isEncrypted)this.content=await this.fetchDecryptedContent(),this.contentLoaded=!0;else{const e=await a.get(this.source);this.content=e.data,this.contentLoaded=!0}this.$emit("update:loaded",!0)},toggleEdit(){this.hasToggledInteractiveEmbedding=!0},async fetchDecryptedContent(){const e=await l().getFileContents("".concat(m()).concat(this.filename),{details:!0}),t=new Blob([e.data],{type:e.headers["content-type"]}),o=new FileReader;return o.readAsText(t),new Promise(s=>{o.onload=()=>{s(o.result)}})},t:d}};var y=function(){var e=this,t=e._self._c;return e.useSourceView?t("div",{staticClass:"text-editor source-viewer",attrs:{id:"editor-container","data-text-el":"editor-container"}},[t(e.readerComponent,{tag:"Component",attrs:{content:e.content,"file-id":e.fileid,"read-only":!0,"show-menu-bar":!1}}),e.isEmbedded?t("NcButton",{staticClass:"toggle-interactive",on:{click:e.toggleEdit},scopedSlots:e._u([{key:"icon",fn:function(){return[t("PencilOutlineIcon")]},proxy:!0}],null,!1,139796693)},[e._v(" "+e._s(e.t("text","Edit"))+" ")]):e._e()],1):t("Editor",{class:{"text-editor--embedding":e.isEmbedded},attrs:{"file-id":e.fileid,"relative-path":e.filename,active:e.active||e.isEmbedded,autofocus:e.autofocus,"share-token":e.shareToken,mime:e.mime,"show-outline-outside":e.showOutlineOutside}})},w=[],E=h(g,y,w,!1,null,"fed880cd");const R=E.exports;export{R as default};
//# sourceMappingURL=ViewerComponent-BmH6wLSZ.chunk.mjs.map
