const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=[window.OC.filePath('text', '', 'js/PublicFilesEditor-BjVHv_Yr.chunk.mjs'),window.OC.filePath('text', '', 'js/modulepreload-polyfill-BngdAj2f.chunk.mjs'),window.OC.filePath('text', '', 'js/emoji-picker-I9E7i3AY.chunk.mjs'),window.OC.filePath('text', '', 'js/_plugin-vue2_normalizer-BLkoDoDh.chunk.mjs'),window.OC.filePath('text', '', 'js/vue.runtime.esm-DpwteqB9.chunk.mjs'),window.OC.filePath('text', '', 'js/NcNoteCard-CImn6F9p-CUC-TA4E.chunk.mjs'),window.OC.filePath('text', '', 'css/NcNoteCard-CImn6F9p-B0wUvUiR.chunk.css'),window.OC.filePath('text', '', 'js/index-BMiQswLz.chunk.mjs'),window.OC.filePath('text', '', 'js/index-Ubm2itxG.chunk.mjs'),window.OC.filePath('text', '', 'js/index-DedwEVqf.chunk.mjs'),window.OC.filePath('text', '', 'css/_plugin-vue2_normalizer-BuF_RrMp.chunk.css'),window.OC.filePath('text', '', 'js/RichWorkspace-BqCX04Ey.chunk.mjs'),window.OC.filePath('text', '', 'js/Editor.singleton-DqlIh1tT.chunk.mjs'),window.OC.filePath('text', '', 'js/RichTextReader-Def_oStV.chunk.mjs'),window.OC.filePath('text', '', 'js/RichText-CPP7_HWb.chunk.mjs'),window.OC.filePath('text', '', 'js/index-BvGRGulv.chunk.mjs'),window.OC.filePath('text', '', 'js/MediaHandler.provider-B3sBWKr8.chunk.mjs'),window.OC.filePath('text', '', 'js/logger-BjUg4RMP.chunk.mjs'),window.OC.filePath('text', '', 'js/_plugin-vue2_normalizer-CQ6iBklL-ky8pO2EC.chunk.mjs'),window.OC.filePath('text', '', 'css/RichText-CRlZObVv.chunk.css'),window.OC.filePath('text', '', 'css/RichTextReader-jSftILGk.chunk.css'),window.OC.filePath('text', '', 'css/RichWorkspace-irRpBmr3.chunk.css')])))=>i.map(i=>d[i]);
/*! third party licenses: js/vendor.LICENSE.txt */
import{_ as f,g as A,e as O}from"./modulepreload-polyfill-BngdAj2f.chunk.mjs";import{H as g,b as E,N as v,P as _,F}from"./index-DjsDXqjw.chunk.mjs";import{h as I,c as b}from"./index-BMiQswLz.chunk.mjs";import{l as x}from"./index-Ubm2itxG.chunk.mjs";import{g as k}from"./token-DpxtlN7K.chunk.mjs";import{o as w}from"./mime-ChWVRLiA.chunk.mjs";import{s as R}from"./index-BvGRGulv.chunk.mjs";import{s as N,a as P,p as T}from"./_plugin-vue2_normalizer-CQ6iBklL-ky8pO2EC.chunk.mjs";import"./NcNoteCard-CImn6F9p-CUC-TA4E.chunk.mjs";import"./emoji-picker-I9E7i3AY.chunk.mjs";import"./index-DedwEVqf.chunk.mjs";import"./vue.runtime.esm-DpwteqB9.chunk.mjs";const V="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20id='mdi-text'%20viewBox='0%200%2024%2024'%3e%3cpath%20d='M21,6V8H3V6H21M3,18H12V16H3V18M3,13H21V11H3V13Z'%20/%3e%3c/svg%3e",h="Edit with text app",z=()=>{const i={attach(e){const o=e.fileList;o.id!=="files"&&o.id!=="files.public"||e.addMenuEntry({id:"file",displayName:t("text","New text file"),templateName:t("text","New text file")+"."+x("text","default_file_extension"),iconClass:"icon-filetype-text",fileType:"file",actionLabel:t("text","Create new text file"),actionHandler(c){o.createFile(c).then(function(a,d){const n=new OCA.Files.FileInfoModel(d);typeof OCA.Viewer<"u"?OCA.Files.fileActions.triggerAction("view",n,o):typeof OCA.Viewer>"u"&&OCA.Files.fileActions.triggerAction(h,n,o)})}})}};OC.Plugins.register("OCA.Files.NewFileMenu",i)},G=()=>{const i=k(),e=document.querySelector("#preview table.files-filestable");if(!i||!e){const o=document.createElement("div");o.id="text-viewer-fallback",document.body.appendChild(o);const c=a=>OCA.Files.fileActions.register(a,h,OC.PERMISSION_UPDATE|OC.PERMISSION_READ,I("core","actions/rename"),d=>{const n=window.FileList.findFile(d);Promise.all([f(()=>import("./vue.runtime.esm-DpwteqB9.chunk.mjs").then(r=>r.v),[],import.meta.url),f(()=>import("./PublicFilesEditor-BjVHv_Yr.chunk.mjs"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url)]).then(r=>{const s=window.FileList.getCurrentDirectory()+"/"+d,l=r[0].default;l.prototype.t=window.t,l.prototype.n=window.n,l.prototype.OCA=window.OCA;const u=r[1].default;new l({render:function(C){const y=this;return C(u,{props:{fileId:n?n.id:null,active:!0,shareToken:i,relativePath:s,mimeType:n.mimetype},on:{close:function(){y.$destroy()}}})}}).$mount(o)})},t("text","Edit"));for(let a=0;a<w.length;a++)c(w[a]),OCA.Files.fileActions.setDefault(w[a],h)}};let m=!1;const J=()=>{const i=t("text","Readme")+"."+x("text","default_file_extension");E({id:"rich-workspace-init",displayName:t("text","Add folder description"),category:v.CreateNew,enabled(e){return Number(e.attributes["rich-workspace-file"])?!1:(e.permissions&_.CREATE)!==0},iconSvgInline:V,async handler(e,o){var s,l;const c=o.map(u=>u.basename);if(c.includes(i)){N(t("text",'"{name}" already exist!',{name:i}));return}const a=e.encodedSource+"/"+encodeURIComponent(i),d=await b({method:"PUT",url:a,headers:{Overwrite:"F"}}),n=parseInt(d.headers["oc-fileid"]),r=new F({source:e.source+"/"+i,id:n,mtime:new Date,mime:"text/markdown",owner:((s=A())==null?void 0:s.uid)||null,permissions:_.ALL,root:(e==null?void 0:e.root)||"/files/"+((l=A())==null?void 0:l.uid)});P(t("text",'Created "{name}"',{name:i})),c.length===0&&(m=r),O("files:node:created",r)}})};let p=null;const K=new g({id:"workspace",order:10,enabled(i,e){return e.id==="files"||e.id==="favorites"},async render(i,e,o){p&&(p.$destroy(),p=null);const c=!!e.attributes["rich-workspace-file"]||!!m,a=m?T.dirname(m.path):e.path,d=m?"":e.attributes["rich-workspace"];m=!1;const{default:n}=await f(async()=>{const{default:r}=await import("./RichWorkspace-BqCX04Ey.chunk.mjs");return{default:r}},__vite__mapDeps([11,7,4,1,2,12,13,14,3,5,6,8,9,10,15,16,17,18,19,20,21]),import.meta.url);f(()=>import("./vue.runtime.esm-DpwteqB9.chunk.mjs").then(r=>r.v),[],import.meta.url).then(r=>{i.id="files-workspace-wrapper";const s=r.default;s.prototype.t=window.t,s.prototype.n=window.n,s.prototype.OCA=window.OCA;const l=s.extend(n);p=new l({propsData:{path:a,hasRichWorkspace:c,content:d},store:R}).$mount(i)})},updated(i,e){m=!1;const o=!!i.attributes["rich-workspace-file"];p.path=i.path,p.hasRichWorkspace=o,p.content=i.attributes["rich-workspace"]}});export{h as FILE_ACTION_IDENTIFIER,K as FilesWorkspaceHeader,J as addMenuRichWorkspace,G as registerFileActionFallback,z as registerFileCreate};
