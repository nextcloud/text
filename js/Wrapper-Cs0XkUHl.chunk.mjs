import{K as L,L as wt,M as U,O as bt,Q as xt,S as K,T as I,V as Et,W as Ct,X as kt,Y as Mt,Z as $,_ as ot,$ as st,a0 as Pt,a1 as X,a2 as St,a3 as Ot,a4 as Dt,a5 as $t,a6 as Ft,m as j,u as At,E as _t,b as Rt,a7 as it,s as rt,k as Ht,a8 as Tt,a9 as Nt,aa as It}from"./EditorOutline-DV-NqnRd.chunk.mjs";import{c as V,t as Vt}from"./NcLoadingIcon-5uBnEuod.chunk.mjs";import{s as at,e as lt,g as Bt,u as Ut}from"./index-CdM8BgQf.chunk.mjs";import{l as Wt}from"./index-D3wiQe9-.chunk.mjs";import{g as F}from"./index-DCzdQJ7L.chunk.mjs";import{r as zt,p as Y,e as Lt,c as Kt,w as jt,i as qt,V as Jt,j as q}from"./vue.runtime.esm-CmyF5LTP.chunk.mjs";import{N as Xt,s as D}from"./NcNoteCard-Dz5-u2BY-IIWSCEj5.chunk.mjs";import{n as O}from"./NcCheckboxRadioSwitch-DAPHFb0L-WBR_4UGV.chunk.mjs";import{u as Yt,S as Zt,c as Qt,d as Gt,b as te,e as ee}from"./MediaHandler.provider-kSxM7Osm.chunk.mjs";import{l as R}from"./logger-JRW888D7.chunk.mjs";function dt(e){return!!e.getMeta($)}function ne(e,n){const o=$.getState(e);return ot(o.doc,o.type,n,o.binding.mapping)||0}function ct(e,n){const o=$.getState(e);return st(n,o.type,o.binding.mapping)}var N=class ut extends Mt{constructor(n,o){super(n),this.yRelativePosition=o}static fromJSON(n){return new ut(n.position,n.yRelativePosition)}toJSON(){return{position:this.position,yRelativePosition:this.yRelativePosition}}};function oe(e,n){const o=ct(n,e);return new N(e,o)}function se(e,n,o){const s=e instanceof N?e.yRelativePosition:null;if(dt(n)&&s){const a=ne(o,s);return{position:new N(a,s),mapResult:null}}const i=kt(e,n),r=i.position.position;return{position:new N(r,s??ct(o,r)),mapResult:i.mapResult}}var rn=L.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null,provider:null}},addStorage(){return{isDisabled:!1}},onCreate(){this.editor.extensionManager.extensions.find(e=>e.name==="undoRedo")&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-undo-redo".')},onBeforeCreate(){this.editor.utils.getUpdatedPosition=(e,n)=>se(e,n,this.editor.state),this.editor.utils.createMappablePosition=e=>oe(e,this.editor.state)},addCommands(){return{undo:()=>({tr:e,state:n,dispatch:o})=>(e.setMeta("preventDispatch",!0),U.getState(n).undoManager.undoStack.length===0?!1:o?Ct(n):!0),redo:()=>({tr:e,state:n,dispatch:o})=>(e.setMeta("preventDispatch",!0),U.getState(n).undoManager.redoStack.length===0?!1:o?Et(n):!0)}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){var e;const n=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field),o=wt(this.options.yUndoOptions),s=o.spec.view;o.spec.view=a=>{const{undoManager:l}=U.getState(a.state);l.restore&&(l.restore(),l.restore=()=>{});const c=s?s(a):void 0;return{destroy:()=>{const d=l.trackedOrigins.has(l),u=l._observers;l.restore=()=>{d&&l.trackedOrigins.add(l),l.doc.on("afterTransaction",l.afterTransactionHandler),l._observers=u},c?.destroy&&c.destroy()}}};const i={...this.options.ySyncOptions,onFirstRender:this.options.onFirstRender},r=bt(n,i);return this.editor.options.enableContentCheck&&((e=n.doc)==null||e.on("beforeTransaction",()=>{try{const a=xt(n);if(a.content.length===0)return;this.editor.schema.nodeFromJSON(a).check()}catch(a){return this.editor.emit("contentError",{error:a,editor:this.editor,disableCollaboration:()=>{var l;(l=n.doc)==null||l.destroy(),this.storage.isDisabled=!0}}),!1}})),[r,o,this.editor.options.enableContentCheck&&new K({key:new I("filterInvalidContent"),filterTransaction:()=>{var a;return this.storage.isDisabled!==!1&&((a=n.doc)==null||a.destroy()),!0}})].filter(Boolean)}});let Z=Wt("text","is_full_width_editor",!1);const z=Symbol("text:editor:width");function ie(){const e=getComputedStyle(document.body).getPropertyValue("--text-editor-max-width"),n=document.documentElement.style.getPropertyValue("--text-editor-max-width");return!!e&&e!==n}const an=()=>{if(ie())return Y(z,null),{applyEditorWidth:()=>{}};const e=zt(Z);Y(z,Lt(e)),at("text:editor:full-width",({value:s})=>{Z=s,e.value=s});const n=Kt(()=>e.value?"100%":"80ch"),o=()=>{document.documentElement.style.setProperty("--text-editor-max-width",n.value)};return jt(n,o),{applyEditorWidth:o}},re=()=>{const e=qt(z);return e===null?{canToggleWidth:!1}:{canToggleWidth:!0,isFullWidth:e,setFullWidth:n=>{V.post(F("/apps/text/settings"),{key:"is_full_width_editor",value:n?"1":"0"}),lt("text:editor:full-width",{value:n})}}};function Q(e){if(!e.length)return X.empty;const n=[],o=e[0].$from.node(0);return e.forEach(s=>{const i=s.$from.pos,r=s.$from.nodeAfter;r&&n.push(St.node(i,i+r.nodeSize,{class:"ProseMirror-selectednoderange"}))}),X.create(o,n)}function B(e,n,o){const s=[],i=e.node(0);typeof o=="number"&&o>=0||(e.sameParent(n)?o=Math.max(0,e.sharedDepth(n.pos)-1):o=e.sharedDepth(n.pos));const r=new Ot(e,n,o),a=r.depth===0?0:i.resolve(r.start).posAtIndex(0);return r.parent.forEach((l,c)=>{const d=a+c,u=d+l.nodeSize;if(d<r.start||d>=r.end)return;const h=new Dt(i.resolve(d),i.resolve(u));s.push(h)}),s}var ae=class ht{constructor(n,o){this.anchor=n,this.head=o}map(n){return new ht(n.map(this.anchor),n.map(this.head))}resolve(n){const o=n.resolve(this.anchor),s=n.resolve(this.head);return new M(o,s)}},M=class k extends Pt{constructor(n,o,s,i=1){const{doc:r}=n,a=n===o,l=n.pos===r.content.size&&o.pos===r.content.size,c=a&&!l?r.resolve(o.pos+(i>0?1:-1)):o,d=a&&l?r.resolve(n.pos-(i>0?1:-1)):n,u=B(d.min(c),d.max(c),s),h=c.pos>=n.pos?u[0].$from:u[u.length-1].$to,g=c.pos>=n.pos?u[u.length-1].$to:u[0].$from;super(h,g,u),this.depth=s}get $to(){return this.ranges[this.ranges.length-1].$to}eq(n){return n instanceof k&&n.$from.pos===this.$from.pos&&n.$to.pos===this.$to.pos}map(n,o){const s=n.resolve(o.map(this.anchor)),i=n.resolve(o.map(this.head));return new k(s,i)}toJSON(){return{type:"nodeRange",anchor:this.anchor,head:this.head}}get isForwards(){return this.head>=this.anchor}get isBackwards(){return!this.isForwards}extendBackwards(){const{doc:n}=this.$from;if(this.isForwards&&this.ranges.length>1){const i=this.ranges.slice(0,-1),r=i[0].$from,a=i[i.length-1].$to;return new k(r,a,this.depth)}const o=this.ranges[0],s=n.resolve(Math.max(0,o.$from.pos-1));return new k(this.$anchor,s,this.depth)}extendForwards(){const{doc:n}=this.$from;if(this.isBackwards&&this.ranges.length>1){const i=this.ranges.slice(1),r=i[0].$from,a=i[i.length-1].$to;return new k(a,r,this.depth)}const o=this.ranges[this.ranges.length-1],s=n.resolve(Math.min(n.content.size,o.$to.pos+1));return new k(this.$anchor,s,this.depth)}static fromJSON(n,o){return new k(n.resolve(o.anchor),n.resolve(o.head))}static create(n,o,s,i,r=1){return new this(n.resolve(o),n.resolve(s),i,r)}getBookmark(){return new ae(this.anchor,this.head)}};M.prototype.visible=!1;function H(e){return e instanceof M}L.create({name:"nodeRange",addOptions(){return{depth:void 0,key:"Mod"}},addKeyboardShortcuts(){return{"Shift-ArrowUp":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:i,selection:r,tr:a}=s,{anchor:l,head:c}=r;if(!H(r)){const u=M.create(i,l,c,n,-1);return a.setSelection(u),o.dispatch(a),!0}const d=r.extendBackwards();return a.setSelection(d),o.dispatch(a),!0},"Shift-ArrowDown":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:i,selection:r,tr:a}=s,{anchor:l,head:c}=r;if(!H(r)){const u=M.create(i,l,c,n);return a.setSelection(u),o.dispatch(a),!0}const d=r.extendForwards();return a.setSelection(d),o.dispatch(a),!0},"Mod-a":({editor:e})=>{const{depth:n}=this.options,{view:o,state:s}=e,{doc:i,tr:r}=s,a=M.create(i,0,i.content.size,n);return r.setSelection(a),o.dispatch(r),!0}}},onSelectionUpdate(){const{selection:e}=this.editor.state;H(e)&&this.editor.view.dom.classList.add("ProseMirror-noderangeselection")},addProseMirrorPlugins(){let e=!1,n=!1;return[new K({key:new I("nodeRange"),props:{attributes:()=>e?{class:"ProseMirror-noderangeselection"}:{class:""},handleDOMEvents:{mousedown:(o,s)=>{const{key:i}=this.options,r=/Mac/.test(navigator.platform),a=!!s.shiftKey,l=!!s.ctrlKey,c=!!s.altKey,d=!!s.metaKey,u=r?d:l;return(i==null||i==="Shift"&&a||i==="Control"&&l||i==="Alt"&&c||i==="Meta"&&d||i==="Mod"&&u)&&(n=!0),n&&document.addEventListener("mouseup",()=>{n=!1;const{state:h}=o,{doc:g,selection:m,tr:v}=h,{$anchor:w,$head:E}=m;if(w.sameParent(E))return;const C=M.create(g,w.pos,E.pos,this.options.depth);v.setSelection(C),o.dispatch(v)},{once:!0}),!1}},decorations:o=>{const{selection:s}=o,i=H(s);if(e=!1,!n)return i?(e=!0,Q(s.ranges)):null;const{$from:r,$to:a}=s;if(!i&&r.sameParent(a))return null;const l=B(r,a,this.options.depth);return l.length?(e=!0,Q(l)):null}}})]}});function le(e){let n="";const o=getComputedStyle(e);for(let s=0;s<o.length;s+=1)n+=`${o[s]}:${o.getPropertyValue(o[s])};`;return n}function de(e){const n=e.cloneNode(!0),o=[e,...Array.from(e.getElementsByTagName("*"))],s=[n,...Array.from(n.getElementsByTagName("*"))];return o.forEach((i,r)=>{s[r].style.cssText=le(i)}),n}function ce(e,n){let o=e;for(;o?.parentElement&&o.parentElement!==n.dom;)o=o.parentElement;return o?.parentElement===n.dom?o:void 0}function ue(e,n,o,s=5){const i=e.dom,r=i.firstElementChild,a=i.lastElementChild;if(!r||!a)return{x:n,y:o};const l=r.getBoundingClientRect(),c=a.getBoundingClientRect(),d=Math.min(Math.max(l.top+s,o),c.bottom-s),u=.5,h=Math.abs(l.left-c.left)<u,g=Math.abs(l.right-c.right)<u;let m=l;return h&&g&&(m=l),{x:Math.min(Math.max(m.left+s,n),m.right-s),y:d}}var pt=e=>{const{x:n,y:o,editor:s}=e,{view:i,state:r}=s,{x:a,y:l}=ue(i,n,o,5),c=i.root.elementsFromPoint(a,l);let d;if(Array.prototype.some.call(c,g=>{if(!i.dom.contains(g))return!1;const m=ce(g,i);return m?(d=m,!0):!1}),!d)return{resultElement:null,resultNode:null,pos:null};let u;try{u=i.posAtDOM(d,0)}catch{return{resultElement:null,resultNode:null,pos:null}}const h=r.doc.nodeAt(u);return{resultElement:d,resultNode:h,pos:u}};function T(e,n){return window.getComputedStyle(e)[n]}function he(e=0,n=0,o=0){return Math.min(Math.max(e,n),o)}function pe(e,n,o){const s=parseInt(T(e.dom,"paddingLeft"),10),i=parseInt(T(e.dom,"paddingRight"),10),r=parseInt(T(e.dom,"borderLeftWidth"),10),a=parseInt(T(e.dom,"borderLeftWidth"),10),l=e.dom.getBoundingClientRect();return{left:he(n,l.left+s+r,l.right-i-a),top:o}}function mt(e){var n;(n=e.parentNode)==null||n.removeChild(e)}function me(e,n){const{doc:o}=n.view.state,s=pt({editor:n,x:e.clientX,y:e.clientY});if(!s.resultNode||s.pos===null)return[];const i=e.clientX,r=pe(n.view,i,e.clientY),a=n.view.posAtCoords(r);if(!a)return[];const{pos:l}=a;if(!o.resolve(l).parent)return[];const c=o.resolve(s.pos),d=o.resolve(s.pos+1);return B(c,d,0)}function ge(e,n){const{view:o}=n;if(!e.dataTransfer)return;const{empty:s,$from:i,$to:r}=o.state.selection,a=me(e,n),l=B(i,r,0),c=l.some(E=>a.find(C=>C.$from===E.$from&&C.$to===E.$to)),d=s||!c?a:l;if(!d.length)return;const{tr:u}=o.state,h=document.createElement("div"),g=d[0].$from.pos,m=d[d.length-1].$to.pos,v=M.create(o.state.doc,g,m),w=v.content();d.forEach(E=>{const C=o.nodeDOM(E.$from.pos),A=de(C);h.append(A)}),h.style.position="absolute",h.style.top="-10000px",document.body.append(h),e.dataTransfer.clearData(),e.dataTransfer.setDragImage(h,0,0),o.dragging={slice:w,move:!0},u.setSelection(v),o.dispatch(u),document.addEventListener("drop",()=>mt(h),{once:!0})}var G=(e,n)=>{const o=e.resolve(n),{depth:s}=o;return s===0?n:o.pos-o.parentOffset-1},tt=(e,n)=>{const o=e.nodeAt(n),s=e.resolve(n);let{depth:i}=s,r=o;for(;i>0;){const a=s.node(i);i-=1,i===0&&(r=a)}return r},W=(e,n)=>{const o=$.getState(e);return o?st(n,o.type,o.binding.mapping):null},fe=(e,n)=>{const o=$.getState(e);return o?ot(o.doc,o.type,n,o.binding.mapping)||0:-1},et=(e,n)=>{let o=n;for(;o?.parentNode&&o.parentNode!==e.dom;)o=o.parentNode;return o},gt=new I("dragHandle"),ft=({pluginKey:e=gt,element:n,editor:o,computePositionConfig:s,getReferencedVirtualElement:i,onNodeChange:r,onElementDragStart:a,onElementDragEnd:l})=>{const c=document.createElement("div");let d=!1,u=null,h=-1,g,m=null,v=null;function w(){n&&(n.style.visibility="hidden",n.style.pointerEvents="none")}function E(){if(n){if(!o.isEditable){w();return}n.style.visibility="",n.style.pointerEvents="auto"}}function C(p){const f=i?.()||{getBoundingClientRect:()=>p.getBoundingClientRect()};$t(f,n,s).then(P=>{Object.assign(n.style,{position:P.strategy,left:`${P.x}px`,top:`${P.y}px`})})}function A(p){a?.(p),ge(p,o),n&&(n.dataset.dragging="true"),setTimeout(()=>{n&&(n.style.pointerEvents="none")},0)}function J(p){l?.(p),w(),n&&(n.style.pointerEvents="auto",n.dataset.dragging="false")}return n.addEventListener("dragstart",A),n.addEventListener("dragend",J),c.appendChild(n),{unbind(){n.removeEventListener("dragstart",A),n.removeEventListener("dragend",J),m&&(cancelAnimationFrame(m),m=null,v=null)},plugin:new K({key:typeof e=="string"?new I(e):e,state:{init(){return{locked:!1}},apply(p,f,P,S){const y=p.getMeta("lockDragHandle"),b=p.getMeta("hideDragHandle");if(y!==void 0&&(d=y),b)return w(),d=!1,u=null,h=-1,r?.({editor:o,node:null,pos:-1}),f;if(p.docChanged&&h!==-1&&n)if(dt(p)){const x=fe(S,g);x!==h&&(h=x)}else{const x=p.mapping.map(h);x!==h&&(h=x,g=W(S,h))}return f}},view:p=>{var f;return n.draggable=!0,n.style.pointerEvents="auto",n.dataset.dragging="false",(f=o.view.dom.parentElement)==null||f.appendChild(c),c.style.pointerEvents="none",c.style.position="absolute",c.style.top="0",c.style.left="0",{update(P,S){if(!n)return;if(!o.isEditable){w();return}if(d?n.draggable=!1:n.draggable=!0,p.state.doc.eq(S.doc)||h===-1)return;let y=p.nodeDOM(h);if(y=et(p,y),y===p.dom||y?.nodeType!==1)return;const b=p.posAtDOM(y,0),x=tt(o.state.doc,b),_=G(o.state.doc,b);u=x,h=_,g=W(p.state,h),r?.({editor:o,node:u,pos:h}),C(y)},destroy(){m&&(cancelAnimationFrame(m),m=null,v=null),n&&mt(c)}}},props:{handleDOMEvents:{keydown(p){return!n||d||p.hasFocus()&&(w(),u=null,h=-1,r?.({editor:o,node:null,pos:-1})),!1},mouseleave(p,f){return d||f.target&&!c.contains(f.relatedTarget)&&(w(),u=null,h=-1,r?.({editor:o,node:null,pos:-1})),!1},mousemove(p,f){return!n||d||(v={x:f.clientX,y:f.clientY},m)||(m=requestAnimationFrame(()=>{if(m=null,!v)return;const{x:P,y:S}=v;v=null;const y=pt({x:P,y:S,editor:o});if(!y.resultElement)return;let b=y.resultElement;if(b=et(p,b),b===p.dom||b?.nodeType!==1)return;const x=p.posAtDOM(b,0),_=tt(o.state.doc,x);if(_!==u){const yt=G(o.state.doc,x);u=_,h=yt,g=W(p.state,h),r?.({editor:o,node:u,pos:h}),C(b),E()}})),!1}}}})}},vt={placement:"left-start",strategy:"absolute"};L.create({name:"dragHandle",addOptions(){return{render(){const e=document.createElement("div");return e.classList.add("drag-handle"),e},computePositionConfig:{},locked:!1,onNodeChange:()=>null,onElementDragStart:void 0,onElementDragEnd:void 0}},addCommands(){return{lockDragHandle:()=>({editor:e})=>(this.options.locked=!0,e.commands.setMeta("lockDragHandle",this.options.locked)),unlockDragHandle:()=>({editor:e})=>(this.options.locked=!1,e.commands.setMeta("lockDragHandle",this.options.locked)),toggleDragHandle:()=>({editor:e})=>(this.options.locked=!this.options.locked,e.commands.setMeta("lockDragHandle",this.options.locked))}},addProseMirrorPlugins(){const e=this.options.render();return[ft({computePositionConfig:{...vt,...this.options.computePositionConfig},getReferencedVirtualElement:this.options.getReferencedVirtualElement,element:e,editor:this.editor,onNodeChange:this.options.onNodeChange,onElementDragStart:this.options.onElementDragStart,onElementDragEnd:this.options.onElementDragEnd}).plugin]}});var ve=Jt,ye=ve.extend({name:"DragHandleVue",props:{pluginKey:{type:[String,Object],default:()=>gt},editor:{type:Object,required:!0},computePositionConfig:{type:Object,default:()=>({})},onNodeChange:{type:Function,default:null},onElementDragStart:{type:Function,default:null},onElementDragEnd:{type:Function,default:null},class:{type:String,default:"drag-handle"}},mounted(){const{editor:e,pluginKey:n,onNodeChange:o,onElementDragStart:s,onElementDragEnd:i}=this.$props;e.registerPlugin(ft({editor:e,element:this.$el,pluginKey:n,computePositionConfig:{...vt,...this.computePositionConfig},onNodeChange:o,onElementDragStart:s,onElementDragEnd:i}).plugin)},beforeDestroy(){const{pluginKey:e,editor:n}=this.$props;n.unregisterPlugin(e)},render(e){return e("div",{class:this.class,attrs:{"data-dragging":"false"}},this.$slots.default)}});const we={name:"DragVerticalIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var be=function(){var e=this,n=e._self._c;return n("span",e._b({staticClass:"material-design-icon drag-vertical-icon",attrs:{"aria-hidden":e.title?null:"true","aria-label":e.title,role:"img"},on:{click:function(o){return e.$emit("click",o)}}},"span",e.$attrs,!1),[n("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[n("path",{attrs:{d:"M9,3H11V5H9V3M13,3H15V5H13V3M9,7H11V9H9V7M13,7H15V9H13V7M9,11H11V13H9V11M13,11H15V13H13V11M9,15H11V17H9V15M13,15H15V17H13V15M9,19H11V21H9V19M13,19H15V21H13V19Z"}},[e.title?n("title",[e._v(e._s(e.title))]):e._e()])])])},xe=[],Ee=O(we,be,xe,!1,null,null);const Ce=Ee.exports,ke={name:"FloatingButtons",components:{DragHandle:ye,DragVerticalIcon:Ce,NcButton:Xt,PlusIcon:Ft},setup(){const{editor:e}=j();return{editor:e}},data(){return{node:null,pos:-1}},computed:{isHeadingNode(){return this.node?.type===this.editor.schema.nodes.heading}},methods:{onNodeChange({node:e,pos:n}){this.node=e,this.pos=n},onOpenSmartPicker(){if(!this.node||this.pos===-1)return;const{schema:e}=this.editor,n=this.node.textContent.trim()===""&&(this.node.children.length===0||this.node.children.every(o=>o.type===e.nodes.text))?this.pos+1:this.pos+this.node.nodeSize;this.editor.chain().insertContentAt(n,"/").focus().run()},t:Vt}};var Me=function(){var e=this,n=e._self._c;return n("DragHandle",{staticClass:"floating-buttons",class:{heading:e.isHeadingNode},attrs:{editor:e.editor,"on-node-change":e.onNodeChange}},[n("NcButton",{attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Insert below"),"aria-label":e.t("text","Insert below")},on:{click:e.onOpenSmartPicker},scopedSlots:e._u([{key:"icon",fn:function(){return[n("PlusIcon",{attrs:{size:16}})]},proxy:!0}])}),n("NcButton",{staticClass:"drag-button",attrs:{variant:"tertiary-no-background",size:"small",title:e.t("text","Click for options, hold to drag"),"aria-label":e.t("text","Click for options, hold to drag")},scopedSlots:e._u([{key:"icon",fn:function(){return[n("DragVerticalIcon",{attrs:{size:16}})]},proxy:!0}])})],1)},Pe=[],Se=O(ke,Me,Pe,!1,null,"3e6ea9fb");const Oe=Se.exports,De={name:"ContentContainer",components:{EditorContent:Rt,EditorOutline:_t,FloatingButtons:Oe},mixins:[At],props:{readOnly:{type:Boolean,required:!0}},setup(){const e=it(),{editor:n}=j(),{isRichEditor:o,isRichWorkspace:s}=rt(),{isFullWidth:i}=re();return{editor:n,isMobile:e,isFullWidth:i,isRichEditor:o,isRichWorkspace:s}},computed:{showOutline(){return this.$outlineState.visible},showFloatingButtons(){return!this.readOnly&&!this.isMobile&&!this.isFullWidth&&this.isRichEditor&&!this.isRichWorkspace}}};var $e=function(){var e=this,n=e._self._c;return n("div",{staticClass:"content-wrapper text-editor__content-wrapper",class:{"--show-outline":e.showOutline},attrs:{"data-text-el":"editor-content-wrapper"}},[e.showOutline?n("div",{staticClass:"text-editor__content-wrapper__left"},[n("EditorOutline")],1):e._e(),e._t("default"),e.showFloatingButtons?n("FloatingButtons"):e._e(),n("EditorContent",{staticClass:"editor__content text-editor__content",attrs:{role:"document",editor:e.editor}}),n("div",{staticClass:"text-editor__content-wrapper__right"})],2)},Fe=[],Ae=O(De,$e,Fe,!1,null,"86ce242a");const ln=Ae.exports;function _e(e,n){const{documentId:o,sessionId:s,sessionToken:i,shareToken:r}=q(e),a=new FormData;a.append("file",n);const l=F("apps/text/attachment/upload?");return V.post(l,a,{headers:{"Content-Type":"multipart/form-data"},params:{documentId:o,sessionId:s,sessionToken:i,token:r}})}function Re(e,n){const{documentId:o,sessionId:s,sessionToken:i}=q(e),r=F("apps/text/attachment/create");return V.post(r,{documentId:o,sessionId:s,sessionToken:i,fileName:`${n.app}${n.extension}`})}function He(e,n){const{documentId:o,sessionId:s,sessionToken:i}=q(e),r=F("apps/text/attachment/filepath");return V.post(r,{documentId:o,sessionId:s,sessionToken:i,filePath:n})}const nt=e=>e.split("/").slice(0,-1).join("/"),Te={name:"MediaHandler",mixins:[Yt],provide(){const e={};return Object.defineProperties(e,{[te]:{get:()=>this.showAttachmentPrompt},[Gt]:{get:()=>this.chooseLocalFile},[Qt]:{get:()=>this.createAttachment},[Zt]:{get:()=>this.state}}),e},setup(){const{connection:e}=Ht(),n=it(),{editor:o}=j();return{connection:e,editor:o,isMobile:n}},data(){return{lastFilePath:null,draggedOver:!1,state:{isUploadingAttachments:!1}}},computed:{initialFilePath(){return this.lastFilePath??nt(this.$file?.relativePath??"/")}},methods:{setDraggedOver(e,n){n.dataTransfer.types.includes("Files")&&(this.draggedOver=e)},onPaste(e){this.uploadAttachmentFiles(e.detail.files)},onEditorDrop(e){this.uploadAttachmentFiles(e.detail.files,e.detail.position)},onAttachmentUploadFilePicked(e){this.uploadAttachmentFiles(e.target.files),e.target.value=""},chooseLocalFile(){this.$refs.attachmentFileInput.click()},async uploadAttachmentFiles(e,n=null){if(!e)return;this.state.isUploadingAttachments=!0;const o=[...e].map(s=>this.uploadAttachmentFile(s,n));return Promise.all(o).catch(s=>{R.error("Uploading multiple attachments failed",{error:s}),D(t("text","Uploading multiple attachments failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},async uploadAttachmentFile(e,n=null){return this.state.isUploadingAttachments=!0,_e(this.connection,e).then(o=>{this.insertAttachment(o.data?.name,o.data?.id,e.type,n,o.data?.dirname)}).catch(o=>{R.error("Uploading attachment failed",{error:o}),o.response?.data.error?D(t("text","Uploading attachment failed: {error}",{error:o.response.data.error})):D(t("text","Uploading attachment failed."))}).then(()=>{this.state.isUploadingAttachments=!1})},showAttachmentPrompt(){Bt()&&OC.dialogs.filepicker(t("text","Insert an attachment"),e=>{this.insertFromPath(e)},!1,[],!0,void 0,this.initialFilePath)},insertFromPath(e){return this.lastFilePath=nt(e),this.state.isUploadingAttachments=!0,He(this.connection,e).then(n=>{this.insertAttachment(n.data?.name,n.data?.id,n.data?.mimetype,null,n.data?.dirname)}).catch(n=>{R.error("Failed to insert from Files",{error:n}),D(t("text","Failed to insert from Files"))}).then(()=>{this.state.isUploadingAttachments=!1})},createAttachment(e){return this.state.isUploadingAttachments=!0,Re(this.connection,e).then(n=>{this.insertAttachmentPreview(n.data?.id)}).catch(n=>{R.error("Failed to create attachment",{error:n}),D(t("text","Failed to create attachment"))}).then(()=>{this.state.isUploadingAttachments=!1})},insertAttachmentPreview(e){const n=new URL(F(`/f/${e}`),window.origin).href.replaceAll(" ","%20");this.editor.chain().focus().insertPreview(n).run()},insertAttachment(e,n,o,s=null,i=""){const r=i+"/"+encodeURIComponent(e).replace(/[!'()*]/g,c=>"%"+c.charCodeAt(0).toString(16).toUpperCase()),a=e.replaceAll(/[[\]]/g,"");(s?this.editor.chain().focus(s):this.editor.chain()).setImage({src:r,alt:a}).run();const l=this.editor.view.state.selection;l.empty||this.editor.commands.focus(l.to),this.editor.commands.scrollIntoView(),this.editor.commands.setMeta("insertedAttachmentSrc",{src:r}),lt("text:image-node:add",null)}}};var Ne=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor editor-media-handler",class:{draggedOver:e.draggedOver,"is-mobile":e.isMobile},attrs:{"data-text-el":"editor-media-handler"},on:{"image-paste":e.onPaste,dragover:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!0,o)},dragleave:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!1,o)},drop:function(o){return o.preventDefault(),o.stopPropagation(),e.setDraggedOver(!1,o)},"file-drop":e.onEditorDrop}},[n("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"attachmentFileInput",attrs:{"data-text-el":"attachment-file-input",type:"file",accept:"*/*",multiple:""},on:{change:e.onAttachmentUploadFilePicked}}),e._t("default")],2)},Ie=[],Ve=O(Te,Ne,Ie,!1,null,null);const Be=Ve.exports,Ue={name:"MainContainer",components:{MediaHandler:Be},mixins:[ee]};var We=function(){var e=this,n=e._self._c;return n("div",{staticClass:"editor"},[e.$editorUpload?n("MediaHandler",{staticClass:"text-editor__main"},[e._t("default")],2):e._t("default")],2)},ze=[],Le=O(Ue,We,ze,!1,null,"e0c9a19c");const dn=Le.exports,Ke={name:"Wrapper",provide(){const e={};return Object.defineProperties(e,{[It]:{get:()=>this.outline},[Nt]:{get:()=>({toggle:this.outlineToggle})},[Tt]:{get:()=>({toggle:this.readOnlyToggle})}}),e},props:{isResolvingConflict:{type:Boolean,default:!1},hasConnectionIssue:{type:Boolean,default:!1},contentLoaded:{type:Boolean,default:!0},showOutlineOutside:{type:Boolean,default:!1}},setup(){const{isRichEditor:e,isRichWorkspace:n}=rt();return{isRichEditor:e,isRichWorkspace:n}},data:()=>({outline:{visible:!1,enable:!1}}),computed:{showOutline(){return this.isAbleToShowOutline?this.outline.visible:!1},isAbleToShowOutline(){return!this.isRichWorkspace}},watch:{showOutlineOutside(){this.outline.visible=this.showOutlineOutside}},mounted(){at("text:keyboard:outline",this.outlineToggle),this.outline.enable=this.isAbleToShowOutline,this.$watch(()=>this.isAbleToShowOutline,e=>{Object.assign(this.outline,{enable:e})})},beforeDestroy(){Ut("text:keyboard:outline",this.outlineToggle)},methods:{outlineToggle(){this.outline.visible=!this.outline.visible,this.$emit("outline-toggled",this.outline.visible)},readOnlyToggle(){this.$emit("read-only-toggled")}}};var je=function(){var e=this,n=e._self._c;return n("div",{staticClass:"text-editor__wrapper",class:{"has-conflicts":e.isResolvingConflict,"is-rich-workspace":e.isRichWorkspace,"is-rich-editor":e.isRichEditor}},[e._t("default")],2)},qe=[],Je=O(Ke,je,qe,!1,null,"ae654636");const cn=Je.exports;export{ln as C,dn as M,cn as W,rn as a,z as e,an as p,re as u};
//# sourceMappingURL=Wrapper-Cs0XkUHl.chunk.mjs.map
