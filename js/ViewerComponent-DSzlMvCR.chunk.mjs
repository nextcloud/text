import{N as l,g as m}from"./NcNoteCard-CwNXZ4vV-Dff94GWm.chunk.mjs";import{g as c}from"./Editor.singleton-CEZpzej5.chunk.mjs";import{t as u,c as p}from"./NcLoadingIcon-CR2lMUNM.chunk.mjs";import{g as f,a as h}from"./dav-Rt1kTtvI-CV-qd1vO.chunk.mjs";import{V as n}from"./vue.runtime.esm-nXYIs6vL.chunk.mjs";import{g}from"./TocContainer-ANCwihb6.chunk.mjs";import r from"./MarkdownContentEditor-DWPySXRr.chunk.mjs";import{P as d}from"./PlainTextReader-yw4EuEPz.chunk.mjs";import{n as a}from"./NcCheckboxRadioSwitch-CgbTELjq-C7Y7tXRC.chunk.mjs";import"./index-D3wiQe9-.chunk.mjs";import"./emoji-picker-hi3Hwbeu.chunk.mjs";import"./index-Bnw2WuIx.chunk.mjs";import"./index-CdM8BgQf.chunk.mjs";import"./preload-helper-BorfeO-5.chunk.mjs";import"./index-DCzdQJ7L.chunk.mjs";import"./logger-DS8A9d_w.chunk.mjs";import"./MediaHandler.provider-bE4nrOxZ.chunk.mjs";import"./MenuBar-CGR8fh0q.chunk.mjs";import"./Wrapper-Dco3E4KB.chunk.mjs";import"./BaseReader-BZSE6EEb.chunk.mjs";const y={name:"SourceView",components:{NcButton:n.extend(l),PencilOutlineIcon:n.extend(g),PlainTextReader:n.extend(d),MarkdownContentEditor:n.extend(r)},inject:["isEmbedded"],props:{filename:{type:String,default:null},fileid:{type:Number,default:null},mime:{type:String,default:null},source:{type:String,default:void 0}},data(){return{content:""}},computed:{isEncrypted(){return this.$attrs.e2EeIsEncrypted||!1},isMarkdown(){return this.mime==="text/markdown"||this.mime==="text/x-web-markdown"},readerComponent(){return this.isMarkdown?r:d}},watch:{source(){this.loadFileContent()}},mounted(){this.loadFileContent()},methods:{async loadFileContent(){if(this.isEncrypted)this.content=await this.fetchDecryptedContent(),this.contentLoaded=!0;else{const e=await p.get(this.source);this.content=e.data,this.contentLoaded=!0}this.$emit("loaded",!0)},async fetchDecryptedContent(){const e=await f().getFileContents(`${h()}${this.filename}`,{details:!0}),i=new Blob([e.data],{type:e.headers["content-type"]}),o=new FileReader;return o.readAsText(i),new Promise(s=>{o.onload=()=>{s(o.result)}})},t:u}};var w=function(){var e=this,i=e._self._c;return i("div",{staticClass:"text-editor source-viewer",attrs:{id:"editor-container","data-text-el":"editor-container"}},[i(e.readerComponent,{tag:"Component",attrs:{content:e.content,"file-id":e.fileid,"read-only":!0,"show-menu-bar":!1}}),e.isEmbedded?i("NcButton",{staticClass:"toggle-interactive",on:{click:function(o){return e.$emit("edit")}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("PencilOutlineIcon")]},proxy:!0}],null,!1,139796693)},[e._v(" "+e._s(e.t("text","Edit"))+" ")]):e._e()],1)},E=[],b=a(y,w,E,!1,null,"4e29154c");const v=b.exports,x={name:"ViewerComponent",components:{SourceView:v,Editor:c},provide(){return{isEmbedded:this.isEmbedded}},props:{filename:{type:String,default:null},fileid:{type:Number,default:null},active:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!0},shareToken:{type:String,default:()=>m()},mime:{type:String,default:null},permissions:{type:String,default:""},source:{type:String,default:void 0},isEmbedded:{type:Boolean,default:!1}},data(){return{hasToggledInteractiveEmbedding:!1}},computed:{useSourceView(){return this.source&&(this.fileVersion||!this.fileid||this.isEmbedded||this.isEncrypted)&&!this.hasToggledInteractiveEmbedding}},mounted(){this.useSourceView||this.onLoaded()},methods:{async onLoaded(){this.$emit("update:loaded",!0)},toggleEdit(){this.hasToggledInteractiveEmbedding=!0},t}};var S=function(){var e=this,i=e._self._c;return e.useSourceView?i("SourceView",e._b({attrs:{fileid:e.fileid,filename:e.filename,mime:e.mime,source:e.source},on:{loaded:e.onLoaded,edit:e.toggleEdit}},"SourceView",e.$attrs,!1)):i("Editor",{class:{"text-editor--embedding":e.isEmbedded},attrs:{"file-id":e.fileid,"relative-path":e.filename,active:e.active||e.isEmbedded,autofocus:e.autofocus,"share-token":e.shareToken,mime:e.mime}})},C=[],k=a(x,S,C,!1,null,"86bbf0e6");const J=k.exports;export{J as default};
//# sourceMappingURL=ViewerComponent-DSzlMvCR.chunk.mjs.map
